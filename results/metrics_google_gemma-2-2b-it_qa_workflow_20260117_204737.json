{
  "timestamp": "20260117_204737",
  "model_name": "google/gemma-2-2b-it",
  "interrupted": false,
  "processed_count": 100,
  "total_count": 100,
  "multi_agent_mode": "qa_workflow",
  "gpu_info": {
    "cuda_available": true,
    "cuda_version": "12.1",
    "gpu_name": "NVIDIA GeForce RTX 4060 Laptop GPU",
    "gpu_memory_total_gb": 8.0,
    "gpu_memory_allocated_gb": 0.0,
    "gpu_memory_reserved_gb": 0.0,
    "gpu_name_detailed": "NVIDIA GeForce RTX 4060 Laptop GPU",
    "driver_version": "591.74"
  },
  "gpu_memory_after_load_gb": 4.87,
  "gpu_memory_during_inference_gb": 4.88,
  "gpu_memory_during_inference_max_gb": 4.88,
  "gpu_memory_during_inference_min_gb": 4.88,
  "api_model": false,
  "average_response_time_seconds": 7.812607941627502,
  "parsing_error_rate": 0.0,
  "parsing_errors_count": 0,
  "quality_metrics": {
    "массовая доля": {
      "средняя_точность": 0.0,
      "precision": 0.0,
      "recall": 0.0,
      "f1": 0.0,
      "tp": 0,
      "fp": 0,
      "fn": 279,
      "количество_сравнений": 84,
      "ошибки": [
        "Вещество K2O: предсказано отсутствует, истина [29.0, 31.0]",
        "Вещество N: предсказано отсутствует, истина [7.0, 9.0]",
        "Вещество S: предсказано отсутствует, истина [2.0, None]",
        "Вещество P2O5: предсказано отсутствует, истина [19.0, 21.0]",
        "Вещество K2O: предсказано отсутствует, истина 50.0",
        "Вещество SO4: предсказано отсутствует, истина 52.5",
        "Вещество Cl: предсказано отсутствует, истина 1.0",
        "Вещество K2O: предсказано отсутствует, истина 10.0",
        "Вещество N: предсказано отсутствует, истина 20.0",
        "Вещество P2O5: предсказано отсутствует, истина 10.0"
      ]
    },
    "прочее": {
      "средняя_точность": 0.04076810800948732,
      "precision": 0.14130434782608695,
      "recall": 0.06989247311827956,
      "f1": 0.09352517985611511,
      "tp": 13,
      "fp": 79,
      "fn": 173,
      "количество_сравнений": 87,
      "ошибки": [
        "Параметр стандарт: предсказано null, истина ту 20.15.52-089-05785164-2022",
        "Параметр марка: предсказано npks-8, истина npks-8 (npk 8:20:30)",
        "Параметр стандарт: предсказано null, истина ту 20.15.71-142-05015182-2017",
        "Параметр марка: предсказано null, истина отсутствует",
        "Параметр масса брутто: предсказано отсутствует, истина 1050.0",
        "Параметр стандарт: предсказано null, истина отсутствует",
        "Параметр количество вагонов: предсказано отсутствует, истина 15.0",
        "Параметр стандарт: предсказано null, истина ту 2181-073-05761695-2016",
        "Параметр масса нетто единицы: предсказано 1035000.0, истина отсутствует",
        "Параметр масса нетто: предсказано отсутствует, истина 1035000.0"
      ]
    }
  },
  "hyperparameters": {
    "max_new_tokens": 512,
    "do_sample": false,
    "torch_dtype": "bfloat16",
    "multi_agent_mode": "qa_workflow"
  },
  "prompt_template": "build_prompt3",
  "prompt_full_text": "МУЛЬТИАГЕНТНЫЙ РЕЖИМ: qa_workflow\n\n================================================================================\nПРОМПТ 1: ИЗВЛЕЧЕНИЕ ПИТАТЕЛЬНЫХ ВЕЩЕСТВ\n================================================================================\n\nТекст: КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос: Какие действующие вещества (питательные элементы или их соединения) указаны в этом удобрении? Извлекай только те, что относятся к агрохимическому составу:  \n— Азот как N,  \n— Фосфор как P2O5,  \n— Калий как K2O,  \n— Сера как S,  \n— Кальций как Ca,  \n— Магний как Mg,  \n— Цинк как Zn,  \n— и другие макро-/микроэлементы в стандартной форме.  \n\nЕсли в марке указано, например, \"N7-P20-K30\", извлекай: N, P2O5, K2O.  \nЕсли сказано \"K в пересчёте на K2O\" — указывай K2O.  \nНе включай упаковку, стандарты, массу, объём.\n\nОтвет должен быть строго списком строк в формате JSON. Примеры:\n\nТекст: Удобрение NPK 16-20-20 содержит азот, фосфор (в виде P2O5) и калий (в виде K2O).\nОтвет: [\"N\", \"P2O5\", \"K2O\"]\n\nТекст: Марка N7-P20-K30-S3\nОтвет: [\"N\", \"P2O5\", \"K2O\", \"S\"]\n\nТекст: Гранулированное удобрение в мешках по 50 кг. Соответствует ТУ 12345.\nОтвет: []\n\nТвой ответ:\n\n\n================================================================================\nПРОМПТ 2: ИЗВЛЕЧЕНИЕ МАССОВЫХ ДОЛЕЙ (для каждого вещества)\n================================================================================\n\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакова массовая доля N в удобрении? Учти, что:\n- Если указано \"K в пересчёте на K2O\" — это означает массовую долю K2O.\n- Если значение дано как диапазон (например, \"8–10\" или \"от 6 до 12\"), верни [min, max].\n- Если указано \"не менее X\" — верни [X, null].\n- Если указано \"не более X\" — верни [null, X].\n- Если значение одно — верни число (например, 20).\n- Используй точку как десятичный разделитель.\n- Если информации нет — верни null.\n\nОтвет должен быть только в формате JSON:\n{\"значение\": число | [min, max] | [число, null] | [null, число] | null}\n\n\n================================================================================\nПРОМПТ 3: ИЗВЛЕЧЕНИЕ СТАНДАРТА\n================================================================================\n\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакой стандарт (ГОСТ, ТУ, СТО или другой нормативный документ) указан для этого удобрения?  \nЕсли стандарт не указан — верни null.\n\nОтвет должен быть только в формате JSON:\n{\"значение\": \"полное название стандарта, например: ТУ 2184-037-32496445-02\" | null}\n\n\n================================================================================\nПРОМПТ 4: ИЗВЛЕЧЕНИЕ МАРКИ\n================================================================================\n\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакая марка удобрения указана (например, N7-P20-K30-S3)?  \nЕсли марка не указана — верни null.\n\nОтвет должен быть только в формате JSON:\n{\"значение\": \"марка\" | null}\n\n\n================================================================================\nПРОМПТ 5: ИЗВЛЕЧЕНИЕ КОЛИЧЕСТВ\n================================================================================\n\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакое количество товара указано в тексте? Это может быть:\n- масса (в кг, т и др.),\n- объём (в л, м³ и др.),\n- число упаковок (мешков, канистр, вагонов, поддонов, паллет и т.д.),\n- любая другая числовая характеристика количества.\n\nИзвлеки:\n1. **Числовое значение** (если указано \"1000 мешков\" → 1000; \"5 т\" → 5; \"мешки по 50 кг\" → 50).\n2. **Единицу измерения** (например: \"кг\", \"т\", \"шт\", \"меш\", \"вагон\", \"л\", \"паллета\" и т.д. — как в тексте, но в нижнем регистре и без сокращений типа \"п/э\").\n3. Если указан допуск (например, \"+5%\"), учти его: \"1000 кг+5%\" → 1050.\n\nПравила:\n- Извлекай **только то, что явно указано**.\n- Не суммируй, не интерполируй, не вычисляй общее количество, если оно не дано напрямую.\n- Если количество не указано — верни null.\n\nОтвет должен быть строго в формате JSON:\n{\"значение\": число | null, \"единица\": строка | null}\n\n\n================================================================================\nПРОМПТ 6: СБОРКА ФИНАЛЬНОГО JSON\n================================================================================\n(Автоматическая сборка из всех извлеченных данных)\n",
  "prompt_info": {
    "mode": "qa_workflow",
    "prompts_used": [
      "QA_NUTRIENTS_PROMPT",
      "QA_NUTRIENT_PROMPT",
      "QA_STANDARD_PROMPT",
      "QA_GRADE_PROMPT",
      "QA_QUANTITY_PROMPT"
    ],
    "example_nutrients_prompt": "\nТекст: КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос: Какие действующие вещества (питательные элементы или их соединения) указаны в этом удобрении? Извлекай только те, что относятся к агрохимическому составу:  \n— Азот как N,  \n— Фосфор как P2O5,  \n— Калий как K2O,  \n— Сера как S,  \n— Кальций как Ca,  \n— Магний как Mg,  \n— Цинк как Zn,  \n— и другие макро-/микроэлементы в стандартной форме.  \n\nЕсли в марке указано, например, \"N7-P20-K30\", извлекай: N, P2O5, K2O.  \nЕсли сказано \"K в пересчёте на K2O\" — указывай K2O.  \nНе включай упаковку, стандарты, массу, объём.\n\nОтвет должен быть строго списком строк в формате JSON. Примеры:\n\nТекст: Удобрение NPK 16-20-20 содержит азот, фосфор (в виде P2O5) и калий (в виде K2O).\nОтвет: [\"N\", \"P2O5\", \"K2O\"]\n\nТекст: Марка N7-P20-K30-S3\nОтвет: [\"N\", \"P2O5\", \"K2O\", \"S\"]\n\nТекст: Гранулированное удобрение в мешках по 50 кг. Соответствует ТУ 12345.\nОтвет: []\n\nТвой ответ:\n",
    "example_nutrient_prompt": "\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакова массовая доля N в удобрении? Учти, что:\n- Если указано \"K в пересчёте на K2O\" — это означает массовую долю K2O.\n- Если значение дано как диапазон (например, \"8–10\" или \"от 6 до 12\"), верни [min, max].\n- Если указано \"не менее X\" — верни [X, null].\n- Если указано \"не более X\" — верни [null, X].\n- Если значение одно — верни число (например, 20).\n- Используй точку как десятичный разделитель.\n- Если информации нет — верни null.\n\nОтвет должен быть только в формате JSON:\n{\"значение\": число | [min, max] | [число, null] | [null, число] | null}\n",
    "example_standard_prompt": "\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакой стандарт (ГОСТ, ТУ, СТО или другой нормативный документ) указан для этого удобрения?  \nЕсли стандарт не указан — верни null.\n\nОтвет должен быть только в формате JSON:\n{\"значение\": \"полное название стандарта, например: ТУ 2184-037-32496445-02\" | null}\n",
    "example_grade_prompt": "\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакая марка удобрения указана (например, N7-P20-K30-S3)?  \nЕсли марка не указана — верни null.\n\nОтвет должен быть только в формате JSON:\n{\"значение\": \"марка\" | null}\n",
    "example_quantity_prompt": "\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакое количество товара указано в тексте? Это может быть:\n- масса (в кг, т и др.),\n- объём (в л, м³ и др.),\n- число упаковок (мешков, канистр, вагонов, поддонов, паллет и т.д.),\n- любая другая числовая характеристика количества.\n\nИзвлеки:\n1. **Числовое значение** (если указано \"1000 мешков\" → 1000; \"5 т\" → 5; \"мешки по 50 кг\" → 50).\n2. **Единицу измерения** (например: \"кг\", \"т\", \"шт\", \"меш\", \"вагон\", \"л\", \"паллета\" и т.д. — как в тексте, но в нижнем регистре и без сокращений типа \"п/э\").\n3. Если указан допуск (например, \"+5%\"), учти его: \"1000 кг+5%\" → 1050.\n\nПравила:\n- Извлекай **только то, что явно указано**.\n- Не суммируй, не интерполируй, не вычисляй общее количество, если оно не дано напрямую.\n- Если количество не указано — верни null.\n\nОтвет должен быть строго в формате JSON:\n{\"значение\": число | null, \"единица\": строка | null}\n"
  },
  "parsing_errors": [],
  "total_samples": 100,
  "valid_json_count": 100,
  "invalid_json_count": 0,
  "gemini_analysis": {
    "status": "success",
    "analysis": "Как эксперт по оценке качества работы языковых моделей, я провел анализ предоставленных результатов тестирования модели `google/gemma-2-2b-it`.\n\n**Общая оценка:**\nМодель демонстрирует крайне низкие показатели качества по задачам извлечения массовых долей и другим параметрам, что указывает на серьезные проблемы в способности модели к точному и полному извлечению специфической информации из текста. Однако, модель хорошо справляется с соблюдением заданного формата JSON.\n\n---\n\n### 1. Характерные ошибки модели\n\n*   **Полное отсутствие извлечения массовых долей (0% F1-score):** Это самая критичная проблема. Модель не смогла извлечь ни одного числового значения, связанного с массовыми долями, даже когда они, судя по \"истине\" в примерах ошибок, присутствовали в исходных текстах.\n*   **Неполное или некорректное извлечение \"прочих\" параметров (F1-score 9.35%):** Модель часто пропускает важные параметры (например, \"стандарт\", \"масса брутто\") или извлекает их как `null` или \"отсутствует\", тогда как истинные значения были доступны в тексте. В одном случае (марка), она извлекла часть информации, но, вероятно, пропустила детали (`npks-8` вместо `npks-8 (npk 8:20:30)`).\n*   **Слабая интерпретация доменной лексики и косвенных указаний:** В промпте 1, текст \"КАЛИЙ СЕРНОКИСЛЫЙ\" подразумевает элемент \"Калий\" (в форме K2O), но модель, вероятно, не смогла связать это с требуемыми стандартными формами (K2O). Это говорит о недостаточном понимании предметной области или неспособности к выводу на основе косвенных названий.\n*   **Отсутствие предсказаний по первому промпту (извлечение питательных веществ) в предоставленном примере:** В представленном промпте 1 нет вывода модели, но, исходя из текста `КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ`, если модель не смогла связать \"Калий сернокислый\" с \"K2O\", она, скорее всего, выдала бы пустой список `[]`, что для данного конкретного текста без явных процентных указаний или стандартных форм (типа N7-P20-K30) может быть и корректным ответом, если не обучена делать семантический вывод. Однако, отсутствие результатов затрудняет анализ.\n\n---\n\n### 2. Причины ошибок парсинга JSON\n\n*   **Ошибок парсинга не обнаружено.** Это очень хороший результат. Модель успешно следует инструкциям по форматированию вывода в JSON, даже если содержание этого JSON неверно или отсутствует. Это указывает на то, что модель понимает синтаксис JSON и способна его генерировать.\n\n---\n\n### 3. Причины ошибок в извлечении данных\n\n*   **Недостаточное понимание предметной области и семантического связывания:** Модель неспособна автоматически распознавать \"КАЛИЙ СЕРНОКИСЛЫЙ\" как источник K2O, что требует доменных знаний или очень сильных few-shot примеров.\n*   **Слабая способность к извлечению числовых данных из текста:** Нулевая точность для массовых долей указывает на то, что модель либо не распознает числовые значения как \"массовые доли\", либо не может их корректно выделить из различных текстовых контекстов (например, \"N 7-9%\", \"K2O 50%\").\n*   **Возможное несоответствие тестовых данных промпту в предоставленном примере:** В представленном фрагменте промпта для \"ИЗВЛЕЧЕНИЕ МАССОВЫХ ДОЛЕЙ\" исходный текст (`КАЛИЙ СЕРНОКИСЛЫЙ...`) не содержит никаких числовых значений массовых долей. Если модель отвечала на этот конкретный текст, то \"отсутствует\" было бы правильным ответом. Однако, *примеры ошибок качества* показывают, что в тестовом наборе *были* тексты с массовыми долями (`истина [29.0, 31.0]`, `истина 50.0`), и модель их не извлекла. Это говорит о системной проблеме модели, а не только о \"пустом\" входном тексте.\n*   **Недостаток примеров (few-shot learning):** Даже с подробными инструкциями, для такой маленькой модели (2B) часто требуется больше примеров в промпте, демонстрирующих различные сценарии извлечения, включая сложные структуры, диапазоны значений и отсутствие информации.\n*   **Ограниченная мощность модели:** `gemma-2-2b-it` — это относительно небольшая модель. Для сложных задач извлечения информации с тонкостями доменных знаний и необходимостью извлекать числовые данные, может быть недостаточна ее емкость.\n\n---\n\n### 4. Рекомендации по улучшению промпта\n\nУчитывая, что промпт достаточно детализирован, но модель все равно ошибается, следует добавить больше *прикладных примеров* (few-shot examples) и уточнить некоторые моменты:\n\n**Для Промпта 1: ИЗВЛЕЧЕНИЕ ПИТАТЕЛЬНЫХ ВЕЩЕСТВ**\n1.  **Добавить примеры для косвенных указаний:**\n    *   `Текст: Удобрение содержит Калий сернокислый.`\n    *   `Ответ: [\"K2O\"]`\n    *   Или явно указать в инструкции: \"Если в названии удобрения или его описании упоминается химическое соединение элемента (например, 'Калий сернокислый'), извлекай соответствующий стандартный агрохимический элемент (например, K2O).\"\n2.  **Добавить примеры с отсутствующими элементами:**\n    *   `Текст: Гранулированное удобрение для газонов.`\n    *   `Ответ: []`\n    Это поможет модели понять, когда *не нужно* извлекать что-либо.\n3.  **Убедиться, что примеры \"истина\" соответствуют текстовым данным:** Проверьте, что в тестовых данных для этого промпта, где ожидаются N, P2O5, K2O и S, они *действительно* присутствуют в форме, которую модель может распознать, или что промпт достаточно детализирован, чтобы модель могла сделать выводы (например, из \"Калий сернокислый\" -> K2O).\n\n**Для Промпта 2: ИЗВЛЕЧЕНИЕ МАССОВЫХ ДОЛЕЙ (для каждого вещества)**\n1.  **Исправить опечатку:** В вопросе: \"...это означает массовую долю K2\" -> \"это означает массовую долю **K2O**\".\n2.  **Добавить больше примеров с числовыми значениями и диапазонами:**\n    *   `Текст: N: 7-9%, P2O5: 19-21%, K2O: 50%.`\n    *   `Вопрос: Какова массовая доля N в удобрении?`\n    *   `Ответ: [7.0, 9.0]` (или `7-9`, если это ожидаемый формат для диапазона).\n    *   `Вопрос: Какова массовая доля K2O в удобрении?`\n    *   `Ответ: [50.0]` (или `50`).\n3.  **Пример, где массовая доля отсутствует:**\n    *   `Текст: Удобрение без азота.`\n    *   `Вопрос: Какова массовая доля N в удобрении?`\n    *   `Ответ: []` (или `null`, или `\"отсутствует\"`, в зависимости от желаемого формата).\n4.  **Четко определить формат вывода для диапазонов:** В примерах ошибок \"истина\" представлена как `[29.0, 31.0]`. Нужно явно указать в промпте, что ожидается массив из двух чисел для диапазона, или одно число, если это точное значение.\n\n---\n\n### 5. Рекомендации по настройке гиперпараметров\n\nПредоставленные гиперпараметры являются стандартными и адекватными для задачи извлечения информации:\n*   `max_new_tokens=512`: Достаточно для большинства извлечений.\n*   `do_sample=false`: Важно для детерминированного извлечения информации, чтобы получать стабильные ответы. Это правильный выбор.\n*   `torch_dtype=bfloat16`: Стандартный тип данных, не оказывает влияния на логику ответа.\n*   `multi_agent_mode=\"qa_workflow\"`: Это часть структуры промпта, а не гиперпараметр модели.\n\n**Вывод:** Текущие гиперпараметры не являются основной причиной проблем с качеством. Основная проблема кроется в самой модели (ее размере/обучении) и/или в недостаточной детализации промпта через few-shot примеры.\n\n---\n\n### 6. Общие рекомендации по улучшению качества\n\n1.  **Усиленное Few-Shot Learning:** Добавление большего количества разнообразных и высококачественных примеров в промпт — это самый быстрый и эффективный способ улучшить производительность без изменения модели. Эти примеры должны охватывать:\n    *   Все варианты извлечения (точечные значения, диапазоны, косвенные упоминания).\n    *   Различные формулировки исходного текста.\n    *   Случаи, когда информация отсутствует.\n    *   Примеры, где извлекаемая информация находится в более сложных предложениях или окружении.\n2.  **Проверка и доработка тестовых данных:** Убедиться, что \"истина\" (ground truth) в тестовом наборе точно соответствует тому, что *можно и нужно* извлечь из соответствующего входного текста, и что промпт однозначно трактует эти случаи. Возможно, некоторые \"ошибки\" модели являются следствием некорректно размеченной \"истины\" для текстов, где информация фактически отсутствует или представлена в неопределенном виде.\n3.  **Fine-tuning на специализированных данных (при возможности):** Для такой специфической предметной области, как агрохимия, fine-tuning модели на большом корпусе аннотированных текстов, содержащих данные об удобрениях, может значительно повысить ее способность к точному извлечению информации, пониманию доменной лексики и числовых значений.\n4.  **Рассмотрение более мощных моделей:** `gemma-2-2b-it` — это очень легкая модель. Для задач, требующих глубокого понимания контекста, доменных знаний и точного извлечения числовых данных, более крупные модели (например, `gemma-2-9b-it`, Llama 3) или специализированные модели могут показать значительно лучшие результаты.\n5.  **Использование RAG (Retrieval-Augmented Generation):** Если информация для извлечения иногда отсутствует в данном конкретном фрагменте текста, но может быть найдена в других источниках (базах данных, документации), интеграция с RAG системой может помочь модели получить необходимый контекст для ответа.\n\n---\n\n**Заключение:**\nМодель `google/gemma-2-2b-it` в текущей конфигурации и с данным промптом критически плохо справляется с задачей извлечения числовых значений и требует значительных улучшений. Основные точки роста — это обогащение промпта большим количеством качественных few-shot примеров, тщательная проверка соответствия тестовых данных и ожидаемых ответов, и, при необходимости, рассмотрение более мощных моделей или fine-tuning.",
    "model_used": "gemini-2.5-flash"
  }
}