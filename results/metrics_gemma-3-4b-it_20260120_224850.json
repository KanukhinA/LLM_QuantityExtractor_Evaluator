{
  "timestamp": "20260120_224850",
  "model_name": "gemma-3-4b-it",
  "interrupted": false,
  "processed_count": 100,
  "total_count": 100,
  "multi_agent_mode": null,
  "gpu_info": {
    "api": true
  },
  "gpu_memory_after_load_gb": 0.0,
  "gpu_memory_during_inference_gb": 0.0,
  "gpu_memory_during_inference_max_gb": 0.0,
  "gpu_memory_during_inference_min_gb": 0.0,
  "api_model": true,
  "average_response_time_seconds": 6.903790676593781,
  "parsing_error_rate": 0.01,
  "parsing_errors_count": 1,
  "quality_metrics": null,
  "hyperparameters": {
    "max_new_tokens": 512,
    "model_name": "gemma-3-4b-it",
    "api_model": true
  },
  "prompt_template": "build_prompt3",
  "prompt_full_text": "\nТы — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  \nТвоя задача:  \n\n1. Найти все численные признаки в тексте, например:  \n   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  \n   - Количество товара (кг, т, п/э мешки, вагон и др.).  \n   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  \n\n2. Для каждого численного признака определить:  \n   - Название признака (например, \"массовая доля N\", \"массовая доля P2O5\", \"массовая доля К2О\", \"массовая доля S\", \"масса нетто единицы\", \"масса нетто\", \"масса K2O\", \"масса брутто\", \"количество вагонов\", \"стандарт\" и т.д.)  \n   - Значение (число, если есть диапазон — брать оба значения; для стандарта указываешь полный номер стандарта со словами ГОСТ/ТУ или др.)  \n   - Единицу измерения (%, кг, т, шт, п/э меш, вагон, или пусто для стандарта)  \n\n3. Особые указания:\n   - Извлекай на русском\n   - Если признак указан как диапазон из нескольких чисел (например \"8-10\", или \"от 6 до 12\") или с погрешностью (+/-), укажи оба числа в формате [min, max]. \n   - Извлекай логические/сравнительные операторы, если они присутствуют в тексте: «не менее» - [min, null] «не более» - [null, max]\n   - Используй точку в качестве разделителя десятичных чисел.\n   - Название вещества и его массовая доля могут встречаться в марке (например, \"N7-P20-K30-S3\"),  используй данные из марки, если нет иных данных по массовой доле вещества.\n   - Если в названии признака есть название химического элемента (например Кальций) - замени его на обозначение химического элемента - Ca.\n   - Названия признаков пиши с маленькой буквы. Например \"массовая доля Zn\".\n   - Если указано например \"МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О\" - то правильным извлекаемым признаком будет \"массовая доля K2O\".\n   - Если один и тот же параметр встречается дважды — сначала как общее условие (например, «с содержанием азота более 10%»), а затем как конкретное значение (например, «азот 16%»), указывай только конкретное значение.\n   - Для массы с упаковкой - называй признак \"масса брутто\" вне зависимости от наименования упаковки. Если указывается просто масса в формате \"МЕШКИ ПО 50 КГ\" - это признак \"масса нетто\".\n   - Если дается масса в виде \"ПО 1000 КГ+5%\" - указывай в признаке \"масса брутто\" одно значение - 1050.\n   - Для прочих признаков (всех признаков, помимо \"массовой доли\") указывай единицы измерения (за исключением признаков \"марка\" и \"стандарт\")\n   - Если признака в тексте нет - не извлекай его и не выводи его в json.\n\n4. Выводи строго JSON следующего вида (пример):\n\nПример текста:\nНИТРОАММОФОСКА, УДОБРЕНИЕ МИНЕРАЛЬНОЕ, СОДЕРЖАЩЕЕ ТРИ ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА - АЗОТ-27 +-1%, ФОСФОР-20% (В ПЕРЕСЧЕТЕ НА P2O5), КАЛИЙ-20% (В ПЕРЕСЧЕТЕ НА K2O), СЕРА-3%. ПОСТАВЛЯЕТСЯ В МЕШКАХ ПО 50 КГ. МАССА БРУТТО С УПАКОВКОЙ: 1020 КГ. КОЛИЧЕСТВО ПОДДОНОВ: 20 ШТ. КОЛИЧЕСТВО МЕШКОВ: 1000 ШТ. ОБЪЕМ НЕТТО ЕДИНИЦЫ: 10 Л. СООТВЕТСТВУЕТ ТУ 2184-037-32496445-02. МАРКА: N26-P20-K20-S3.\n\nПример ответа:\n```json\n{\n  \"массовая доля\": [\n    {\"вещество\": \"N\", \"массовая доля\": [26, 28]},\n    {\"вещество\": \"P2O5\", \"массовая доля\": 20},\n    {\"вещество\": \"K2O\", \"массовая доля\": 20},\n    {\"вещество\": \"S\", \"массовая доля\": 3}\n  ],\n  \"прочее\": [\n    {\"параметр\": \"масса нетто единицы\", \"масса\": 50, \"единица\": \"кг\"},\n    {\"параметр\": \"масса брутто\", \"масса\": 1020, \"единица\": \"кг\"},\n    {\"параметр\": \"количество поддонов\", \"количество\": 20, \"единица\": \"шт\"},\n    {\"параметр\": \"количество мешков\", \"количество\": 1000, \"единица\": \"шт\"},\n    {\"параметр\": \"объем нетто единицы\", \"объем\": 10, \"единица\": \"л\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"ТУ 2184-037-32496445-02\"},\n    {\"параметр\": \"марка\", \"значение\": \"N26-P20-K20-S3\"}\n  ]\n}\n```\n\n5. Выводи json результат **только после слова ОТВЕТ:**.\n\nТекст для анализа:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n",
  "prompt_info": null,
  "parsing_errors": [
    "Текст #95: невалидный JSON. Ответ: [0.0012, 0.0006, 0.0006, 0.0006, 0.0006, 0.0006, 0.0006, 0.0006, 0.0"
  ],
  "total_samples": 100,
  "valid_json_count": 99,
  "invalid_json_count": 1,
  "gemini_analysis": {
    "status": "success",
    "analysis": "Как эксперт по оценке качества работы языковых моделей, я провел анализ предоставленных результатов тестирования модели `gemma-3-4b-it`.\n\n---\n\n### Анализ результатов тестирования `gemma-3-4b-it`\n\n**1. Характерные ошибки модели:**\n\n*   **Полное отсутствие валидного JSON-вывода:** Главная и наиболее критичная ошибка заключается в том, что модель не смогла сгенерировать ни одного валидного JSON-объекта, что подтверждается 0.00% по всем метрикам и примером ошибки парсинга.\n*   **Игнорирование структурных требований:** Модель выдала последовательность чисел `[0.0012, 0.0006, ...`, что свидетельствует о попытке извлечь численные данные, но при этом она полностью проигнорировала требование к структуре вывода, которая явно не была указана в промпте.\n*   **Невозможность оценить качество извлечения данных:** Из-за отсутствия валидного JSON-вывода, невозможно оценить, насколько корректно модель извлекает сами данные (названия признаков, значения, единицы измерения) даже при условии, что она могла бы их идентифицировать.\n\n**2. Причины ошибок парсинга JSON:**\n\n*   **Отсутствие явного указания формата вывода в промпте:** Основная причина – промпт очень детально описывает *что* извлекать и *как* обрабатывать значения, но совершенно не указывает *в каком формате* должен быть представлен конечный результат (например, \"ответь в формате JSON\", \"каждый извлеченный признак должен быть JSON-объектом со следующими полями...\"). Модель, особенно относительно небольшая как `gemma-3-4b-it`, без такого прямого указания склонна генерировать текст в наиболее простом для нее виде, которым в данном случае оказалась последовательность чисел.\n*   **Недостаток примеров JSON-структуры:** Даже если бы было упомянуто \"JSON\", без конкретного примера ожидаемой структуры JSON-объекта/массива объектов, модель могла бы ошибиться в формате.\n\n**3. Причины ошибок в извлечении данных:**\n\n*   Как упоминалось выше, при 0% метриках и полном отсутствии валидного JSON-выхода, невозможно сделать выводы о причинах ошибок в *извлечении данных*. Текущие ошибки носят более фундаментальный характер — это ошибки *форматирования вывода*, которые препятствуют любой дальнейшей оценке. Модель могла бы извлечь данные правильно, но представить их в нечитаемом для парсера виде.\n\n**4. Рекомендации по улучшению промпта:**\n\nАбсолютный приоритет — явное указание на JSON-формат вывода.\n\n*   **Добавить раздел \"Формат вывода\" (Output Format):**\n    *   Четко указать, что ответ должен быть валидным JSON-массивом.\n    *   Для каждого элемента массива (каждого извлеченного признака) явно определить необходимые ключи и их типы данных (например, `название_признака: string`, `значение: string/array`, `единица_измерения: string`).\n    *   **Пример:**\n        ```\n        Твой ответ должен быть представлен в виде валидного JSON-массива. Каждый элемент массива должен быть JSON-объектом, содержащим следующие поля:\n        ```json\n        [\n          {\n            \"название_признака\": \"string\",  // Например, \"массовая доля N\", \"стандарт\"\n            \"значение\": \"string | [min, max] | [min, null] | [null, max]\", // Число, диапазон, или номер стандарта\n            \"единица_измерения\": \"string | null\" // %, кг, т, или null для стандартов\n          },\n          // ... другие извлеченные признаки\n        ]\n        ```\n        **Пример корректного вывода:**\n        ```json\n        [\n          {\n            \"название_признака\": \"массовая доля N\",\n            \"значение\": [10, null],\n            \"единица_измерения\": \"%\"\n          },\n          {\n            \"название_признака\": \"массовая доля P2O5\",\n            \"значение\": 20,\n            \"единица_измерения\": \"%\"\n          },\n          {\n            \"название_признака\": \"стандарт\",\n            \"значение\": \"ГОСТ 32323-2020\",\n            \"единица_измерения\": null\n          }\n        ]\n        ```\n*   **Усилить инструкции по диапазонам и операторам:** Убедиться, что эти правила (например, `[min, max]`, `[min, null]`) ясно интерпретируются *внутри* поля `значение` JSON-объекта.\n\n**5. Рекомендации по настройке гиперпараметров:**\n\n*   **`max_new_tokens`**: Текущее значение 512, скорее всего, достаточно. Однако, если после добавления JSON-структуры модель будет генерировать очень длинные выводы (например, для текстов с большим количеством признаков), возможно, потребуется увеличить это значение. Сейчас это не первостепенно.\n*   **Temperature / top_p / top_k (если доступны):** Эти параметры могут влиять на детерминированность и \"креативность\" ответов.\n    *   Для задачи извлечения данных обычно рекомендуется использовать более низкие значения `temperature` (например, 0.1-0.3) и более высокие `top_p` (например, 0.9), чтобы модель была более точной и менее склонной к галлюцинациям, а также чтобы она придерживалась заданного формата. Однако, сначала нужно добиться вообще получения JSON.\n\n**6. Общие рекомендации по улучшению качества:**\n\n*   **Использование Few-Shot примеров:** После того, как промпт будет дополнен явным указанием JSON-формата, крайне полезно добавить 2-3 примера полного цикла: `Текст: <входной_текст> -> Ответ: <валидный_JSON_вывод_для_этого_текста>`. Это значительно улучшит способность модели следовать формату и правилам извлечения, особенно для небольших моделей.\n*   **Выбор модели:** `gemma-3-4b-it` — относительно небольшая модель. Задачи с высокой детализацией инструкций, необходимостью парсинга сложных текстовых паттернов и строгим требованием к структурированному выводу (JSON) лучше решаются более крупными и мощными моделями (например, Llama-3-8b, Mixtral, или модели семейства GPT), которые лучше справляются с `instruction following`. Рассмотрите возможность использования более крупной модели, если это позволяет бюджет и инфраструктура.\n*   **Итеративный подход:** Внесите изменения в промпт (добавьте JSON-формат), проведите повторное тестирование. Если метрики улучшатся, но все еще будут ошибки в извлечении данных, тогда уже можно будет анализировать конкретные ошибки и дорабатывать промпт или добавлять больше примеров.\n*   **Валидация JSON-схемы:** В тестовом пайплайне внедрите строгую валидацию JSON-выхода по заранее определенной схеме. Это позволит немедленно выявлять любые отклонения от требуемого формата.\n\n---\n\n**Резюме:** Основная проблема заключается в отсутствии указания JSON-формата в промпте. После исправления этого недочета и, возможно, добавления нескольких примеров, модель должна начать генерировать парсируемый JSON, что позволит перейти к оценке и улучшению качества самого извлечения данных.",
    "model_used": "gemini-2.5-flash"
  }
}