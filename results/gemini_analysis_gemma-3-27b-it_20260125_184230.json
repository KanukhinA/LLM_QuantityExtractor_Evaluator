{
  "model_name": "gemma-3-27b-it",
  "timestamp": "20260125_184230",
  "analysis": "Как эксперт по оценке качества работы языковых моделей, я провел анализ предоставленных результатов тестирования модели `gemma-3-27b-it`.\n\nМодель демонстрирует отличные способности к соблюдению формата вывода (JSON), но имеет значительные возможности для улучшения в точности извлечения данных, особенно для категории \"прочее\".\n\n---\n\n### Анализ результатов тестирования `gemma-3-27b-it`\n\n**Общая оценка:**\nМодель хорошо справляется с задачей генерации корректного JSON-формата, что является критически важным для автоматизированной обработки. Однако, её эффективность в извлечении конкретных данных, особенно из категории \"прочее\", оставляет желать лучшего.\n\n**Важное замечание:** В предоставленном запросе отсутствует фактический вывод модели для \"Текста для анализа\". Мой анализ базируется исключительно на предоставленных метриках качества и описании промпта/примеров.\n\n---\n\n#### 1. Характерные ошибки модели\n\n*   **Массовая доля (F1: 74.63%)**:\n    *   **Недостаточная точность (Precision: 73.29%)**: Модель иногда извлекает значения, которые *не являются* массовыми долями, или некорректно привязывает их к веществам.\n    *   **Пропуски (Recall: 76.03%)**: Модель пропускает часть фактических массовых долей, присутствующих в тексте.\n    *   Вероятно, возникают сложности с однозначной идентификацией элемента/вещества, если оно указано в тексте не совсем явно, или с правильной обработкой разных форм записи (например, \"N\" vs \"азот общий\"). Также возможны ошибки при обработке диапазонов и пороговых значений (не более/не менее).\n\n*   **Прочее (F1: 51.66%)**:\n    *   **Очень низкая точность (Precision: 52.06%) и полнота (Recall: 51.27%)**: Это самая слабая часть производительности модели.\n    *   **Пропуски**: Модель пропускает большое количество \"прочих\" числовых показателей, таких как стандарты (ТУ, ГОСТ), марки, а также информацию о массе и единице товара.\n    *   **Неверные извлечения**: Модель может извлекать несвязанные числа или текстовые фрагменты как \"прочие\" параметры, или некорректно определять тип параметра (\"стандарт\", \"масса нетто единицы\" и т.д.).\n    *   **Проблемы с вычислениями**: Сложности с обработкой выражений типа \"1000 КГ+5%\" или \"25КГ+-5%\", требующих арифметических действий для определения точного значения или диапазона. Модель может либо игнорировать \"+-5%\", либо некорректно его интерпретировать.\n    *   **Дифференциация**: Возможно, модели сложно различать \"масса нетто единицы\", \"масса брутто единицы\" и \"масса брутто\" (общий вес), особенно если контекст неоднозначен.\n\n---\n\n#### 2. Причины ошибок парсинга JSON\n\n*   **Ошибок парсинга не обнаружено.** Это **очень сильная сторона** модели и промпта. Промпт, благодаря четкому указанию формата JSON и предоставлению нескольких примеров, отлично справился с обучением модели соблюдать структуру вывода. Это значительно упрощает дальнейшую автоматическую обработку.\n\n---\n\n#### 3. Причины ошибок в извлечении данных\n\n*   **Сложность и неоднородность категории \"Прочее\"**: Эта категория включает в себя широкий спектр числовых и текстовых данных (стандарты, массы, марки, идентификаторы), каждый из которых имеет свой уникальный паттерн. Пяти примеров, вероятно, недостаточно, чтобы охватить все вариации и научить модель надежно извлекать и классифицировать эти данные.\n*   **Нюансы химической номенклатуры**: Хотя примеры показывают корректное преобразование, например, P в P2O5, в реальных текстах могут быть другие, менее очевидные случаи или неоднозначности, которые модель не всегда может правильно разрешить.\n*   **Требования к арифметике**: Модель, по своей природе, не является калькулятором. Вычисление `1000 КГ+5%` до `1050 КГ` или `25КГ+-5%` до диапазона `[23.75, 26.25]` (или конкретного `26.25` как в примере 5) требует специфических рассуждений, которые LLM могут выполнять нестабильно без большого количества примеров или явных инструкций.\n*   **Контекстуальное понимание**: Различие между \"масса нетто единицы\" и \"масса брутто\" (общая) часто требует глубокого понимания контекста предложения, что может быть сложной задачей для модели.\n\n---\n\n#### 4. Рекомендации по улучшению промпта\n\n1.  **Увеличение количества и разнообразия примеров для \"Прочее\"**:\n    *   Добавьте больше примеров, которые включают различные типы стандартов (ГОСТ, ТУ с разными форматами), марки, и другие уникальные идентификаторы.\n    *   Особое внимание уделите примерам с расчетами массы:\n        *   Покажите больше вариантов \"X КГ +Y%\", \"X КГ +-Y%\", \"X КГ брутто\", \"X КГ нетто\".\n        *   Возможно, даже включите короткое объяснение, как именно производить расчеты в примерах, если формат позволяет. Например: \"В тексте '1000 КГ+5%', 5% от 1000 КГ = 50 КГ. Итого 1050 КГ.\"\n    *   Включите примеры, где \"прочих\" данных много, и примеры, где их нет вовсе (как в примере 4).\n\n2.  **Уточнение инструкций для вычислений**:\n    *   Явно укажите, что модель должна выполнять арифметические операции, если встречаются конструкции типа \"X КГ +Y%\" или \"X КГ +-Y%\". Определите, как именно должно быть представлено значение в случае диапазона (например, всегда брать верхний предел, или оба предела в массиве). В ваших примерах показано, что для `25КГ+-5%` выводится `26.25`, что является верхним пределом. Это нужно закрепить в инструкции, чтобы модель знала, как действовать.\n\n3.  **Четкое определение иерархии и приоритетов (если применимо)**:\n    *   Если есть приоритет между \"масса нетто единицы\", \"масса брутто единицы\" и \"масса брутто\" (общей), укажите это.\n    *   Убедитесь, что терминология `\"параметр\": \"масса брутто единицы\"` vs ` \"параметр\": \"масса брутто\"` четко закреплена в инструкции и примерах для разных сценариев.\n\n4.  **Стандартизация названий веществ**:\n    *   Подтвердите (или явно укажите), что все элементы и соединения должны быть представлены в определенном стандартизированном формате (например, всегда `N`, `P2O5`, `K2O`, `Ca`, `Cl`, `SO4`), даже если в тексте они упомянуты по-другому (например, \"азот\", \"калий\"). Примеры это показывают, но явное указание усилит это.\n\n---\n\n#### 5. Рекомендации по настройке гиперпараметров\n\n*   **`max_new_tokens`**: 1024 токенов достаточно для большинства JSON-ответов. Если ответы становятся более длинными, и вы заметите обрезание JSON, тогда можно увеличить. На данный момент менять не требуется.\n*   **`temperature`**: Не указан в гиперпараметрах, но для задач извлечения данных с четким форматом рекомендуется использовать **низкое значение `temperature` (например, 0.1-0.3)**. Это делает вывод модели более детерминированным и менее \"креативным\", что способствует стабильности и точности извлечения фактов.\n*   **`top_p` / `top_k`**: Аналогично `temperature`, для высокой точности извлечения рекомендуется использовать стандартные или слегка ограниченные значения `top_p` и `top_k`, чтобы модель не отходила от наиболее вероятных токенов.\n\n---\n\n#### 6. Общие рекомендации по улучшению качества\n\n1.  **Детальный анализ ошибок (Error Analysis)**:\n    *   Проведите глубокий анализ ошибок на выборке, где модель дала неверные результаты (особенно для \"прочее\"). Классифицируйте ошибки: пропуски определенных типов данных, некорректные вычисления, неверная классификация параметра, неправильное сопоставление вещества и значения. Это позволит точнее определить, какие именно аспекты промпта или данных для тонкой настройки нуждаются в доработке.\n\n2.  **Расширение датасета для обучения/тестирования**:\n    *   Создайте или соберите значительно больший и разнообразный набор данных для обучения (если планируется дообучение) и тестирования. Чем больше уникальных паттернов увидит модель, тем лучше она будет обобщать.\n\n3.  **Пост-обработка (Post-processing)**:\n    *   Внедрите скрипты для автоматической пост-обработки извлеченных данных. Это может включать:\n        *   Проверку на корректность числовых значений (например, что массовая доля не превышает 100%).\n        *   Стандартизацию названий веществ и единиц измерения, если модель все же допускает вариации.\n        *   Выполнение дополнительных расчетов или уточнений для диапазонов, если модель их извлекла, но не обработала полностью.\n        *   Фильтрацию очевидно некорректных извлечений.\n\n4.  **Дообучение (Fine-tuning)**:\n    *   Если после всех итераций с промптом качество останется недостаточным, рассмотрите возможность дообучения модели `gemma-3-27b-it` на значительном объеме ваших размеченных данных. Это позволит модели лучше интернализировать специфические паттерны вашего предметной области и задачи.\n\n---\n\n**Вывод:**\nМодель `gemma-3-27b-it` показала себя как сильный кандидат для задач извлечения информации с условием строгого соблюдения выходного формата. Основное внимание для дальнейшего улучшения следует уделить детализации и расширению примеров в промпте, особенно для сложной и многогранной категории \"прочее\", а также, при необходимости, рассмотреть дообучение на более обширном датасете. Отсутствие ошибок парсинга JSON является значительным преимуществом и говорит о хорошем потенциале модели для данной задачи.",
  "model_used": "gemini-2.5-flash",
  "parsing_errors_count": 0,
  "hyperparameters": {
    "max_new_tokens": 1024,
    "model_name": "gemma-3-27b-it",
    "api_model": true
  },
  "prompts": {
    "prompt_template": "build_prompt3",
    "prompt_full_text": "\nТы — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  \nТвоя задача:  \n\n1. Найти все численные признаки в тексте, например:  \n   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  \n   - Количество товара (кг, т, п/э мешки, вагон и др.).  \n   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  \n\n2. Выведи json по аналогии с этими примерами:\nТекст примера 1: СЛОЖНОЕ АЗОТНО-ФОСФОРНО-КАЛИЙНОЕ МИНЕРАЛЬНОЕ УДОБРЕНИЕ АЗОФОСКА (НИТРОАММОФОСКА), ГРАНУЛИРОВАННОЕ, С СОДЕРЖАНИЕМ МАССОВОЙ ДОЛИ АЗОТА 16 МАС.%, ФОСФОРА 16 МАС.%, КАЛИЯ 16 МАС.% В ПЕРЕСЧЕТЕ НА СУXОЙ БЕЗВОДНЫЙ ПРОДУКТ, СООТВЕТСТВУЕТ ТУ 2186-039-00203789 -2003, ОБЕСПЕЧИВАЕТ СБАЛАНСИРОВАННОЕ ПИТАНИЕ РАСТЕНИЙ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, В ПОЛИПРОПИЛЕНОВЫХ МЕШКАХ ПО 50 КГ СЛОЖНОЕ АЗОТНО-ФОСФОРНО-КАЛИЙНОЕ МИНЕРАЛЬНОЕ УДОБРЕНИЕ АЗОФОСКА\nОтвет примера 1: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"N\",\n      \"массовая доля\": 16\n    },\n    {\n      \"вещество\": \"P2O5\",\n      \"массовая доля\": 16\n    },\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 16\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"стандарт\",\n      \"значение\": \"ТУ 2186-039-00203789-2003\"\n    },\n    {\n      \"параметр\": \"масса нетто единицы\",\n      \"масса\": 50,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\nТекст примера 2: СУЛЬФАТ КАЛИЯ, ДЛЯ ТЕХНИЧЕСКОГО ИСПОЛЬЗОВАНИЯ. КРИСТАЛЛИЧЕСКИЙ РАССЫПЧАТЫЙ ПОРОШОК БЕЛОГО ЦВЕТА С ЖЕЛТОВАТЫМ ОТТЕНКОМ, НЕ СОДЕРЖАЩИЙ МЕХАНИЧЕСКИХ ПРИМЕСЕЙ,УПАКОВАННЫЙ В БИГ-БЕГИ ПО 1000 КГ+5%. СОСТАВ: МАССОВАЯ ДОЛЯ КАЛИЯ (К2О)-50.0%,SO4 - 52,5% ХЛОР( CI)-1.0% ГИГРОСКОПИЧЕН. :\nОтвет примера 2: {\n  \"массовая доля\": [\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 50.0\n    },\n    {\n      \"вещество\": \"SO4\",\n      \"массовая доля\": 52.5\n    },\n    {\n      \"вещество\": \"Cl\",\n      \"массовая доля\": 1.0\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"масса брутто единицы\",\n      \"масса\": 1050,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\nТекст примера 3: НИТРАТ КАЛЬЦИЯ КОНЦЕНТРИРОВАННЫЙ.ГРАНУЛИРОВАННЫЙ ПРОДУКТ С СОДЕРЖ.МАС.ДОЛИ ОБЩЕГО АЗОТА 17%, АММОНИЙНОГО АЗОТА НЕ БОЛЕЕ 0,5%,КАЛЬЦИЯ НЕ МЕНЕЕ 32%.ПРИМ-СЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ,РОЗНИЧНОЙ ПРОДАЖЕ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ. :\nОтвет примера 3: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"N\",\n      \"массовая доля\": 17\n    },\n    {\n      \"вещество\": \"NH4+\",\n      \"массовая доля\": [null, 0.5]\n    },\n    {\n      \"вещество\": \"Ca\",\n      \"массовая доля\": [32, null]\n    }\n  ],\n  \"прочее\": []\n}\n\nТекст примера 4: КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\nОтвет примера 4: \n{\n  \"массовая доля\": [],\n  \"прочее\": [\n    {\n      \"параметр\": \"стандарт\",\n      \"значение\": \"ТУ 20.15.52-089-05785164-2022\"\n    }\n  ]\n}\n\nТекст примера 5: СУЛЬФАТ КАЛИЯ (СОРТ ЭКСТРА), ДЛЯ ТЕХНИЧЕСКOГО ИСПОЛЬЗОВАНИЯ. КРИСТАЛЛИЧЕСКИЙ РАССЫПЧАТЫЙ ПОРОШОК БЕЛОГО ЦВЕТА С ЖЕЛТОВАТЫМ ОТТЕНКОМ, НЕ СОДЕРЖАЩИЙ МЕХАНИЧЕСКИХ ПРИМЕСЕЙ,УПАКОВАННЫЙ В МЕШКИ ПО 25КГ+-5%, ОБЩИЙ ВЕС БРУТТО С ПАЛЛЕТАМИ 21640 КГ. СОСТАВ:МА МАССОВАЯ ДОЛЯ КАЛИЯ (К2О)-51.0%,SO4 - 51,0% ХЛОР(CI)-1.0%, ГИГРОСКОПИЧЕН. :\nОтвет примера 5: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 51.0\n    },\n    {\n      \"вещество\": \"SO4\",\n      \"массовая доля\": 51.0\n    },\n    {\n      \"вещество\": \"Cl\",\n      \"массовая доля\": 1.0\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"масса брутто единицы\",\n      \"масса\": 26.25,\n      \"единица\": \"кг\"\n    },\n    {\n      \"параметр\": \"масса брутто\",\n      \"масса\": 21640,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\n3. Выводи json результат **только после слова ОТВЕТ:**.\n\nТекст для анализа:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n",
    "prompt_info": null
  },
  "system_info": {
    "api_model": true,
    "multi_agent_mode": null,
    "gpu_info": {
      "api": true
    },
    "gpu_memory_during_inference_gb": 0.0,
    "average_response_time_seconds": 10.872108867168427
  },
  "quality_metrics_summary": {
    "массовая доля": {
      "accuracy": 0.7547468734968735,
      "precision": 0.7328519855595668,
      "recall": 0.7602996254681648,
      "f1": 0.7463235294117646
    },
    "прочее": {
      "accuracy": 0.5186612532766379,
      "precision": 0.520618556701031,
      "recall": 0.5126903553299492,
      "f1": 0.5166240409207161
    }
  }
}