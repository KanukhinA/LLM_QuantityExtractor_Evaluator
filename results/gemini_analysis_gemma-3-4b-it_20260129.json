{
  "model_name": "gemma-3-4b-it",
  "timestamp": "20260129",
  "analysis": "## Экспертная оценка качества работы модели gemma-3-4b-it\n\n### Общая оценка\n\nМодель gemma-3-4b-it демонстрирует крайне низкое качество выполнения поставленной задачи по извлечению численных и количественных характеристик. Метрики Accuracy, Precision, Recall и F1, равные 0.00%, свидетельствуют о полном провале. Основными проблемами являются агрессивные галлюцинации, неспособность строго следовать инструкциям по форматированию и фильтрации данных, а также недостаточное понимание предметной области.\n\n### 1. Характерные ошибки модели\n\n*   **Массовые галлюцинации:** Это наиболее критичная проблема. Модель систематически генерирует числовые значения массовых долей (Пример 1), названия марок (Пример 1) и стандарты (Пример 3), которых нет в исходном тексте. Это прямое нарушение инструкции \"Если признака в тексте нет - не извлекай его и не выводи его в json.\" Модель, похоже, пытается \"додумать\" информацию, основываясь на общих знаниях или примерах из самого промпта.\n*   **Некорректная интерпретация диапазонов и точных значений:**\n    *   Для точных значений (например, `50.0%`) модель ошибочно использует формат диапазона `[X, null]` вместо просто `X` (Пример 3).\n    *   Для условий \"не менее X\" модель формирует неправильный диапазон `[Y, X]` (Пример 2: \"S - НЕ МЕНЕЕ 2%\" -> `[1, 2]`) вместо `[X, null]`.\n    *   Для значений с погрешностью \"X+/-Y\" иногда выводится только одно значение `X` (Пример 2: \"К2О - 30+/-1%\" -> `30`) вместо `[X-Y, X+Y]`.\n*   **Извлечение нерелевантной информации:** Модель извлекает описательные характеристики (\"внешний вид\", \"насыпь\"), которые не являются численными или количественными показателями, как того требует промпт (Пример 2), что нарушает определение задачи.\n*   **Ошибки в форматировании и номенклатуре:** Модель неправильно обозначает химический элемент (CI вместо Cl для хлора в Примере 3), что указывает на недостаточное знание стандартной химической номенклатуры или на неспособность правильно применить правило замены.\n*   **Подражание примерам промпта:** В Примере 3 модель сгенерировала стандарт \"ТУ 2184-037-32496445-02\", который точно скопирован из примера JSON в промпте, несмотря на отсутствие такого стандарта в исходном тексте. Это подтверждает высокую зависимость от формата и содержания примеров, даже в ущерб точности извлечения из текущего текста.\n\n### 2. Причины ошибок парсинга JSON\n\nСамих синтаксических ошибок, которые привели бы к невозможности парсинга JSON, в представленных ответах модели нет. Модель корректно формирует JSON-объекты и массивы. Проблемы заключаются исключительно в **семантической корректности и полноте данных** внутри JSON, а не в его структуре. Однако, если бы модель начала использовать неправильные типы данных (например, строку вместо числа для `масса`), это уже могло бы привести к ошибкам парсинга на стороне потребителя.\n\n### 3. Причины ошибок в извлечении данных\n\n*   **Недостаточное понимание предметной области и целей:** Модель не полностью усвоила, что именно считать \"численными и количественными характеристиками\", и выходит за рамки указанных типов данных.\n*   **Слабая \"заземлённость\" (grounding) на исходный текст:** Модель неспособна жестко привязать свой вывод к содержанию входного текста, что приводит к галлюцинациям. Она не всегда может отличить информацию, присутствующую в тексте, от своих \"знаний по умолчанию\" или примеров из промпта.\n*   **Высокая сложность правил интерпретации:** Многочисленные и детализированные правила для обработки диапазонов, точных значений, операторов \"не менее/не более\" требуют сложного логического анализа, с которым небольшая модель, по-видимому, не справляется.\n*   **Проблема с обобщением правил:** Ошибки в химических символах и игнорирование правила \"не извлекай, если нет\" указывают на трудности с обобщением инструкций и их применением в новых контекстах.\n*   **Вероятная перегрузка промптом:** Объемный промпт с большим количеством инструкций может быть сложен для эффективной обработки небольшой языковой моделью, такой как gemma-3-4b-it.\n\n### 4. Рекомендации по улучшению промпта\n\nПромпт содержит много хороших идей, но для данной модели требуется усиление и уточнение.\n\n*   **Усилить правило \"никаких галлюцинаций\":**\n    *   Добавить в начало промпта (сразу после \"Твоя задача:\") яркое и четкое предупреждение: \"ВАЖНО: ИЗВЛЕКАЙТЕ ТОЛЬКО ТЕ ДАННЫЕ, КОТОРЫЕ ЯВНО ПРИСУТСТВУЮТ В ТЕКСТЕ. НИКОГДА НЕ ГЕНЕРИРУЙТЕ ИНФОРМАЦИЮ (ЧИСЛА, НАЗВАНИЯ), КОТОРОЙ НЕТ В ИСХОДНОМ ТЕКСТЕ. ЕСЛИ ПРИЗНАКА НЕТ, НЕ ВЫВОДИТЕ ЕГО В JSON.\"\n    *   Повторить это правило в \"Особых указаниях\" в усиленной форме: \"ЕСЛИ ПРИЗНАКА В ТЕКСТЕ НЕТ - НЕ ИЗВЛЕКАЙ ЕГО И НИ В КОЕМ СЛУЧАЕ НЕ ВЫВОДИ ЕГО В JSON.\"\n*   **Добавить примеры Few-shot Learning (наиболее важная рекомендация):** Это критически важно для небольшой модели. Добавьте 3-5 высококачественных примеров (полный исходный текст и *идеальный* JSON-вывод) в промпт перед основным текстом для анализа. Примеры должны охватывать:\n    *   Текст, где НЕТ массовых долей и только 1-2 \"прочих\" параметра (например, только стандарт). Идеальный JSON здесь будет почти пустым в \"массовая доля\".\n    *   Текст со всеми типами диапазонов (`X`, `[min, max]`, `[min, null]`, `[null, max]`).\n    *   Текст с `масса брутто` и `масса нетто`.\n    *   Текст, вообще не содержащий извлекаемых численных данных, чтобы модель училась выводить минимальный JSON, как требуется.\n*   **Уточнить правила диапазонов и точных значений:**\n    *   Для точных значений: \"Если число указано как точное значение (например, '50.0%', '2000 кг'), выводи его как просто число (например, `50.0`, `2000`), а не как массив. Массив `[min, max]` используется только для диапазонов или 'не менее/не более'.\"\n    *   Для \"не менее\": \"Для 'не менее X', используй формат `[X, null]`. Например, 'не менее 2%' -> `[2, null]`.\"\n    *   Для \"+/-\": \"Для 'X+/-Y%', используй формат `[X-Y, X+Y]`. Например, '8+/-1%' -> `[7, 9]`.\"\n*   **Более четко определить \"прочие численные показатели\":** Добавить явный запрет на извлечение описательных характеристик. \"Прочие численные показатели: (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы). ИСКЛЮЧИТЬ ЛЮБЫЕ ОПИСАТЕЛЬНЫЕ ХАРАКТЕРИСТИКИ, НЕ ЯВЛЯЮЩИЕСЯ ЧИСЛЕННЫМИ (например, внешний вид, цвет, агрегатное состояние).\"\n*   **Уточнить номенклатуру химических элементов:** \"Если в названии признака есть название химического элемента (например Кальций) - замени его на **стандартное обозначение химического элемента из таблицы Менделеева** (например, Ca для Кальция, Cl для Хлора, S для Серы).\"\n\n### 5. Рекомендации по настройке гиперпараметров\n\n*   **`temperature` (Температура генерации):** Это наиболее важный параметр. Текущее поведение модели с галлюцинациями и \"творчеством\" указывает на высокую температуру. Для задач извлечения данных, где требуется высокая точность и строгое следование инструкциям, `temperature` следует **значительно снизить до очень низкого значения, например, 0.1 - 0.3**. Это уменьшит вероятность галлюцинаций и заставит модель придерживаться наиболее вероятных и буквальных трактовок промпта.\n*   **`max_new_tokens`:** 512 токенов, вероятно, достаточно для большинства ответов. Если после снижения температуры ответы станут обрываться, можно незначительно увеличить.\n*   **`top_p` / `top_k`:** Если доступны, также рекомендуется снизить их значения для уменьшения разнообразия генерации и увеличения детерминированности.\n\n### 6. Общие рекомендации по улучшению качества\n\n*   **Итеративный подход к промптингу:** Внедряйте изменения в промпт пошагово, каждый раз проводя повторное тестирование на всем наборе данных и анализируя новые типы ошибок. Это позволяет постепенно улучшать модель.\n*   **Пост-обработка вывода:** Разработайте небольшой скрипт для пост-обработки JSON-вывода. Он может:\n    *   Проверять JSON на соответствие схеме (наличие обязательных полей, корректные типы данных).\n    *   Удалять галлюцинации (например, если извлечена массовая доля, но в тексте нет числа).\n    *   Корректировать форматы диапазонов, если модель продолжает ошибаться (например, преобразовывать `[X, null]` в `X`, если `null` не оправдан).\n    *   Исправлять известные ошибки номенклатуры (CI -> Cl).\n    Хотя это \"костыль\", он может временно улучшить качество до достижения лучшей производительности самой модели.\n*   **Файн-тюнинг (если есть возможность):** Для столь специфичной и требующей высокой точности задачи, файн-тюнинг модели на большом, специально подготовленном датасете извлечения данных был бы наиболее эффективным долгосрочным решением. Это позволит модели интернализировать все правила и формат.\n*   **Рассмотреть более мощные модели:** Gemma-3-4b-it - относительно небольшая модель. Более крупные и способные LLM (например, Gemma-7b-it, Llama-3-8b-it, а тем более проприетарные модели вроде GPT-3.5/4) обычно лучше справляются со сложными инструкциями и демонстрируют значительно меньшую склонность к галлюцинациям.\n\nТекущие результаты показывают, что `gemma-3-4b-it` не справляется с задачей извлечения данных в текущей конфигурации промпта. Главные усилия должны быть сосредоточены на **добавлении качественных примеров (few-shot learning) и значительном снижении температуры генерации.**",
  "model_used": "gemini-2.5-flash",
  "parsing_errors_count": 100,
  "hyperparameters": {
    "max_new_tokens": 512,
    "api_model": true
  },
  "prompts": {
    "prompt_template": "DETAILED_INSTR_ZEROSHOT",
    "prompt_full_text": "\nТы — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  \nТвоя задача:  \n\n1. Найти все численные признаки в тексте, например:  \n   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  \n   - Количество товара (кг, т, п/э мешки, вагон и др.).  \n   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  \n\n2. Для каждого численного признака определить:  \n   - Название признака (например, \"массовая доля N\", \"массовая доля P2O5\", \"массовая доля К2О\", \"массовая доля S\", \"масса нетто единицы\", \"масса нетто\", \"масса K2O\", \"масса брутто\", \"количество вагонов\", \"стандарт\" и т.д.)  \n   - Значение (число, если есть диапазон — брать оба значения; для стандарта указываешь полный номер стандарта со словами ГОСТ/ТУ или др.)  \n   - Единицу измерения (%, кг, т, шт, п/э меш, вагон, или пусто для стандарта)  \n\n3. Особые указания:\n   - Извлекай на русском\n   - Если признак указан как диапазон из нескольких чисел (например \"8-10\", или \"от 6 до 12\") или с погрешностью (+/-), укажи оба числа в формате [min, max]. \n   - Извлекай логические/сравнительные операторы, если они присутствуют в тексте: «не менее» - [min, null] «не более» - [null, max]\n   - Используй точку в качестве разделителя десятичных чисел.\n   - Название вещества и его массовая доля могут встречаться в марке (например, \"N7-P20-K30-S3\"),  используй данные из марки, если нет иных данных по массовой доле вещества.\n   - Если в названии признака есть название химического элемента (например Кальций) - замени его на обозначение химического элемента - Ca.\n   - Названия признаков пиши с маленькой буквы. Например \"массовая доля Zn\".\n   - Если указано например \"МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О\" - то правильным извлекаемым признаком будет \"массовая доля K2O\".\n   - Если один и тот же параметр встречается дважды — сначала как общее условие (например, «с содержанием азота более 10%»), а затем как конкретное значение (например, «азот 16%»), указывай только конкретное значение.\n   - Для массы с упаковкой - называй признак \"масса брутто\" вне зависимости от наименования упаковки. Если указывается просто масса в формате \"МЕШКИ ПО 50 КГ\" - это признак \"масса нетто\".\n   - Если дается масса в виде \"ПО 1000 КГ+5%\" - указывай в признаке \"масса брутто\" одно значение - 1050.\n   - Для прочих признаков (всех признаков, помимо \"массовой доли\") указывай единицы измерения (за исключением признаков \"марка\" и \"стандарт\")\n   - Если признака в тексте нет - не извлекай его и не выводи его в json.\n\n4 . Выводи строго JSON следующего вида (пример):\n\n```json\n{\n  \"массовая доля\": [\n    {\"вещество\": \"N\", \"массовая доля\": [26, 28]},\n    {\"вещество\": \"P2O5\", \"массовая доля\": [20, null]},\n    {\"вещество\": \"K2O\", \"массовая доля\": 20},\n    {\"вещество\": \"S\", \"массовая доля\": 3},\n    {\"вещество\": \"NH4+\", \"массовая доля\": [null, 2]}\n  ],\n  \"прочее\": [\n    {\"параметр\": \"масса нетто единицы\", \"масса\": 50, \"единица\": \"кг\"},\n    {\"параметр\": \"масса брутто\", \"масса\": 1020, \"единица\": \"кг\"},\n    {\"параметр\": \"количество поддонов\", \"количество\": 20, \"единица\": \"шт\"},\n    {\"параметр\": \"количество мешков\", \"количество\": 1000, \"единица\": \"шт\"},\n    {\"параметр\": \"объем нетто единицы\", \"объем\": 10, \"единица\": \"л\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"ТУ 2184-037-32496445-02\"},\n    {\"параметр\": \"марка\", \"значение\": \"N7-P20-K30-S3\"}\n  ]\n}\n```\n\n5. Выводи json результат **только после слова ОТВЕТ:**.\n\nТекст для анализа:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n",
    "prompt_info": null
  },
  "system_info": {
    "api_model": true,
    "multi_agent_mode": null,
    "gpu_info": {
      "api": true
    },
    "gpu_memory_during_inference_gb": 0.0,
    "average_response_time_seconds": 6.248148729801178
  },
  "quality_metrics_summary": {
    "массовая доля": {
      "accuracy": 0.0,
      "precision": 0.0,
      "recall": 0.0,
      "f1": 0.0
    },
    "прочее": {
      "accuracy": 0.0,
      "precision": 0.0,
      "recall": 0.0,
      "f1": 0.0
    }
  }
}