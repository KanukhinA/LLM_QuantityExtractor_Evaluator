{
  "model_name": "gemma-3-27b-it",
  "timestamp": "20260125_171154",
  "analysis": "Как эксперт по оценке качества работы языковых моделей, я провел анализ результатов тестирования модели gemma-3-27b-it на задаче извлечения численных и количественных характеристик из текстов о химических веществах.\n\n**Общая оценка:**\nМодель демонстрирует средний уровень производительности в извлечении численных характеристик. Отсутствие ошибок парсинга JSON является большим плюсом, указывая на хорошее понимание требуемого формата вывода. Однако, метрики F1-score на уровне 75% для \"массовой доли\" и 52% для \"прочего\" показывают, что есть значительное пространство для улучшения, особенно в категории \"прочее\".\n\n---\n\n### 1. Характерные ошибки модели\n\nИсходя из предоставленных метрик, можно выделить следующие характерные ошибки:\n\n*   **Низкая точность в категории \"Прочее\":** F1-score 51.91% в этой категории является критически низким. Это указывает на то, что модель либо часто пропускает информацию, относящуюся к \"прочему\" (низкий Recall), либо извлекает некорректную информацию, либо неправильно её категоризирует (низкий Precision). Вероятнее всего, проблема комплексная.\n*   **Удовлетворительная, но не идеальная точность в категории \"Массовая доля\":** F1-score 75.09% показывает, что модель чаще всего справляется с извлечением массовой доли, но всё же допускает ошибки. Это могут быть пропуски (False Negatives), некорректное извлечение значения (например, дробная часть вместо целой или наоборот), или ошибочное присвоение вещества (False Positives).\n*   **Возможные проблемы с интерпретацией диапазонов:** Примеры показывают, что модель должна уметь работать с конструкциями \"не более X\" и \"не менее Y\", преобразуя их в `[null, X]` и `[Y, null]` соответственно. Низкая F1-score может быть связана с некорректной интерпретацией этих диапазонов или их пропуском.\n*   **Сложности с разнообразными \"прочими\" параметрами:** Категория \"прочее\" включает в себя стандарты, различные типы массы (нетто, брутто, единицы), и другие показатели. Модель, вероятно, путается в их классификации и точном извлечении. Например, извлечение \"масса брутто единицы\" из \"25КГ+-5%\" требует расчета (26.25 кг), а не простого извлечения числа.\n\n---\n\n### 2. Причины ошибок парсинга JSON\n\n**Ошибок парсинга не обнаружено.** Это очень хороший результат. Модель успешно справляется с задачей формирования валидного JSON-объекта в соответствии с предоставленными примерами и инструкцией. Это свидетельствует о том, что модель хорошо поняла требуемую структуру вывода и правила размещения ключевых слов (например, `ОТВЕТ:`).\n\n---\n\n### 3. Причины ошибок в извлечении данных\n\n*   **Широта и неоднозначность категории \"Прочее\":** Описание \"Прочие численные показатели\" слишком общее. Хотя примеры помогают, разнообразие формулировок и типов \"прочих\" показателей в реальных текстах может быть очень большим, что затрудняет для модели обобщение.\n*   **Сложность контекстного понимания для количественных показателей:** Извлечение массы (нетто/брутто, единицы/общая) часто требует понимания контекста и выполнения простых арифметических операций (как в случае \"1000 КГ+5%\" или \"25КГ+-5%\"). Модель может испытывать трудности с такими расчетами или с определением типа массы.\n*   **Языковые нюансы:** Фразы типа \"не более\", \"не менее\" требуют точной интерпретации и преобразования в формат `[min, max]`. Модель могла не до конца освоить эти языковые конструкции.\n*   **Недостаток разнообразия в обучающих примерах:** Хотя в промпте 5 примеров, реальные данные могут содержать гораздо больше вариаций формулировок и структур, которые не были охвачены этими примерами. Для обучения модели на специализированные задачи обычно требуется значительно больше примеров.\n*   **Внутренние ограничения модели:** Несмотря на размер (27b), gemma может иметь ограничения в глубоком семантическом понимании и точной экстракции конкретных, числовых данных из сложного текста без обширного специализированного обучения.\n\n---\n\n### 4. Рекомендации по улучшению промпта\n\nПромпт достаточно подробный и включает хорошие примеры. Однако, для улучшения метрик, особенно в категории \"прочее\", можно внести следующие изменения:\n\n1.  **Более детальная спецификация категории \"Прочее\":**\n    *   Вместо общего \"Прочие численные показатели\", явно перечислите ожидаемые подкатегории и их формат. Например:\n        ```\n        - Стандарты (ТУ, ГОСТ и др.): \"стандарт\": \"ТУ NNN-NNN-YYYY\"\n        - Масса товара:\n            - Если указана масса в одной упаковке (например, \"мешки по 50 кг\"): \"параметр\": \"масса нетто единицы\", \"масса\": 50, \"единица\": \"кг\"\n            - Если указана масса в одной упаковке с допуском (например, \"мешки по 25КГ+-5%\"): \"параметр\": \"масса брутто единицы\", \"масса\": [минимальное значение, максимальное значение], \"единица\": \"кг\". Расчет должен быть произведен. (Или указать, что ожидается среднее значение, если это допустимо).\n            - Если указан общий вес брутто: \"параметр\": \"масса брутто\", \"масса\": N, \"единица\": \"кг\"\n            - Если указан общий вес нетто: \"параметр\": \"масса нетто\", \"масса\": N, \"единица\": \"кг\"\n            - Если указан вес с процентом (например, \"по 1000 КГ+5%\"), это должно быть интерпретировано как масса брутто единицы, и процент должен быть прибавлен (1050).\n        - Марки: \"параметр\": \"марка\", \"значение\": \"XYZ\"\n        ```\n    *   **Пример 2 и 5:** Четко прописать, как обрабатывать `КГ+5%` и `КГ+-5%` для \"масса брутто единицы\". В примере 2 модель должна была посчитать 1050 кг, в примере 5 - 26.25 кг (25 * 1.05). Это критично для точности.\n2.  **Добавить больше примеров, охватывающих крайние случаи и вариации:**\n    *   Примеры с разными формулировками \"не более/менее\".\n    *   Примеры, где есть числа, но они не должны быть извлечены (отрицательные примеры).\n    *   Примеры с большим количеством \"прочих\" параметров в одном тексте.\n    *   Примеры с различными единицами измерения (т, шт, упаковки).\n3.  **Усиление инструкций по диапазонам:**\n    *   Явно прописать: \"Для значений, указанных как 'не более X', используй формат `[null, X]`. Для значений 'не менее Y', используй `[Y, null]`.\"\n4.  **Визуальное выделение JSON в промпте:**\n    *   Хотя модель и справилась с парсингом, обернуть JSON примеры в тройные обратные кавычки с указанием языка (```json ... ```) может улучшить её способности к синтаксическому пониманию и стабильности форматирования.\n\n---\n\n### 5. Рекомендации по настройке гиперпараметров\n\nПредоставлены только `max_new_tokens` и `model_name`. Предполагая, что используются значения по умолчанию для других параметров, можно дать следующие рекомендации:\n\n*   **`temperature` (Температура):** Если текущая температура выше 0.5, рекомендуется снизить её до диапазона **0.1 - 0.3**. Более низкая температура делает модель более детерминированной и менее склонной к \"галлюцинациям\" или творческим ответам, что критично для задач точного извлечения фактов.\n*   **`top_p` (Top-P Sampling):** Аналогично температуре, снижение `top_p` (например, до **0.8 - 0.9**) может помочь сфокусировать генерацию на наиболее вероятных токенах, уменьшая разнообразие и увеличивая точность.\n*   **`max_new_tokens`:** Значение 512, скорее всего, достаточно, поскольку ошибок парсинга не было (что может быть признаком обрыва ответа). Если в будущем будут встречаться очень длинные JSON-ответы, это значение можно будет увеличить.\n\n---\n\n### 6. Общие рекомендации по улучшению качества\n\n1.  **Сбор и аннотирование большего количества данных:** Это самый эффективный способ улучшить производительность. Чем больше разнообразных текстов с корректно извлеченными JSON-структурами (особенно для сложных случаев в категории \"прочее\"), тем лучше модель будет обобщать и извлекать информацию.\n2.  **Тонкая настройка (Fine-tuning):** Для специализированной задачи, такой как эта, тонкая настройка gemma-3-27b-it на собственном наборе данных является наилучшим подходом. Это позволит модели лучше адаптироваться к специфической терминологии, структуре данных и нюансам формулировок в текстах о химических веществах.\n3.  **Итеративное улучшение промпта и примеров:** Продолжайте анализировать конкретные ошибки модели (если будет доступен её фактический вывод) и используйте их для доработки промпта, добавления новых примеров или уточнения существующих.\n4.  **Применение гибридного подхода:** Для высококритичных данных можно рассмотреть комбинированный подход:\n    *   Использование LLM для извлечения основной информации.\n    *   Добавление пост-обработки с помощью регулярных выражений или простых правил для проверки и исправления наиболее частых ошибок (например, форматирование стандартов, расчеты масс с процентами).\n    *   Человеческая верификация для наиболее сложных или неоднозначных случаев.\n5.  **Разделение сложных задач:** Если категория \"прочее\" продолжает быть проблемой, можно попробовать разбить её на несколько подзадач или использовать более специализированные \"под-модели\" (даже в рамках одного промпта, прося модель сначала извлечь стандарты, потом массы и т.д., и только потом объединить).\n\nУчитывая, что модель хорошо держит формат JSON, основной фокус должен быть на улучшении точности извлечения *содержания*, особенно в слабо определенных или сложных для интерпретации случаях.",
  "model_used": "gemini-2.5-flash",
  "parsing_errors_count": 0,
  "hyperparameters": {
    "max_new_tokens": 512,
    "model_name": "gemma-3-27b-it",
    "api_model": true
  },
  "prompts": {
    "prompt_template": "build_prompt3",
    "prompt_full_text": "\nТы — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  \nТвоя задача:  \n\n1. Найти все численные признаки в тексте, например:  \n   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  \n   - Количество товара (кг, т, п/э мешки, вагон и др.).  \n   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  \n\n2. Выведи json по аналогии с этими примерами:\nТекст примера 1: СЛОЖНОЕ АЗОТНО-ФОСФОРНО-КАЛИЙНОЕ МИНЕРАЛЬНОЕ УДОБРЕНИЕ АЗОФОСКА (НИТРОАММОФОСКА), ГРАНУЛИРОВАННОЕ, С СОДЕРЖАНИЕМ МАССОВОЙ ДОЛИ АЗОТА 16 МАС.%, ФОСФОРА 16 МАС.%, КАЛИЯ 16 МАС.% В ПЕРЕСЧЕТЕ НА СУXОЙ БЕЗВОДНЫЙ ПРОДУКТ, СООТВЕТСТВУЕТ ТУ 2186-039-00203789 -2003, ОБЕСПЕЧИВАЕТ СБАЛАНСИРОВАННОЕ ПИТАНИЕ РАСТЕНИЙ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, В ПОЛИПРОПИЛЕНОВЫХ МЕШКАХ ПО 50 КГ СЛОЖНОЕ АЗОТНО-ФОСФОРНО-КАЛИЙНОЕ МИНЕРАЛЬНОЕ УДОБРЕНИЕ АЗОФОСКА\nОтвет примера 1: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"N\",\n      \"массовая доля\": 16\n    },\n    {\n      \"вещество\": \"P2O5\",\n      \"массовая доля\": 16\n    },\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 16\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"стандарт\",\n      \"значение\": \"ТУ 2186-039-00203789-2003\"\n    },\n    {\n      \"параметр\": \"масса нетто единицы\",\n      \"масса\": 50,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\nТекст примера 2: СУЛЬФАТ КАЛИЯ, ДЛЯ ТЕХНИЧЕСКОГО ИСПОЛЬЗОВАНИЯ. КРИСТАЛЛИЧЕСКИЙ РАССЫПЧАТЫЙ ПОРОШОК БЕЛОГО ЦВЕТА С ЖЕЛТОВАТЫМ ОТТЕНКОМ, НЕ СОДЕРЖАЩИЙ МЕХАНИЧЕСКИХ ПРИМЕСЕЙ,УПАКОВАННЫЙ В БИГ-БЕГИ ПО 1000 КГ+5%. СОСТАВ: МАССОВАЯ ДОЛЯ КАЛИЯ (К2О)-50.0%,SO4 - 52,5% ХЛОР( CI)-1.0% ГИГРОСКОПИЧЕН. :\nОтвет примера 2: {\n  \"массовая доля\": [\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 50.0\n    },\n    {\n      \"вещество\": \"SO4\",\n      \"массовая доля\": 52.5\n    },\n    {\n      \"вещество\": \"Cl\",\n      \"массовая доля\": 1.0\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"масса брутто единицы\",\n      \"масса\": 1050,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\nТекст примера 3: НИТРАТ КАЛЬЦИЯ КОНЦЕНТРИРОВАННЫЙ.ГРАНУЛИРОВАННЫЙ ПРОДУКТ С СОДЕРЖ.МАС.ДОЛИ ОБЩЕГО АЗОТА 17%, АММОНИЙНОГО АЗОТА НЕ БОЛЕЕ 0,5%,КАЛЬЦИЯ НЕ МЕНЕЕ 32%.ПРИМ-СЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ,РОЗНИЧНОЙ ПРОДАЖЕ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ. :\nОтвет примера 3: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"N\",\n      \"массовая доля\": 17\n    },\n    {\n      \"вещество\": \"NH4+\",\n      \"массовая доля\": [null, 0.5]\n    },\n    {\n      \"вещество\": \"Ca\",\n      \"массовая доля\": [32, null]\n    }\n  ],\n  \"прочее\": []\n}\n\nТекст примера 4: КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\nОтвет примера 4: \n{\n  \"массовая доля\": [],\n  \"прочее\": [\n    {\n      \"параметр\": \"стандарт\",\n      \"значение\": \"ТУ 20.15.52-089-05785164-2022\"\n    }\n  ]\n}\n\nТекст примера 5: СУЛЬФАТ КАЛИЯ (СОРТ ЭКСТРА), ДЛЯ ТЕХНИЧЕСКOГО ИСПОЛЬЗОВАНИЯ. КРИСТАЛЛИЧЕСКИЙ РАССЫПЧАТЫЙ ПОРОШОК БЕЛОГО ЦВЕТА С ЖЕЛТОВАТЫМ ОТТЕНКОМ, НЕ СОДЕРЖАЩИЙ МЕХАНИЧЕСКИХ ПРИМЕСЕЙ,УПАКОВАННЫЙ В МЕШКИ ПО 25КГ+-5%, ОБЩИЙ ВЕС БРУТТО С ПАЛЛЕТАМИ 21640 КГ. СОСТАВ:МА МАССОВАЯ ДОЛЯ КАЛИЯ (К2О)-51.0%,SO4 - 51,0% ХЛОР(CI)-1.0%, ГИГРОСКОПИЧЕН. :\nОтвет примера 5: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 51.0\n    },\n    {\n      \"вещество\": \"SO4\",\n      \"массовая доля\": 51.0\n    },\n    {\n      \"вещество\": \"Cl\",\n      \"массовая доля\": 1.0\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"масса брутто единицы\",\n      \"масса\": 26.25,\n      \"единица\": \"кг\"\n    },\n    {\n      \"параметр\": \"масса брутто\",\n      \"масса\": 21640,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\n3. Выводи json результат **только после слова ОТВЕТ:**.\n\nТекст для анализа:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n",
    "prompt_info": null
  },
  "system_info": {
    "api_model": true,
    "multi_agent_mode": null,
    "gpu_info": {
      "api": true
    },
    "gpu_memory_during_inference_gb": 0.0,
    "average_response_time_seconds": 16.366068017482757
  },
  "quality_metrics_summary": {
    "массовая доля": {
      "accuracy": 0.7636754449254449,
      "precision": 0.740072202166065,
      "recall": 0.7620817843866171,
      "f1": 0.7509157509157509
    },
    "прочее": {
      "accuracy": 0.5196325042478889,
      "precision": 0.5230769230769231,
      "recall": 0.5151515151515151,
      "f1": 0.5190839694656489
    }
  }
}