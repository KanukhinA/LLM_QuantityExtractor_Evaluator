{
  "model_name": "gemma-3-27b-it",
  "timestamp": "20251223_230133",
  "analysis": "Как эксперт по оценке качества работы языковых моделей, я проанализировал предоставленные результаты тестирования модели `gemma-3-27b-it` и готов дать детальные рекомендации.\n\n---\n\n### Анализ результатов тестирования модели `gemma-3-27b-it`\n\n**Общая оценка:**\nМодель демонстрирует относительно хорошие показатели для категории \"Массовая доля\" (F1: 88.34%), что указывает на способность эффективно извлекать наиболее стандартизированные данные. Однако, результаты для категории \"Прочее\" значительно хуже (F1: 68.03%), и, что критично, присутствует проблема с генерацией валидного JSON, что делает часть результатов непригодной для автоматической обработки.\n\n---\n\n### 1. Характерные ошибки модели\n\n1.  **Нарушение JSON-формата:** Самая серьезная и часто встречающаяся ошибка — модель не может генерировать валидный JSON. Пример #95 показывает неполный и, возможно, некорректно структурированный JSON, который обрывается на середине, что делает парсинг невозможным.\n2.  **Непоследовательность в структуре JSON (даже когда он частично валиден):** Модель, похоже, интерпретирует требование к структуре \"Название признака, Значение, Единица измерения\" по-своему, создавая в примере #95 структуру `{\"массовая доля\": [{\"вещество\": \"N\", \"массовая доля\": 7}, ...]}`. Это не соответствует явному указанию \"Для каждого численного признака определить: Название признака, Значение, Единицу измерения\", которое предполагает более плоскую структуру объектов для каждого признака, а не вложенный список массовых долей под одним общим ключом.\n3.  **Низкое качество извлечения для категории \"Прочее\":**\n    *   **Пропуски (Recall):** Модель часто пропускает существующие значения (например, `масса нетто: предсказано отсутствует, истина 1035000.0`).\n    *   **Галлюцинации (Precision):** Модель предсказывает значения там, где их нет (например, `масса брутто: предсказано 1035000.0, истина отсутствует`).\n    *   **Путаница между похожими понятиями:** Особенно заметна путаница между `масса нетто`, `масса брутто` и `масса нетто единицы`.\n4.  **Пропуски для менее распространенных \"массовых долей\":** Хотя \"Массовая доля\" в целом хороша, модель испытывает трудности с извлечением специфических массовых долей, таких как \"нерастворимого остатка\", \"частиц < 6 мм\", \"H2O\". Это может быть связано с тем, что эти параметры менее \"химически\" или \"элементно\" ориентированы.\n5.  **Некорректное извлечение диапазонов/логических операторов:** Пример `Вещество H2O: предсказано [None, 1.2], истина отсутствует` показывает, что модель может либо галлюцинировать диапазон, либо некорректно интерпретировать \"не более X\" для несуществующего параметра.\n\n---\n\n### 2. Причины ошибок парсинга JSON\n\n1.  **Ограничение `max_new_tokens`:** Наиболее вероятная причина обрыва JSON-ответа (Текст #95). Если текст содержит много численных характеристик, 512 токенов может быть недостаточно для полной генерации валидного и развернутого JSON-объекта, особенно если модель использует многословные ключи или сложную вложенную структуру.\n2.  **Недостаточно строгий контроль формата:** Хотя промпт дает много указаний по содержанию, он **не предоставляет явный JSON-схему или пример полного JSON-объекта**, который модель должна сгенерировать. Это дает модели слишком много свободы в формировании структуры, что приводит к неконсистентным или невалидным ответам.\n3.  **Внутренние склонности модели:** Некоторые LLM по умолчанию могут испытывать трудности с точной генерацией JSON, особенно при длинных или сложных структурах, если их специально не обучать на таких задачах или не использовать дополнительные механизмы контроля.\n\n---\n\n### 3. Причины ошибок в извлечении данных\n\n1.  **Расплывчатость категории \"Прочее\":** Описание \"Прочие численные показатели\" очень широкое. Отсутствие конкретных примеров или детализированных правил для этих показателей затрудняет их точное извлечение.\n2.  **Семантическая близость/перекрытие:** Понятия `масса нетто`, `масса брутто`, `масса нетто единицы` очень близки по смыслу, но отличаются важными нюансами. Модель может не улавливать эти тонкие различия без более явных инструкций или контекстных примеров в промпте.\n3.  **Недостаточное покрытие \"крайних\" случаев:** Для \"Массовых долей\", модель хорошо справляется с основными элементами (N, P, K), но пропускает или ошибается в более специфичных случаях (нерастворимый остаток, влага, фракции частиц), вероятно, из-за их меньшей представленности в обучающих данных или сложности текста.\n4.  **Неполное выполнение инструкций по диапазонам/операторам:** Несмотря на явные указания, модель может некорректно применять правила для `[min, null]` или `[null, max]` или не извлекать их вовсе.\n5.  **Контекстная зависимость:** Некоторые параметры могут быть сильно контекстно-зависимыми. Без глубокого понимания контекста всего документа, модель может делать ошибки.\n\n---\n\n### 4. Рекомендации по улучшению промпта\n\n1.  **Предоставить явный JSON-схему и пример:** Это самое важное. Вместо описания структуры словами, покажите модели, как должен выглядеть конечный JSON.\n    *   **Пример желаемой структуры:**\n        ```json\n        [\n          {\"название признака\": \"массовая доля N\", \"значение\": 7.0, \"единица измерения\": \"%\"},\n          {\"название признака\": \"массовая доля P2O5\", \"значение\": 3.0, \"единица измерения\": \"%\"},\n          {\"название признака\": \"массовая доля K2O\", \"значение\": [6.0, 8.0], \"единица измерения\": \"%\"},\n          {\"название признака\": \"массовая доля H2O\", \"значение\": [null, 1.2], \"единица измерения\": \"%\"},\n          {\"название признака\": \"масса нетто\", \"значение\": 1035000.0, \"единица измерения\": \"кг\"},\n          {\"название признака\": \"стандарт\", \"значение\": \"ГОСТ 12345-2023\", \"единица измерения\": \"\"}\n        ]\n        ```\n    *   Включите эту структуру непосредственно в промпт, например: \"Твой ответ должен быть валидным JSON-массивом объектов. Каждый объект должен иметь ключи 'название признака', 'значение' и 'единица измерения'. Вот пример структуры: [ПОКАЗАТЬ ПРИМЕР]\"\n\n2.  **Уточнить правила для \"Прочее\":**\n    *   Добавьте больше конкретных примеров для `масса нетто`, `масса брутто`, `масса нетто единицы` и четко опишите, как их различать. Например: \"Внимательно различай 'масса нетто' (вес продукта без упаковки), 'масса брутто' (вес продукта с упаковкой) и 'масса нетто единицы' (вес одной упаковки продукта).\"\n    *   Уточнить, что делать, если `масса нетто` и `масса брутто` упомянуты вместе.\n\n3.  **Добавить примеры для сложных случаев \"Массовой доли\":** Включите в промпт примеры извлечения \"нерастворимого остатка\", \"частиц\", \"H2O\" с правильным форматированием.\n\n4.  **Завершить оборванную инструкцию:** Промпт обрывается на \"...а затем как конкр\". Завершите это предложение, например: \"...а затем как конкретное значение, извлекай **конкретное значение** (перезаписывай его).\" или \"... **оба значения** (как диапазон или отдельными сущностями)\".\n\n5.  **Повторить и выделить ключевые форматирующие требования:** Например, \"Используй точку в качестве разделителя десятичных чисел.\" и \"Названия признаков пиши с маленькой буквы. Например \"массовая доля Zn\".\"\n\n---\n\n### 5. Рекомендации по настройке гиперпараметров\n\n1.  **Увеличить `max_new_tokens`:** Это критически важно для решения проблемы с обрывом JSON. Увеличьте значение как минимум до 1024, а лучше до 2048, чтобы дать модели достаточно пространства для генерации полного и сложного JSON-объекта, особенно если количество извлекаемых признаков в тексте может быть большим.\n2.  **Понизить `temperature`:** Если `temperature` не задан (используется значение по умолчанию, которое часто бывает 0.7-1.0), установите его на более низкое значение, например, **0.1-0.3**. Более низкая температура делает генерацию более детерминированной и менее \"креативной\", что крайне важно для задач по извлечению структурированных данных и генерации JSON.\n3.  **Опционально: Настроить `top_p` и `top_k`:** Если проблемы с консистентностью JSON сохраняются, можно попробовать уменьшить `top_p` (например, до 0.8-0.9) или `top_k` (например, до 40-50). Это дополнительно сузит пространство выбора токенов и может способствовать более стабильной генерации.\n\n---\n\n### 6. Общие рекомендации по улучшению качества\n\n1.  **Использование Few-shot Learning (Примеры в промпте):** Включите 1-3 полноценных примера \"текст -> правильный JSON-ответ\" непосредственно в промпт. Это значительно помогает модели понять желаемый формат вывода и логику извлечения. Эти примеры должны охватывать различные типы признаков и сложности.\n2.  **Итеративная доработка промпта:** Внедрите предложенные изменения в промпт и гиперпараметры, затем повторите тестирование. Анализируйте новые ошибки и корректируйте промпт до тех пор, пока качество не достигнет желаемого уровня.\n3.  **Аугментация данных (если возможно):** Если модель будет дообучаться, сосредоточьтесь на создании обучающих данных, которые включают:\n    *   Больше примеров для категории \"Прочее\", особенно для `масса нетто`/`брутто` с четким контекстом.\n    *   Примеры с менее распространенными массовыми долями (H2O, нерастворимый остаток, частицы).\n    *   Примеры с различными форматами диапазонов и логическими операторами.\n4.  **Использование внешних инструментов для валидации JSON:** В производственной среде можно добавить слой валидации JSON после генерации моделью. Если JSON невалиден, можно либо попытаться исправить его простыми средствами, либо запросить повторную генерацию у модели (Self-correction).\n5.  **Разделение сложных задач (если F1 \"Прочее\" не улучшится):** Если \"Прочее\" продолжит сильно отставать, возможно, стоит рассмотреть разбиение задачи. Например, сначала извлекать \"массовые доли\", затем отдельным промптом или шагом извлекать \"прочее\". Это может помочь модели сфокусироваться на каждой подзадаче.\n\n---",
  "model_used": "gemini-2.5-flash",
  "parsing_errors_count": 1,
  "quality_metrics_summary": {
    "массовая доля": {
      "precision": 0.90234375,
      "recall": 0.8651685393258427,
      "f1": 0.8833652007648183
    },
    "прочее": {
      "precision": 0.7074468085106383,
      "recall": 0.6551724137931034,
      "f1": 0.6803069053708442
    }
  }
}