{
  "timestamp": "20260110_174416",
  "model_name": "gemma-3-4b-it",
  "interrupted": false,
  "processed_count": 100,
  "total_count": 100,
  "multi_agent_mode": "simple_4agents",
  "gpu_info": {
    "api": true
  },
  "gpu_memory_after_load_gb": 0.0,
  "gpu_memory_during_inference_gb": 0.0,
  "gpu_memory_during_inference_max_gb": 0.0,
  "gpu_memory_during_inference_min_gb": 0.0,
  "api_model": true,
  "average_response_time_seconds": 12.355614950656891,
  "parsing_error_rate": 0.46,
  "parsing_errors_count": 46,
  "quality_metrics": {
    "массовая доля": {
      "средняя_точность": 0.01568627450980392,
      "precision": 0.053763440860215055,
      "recall": 0.023148148148148147,
      "f1": 0.032362459546925564,
      "tp": 5,
      "fp": 88,
      "fn": 211,
      "количество_сравнений": 85,
      "ошибки": [
        "Вещество сернистый: предсказано [0.0, 89.0], истина отсутствует",
        "Вещество N: предсказано 5.0, истина отсутствует",
        "Вещество K2O: предсказано [20.0, 52.0], истина отсутствует",
        "Вещество P2O5: предсказано 20.0, истина отсутствует",
        "Вещество N: предсказано [15.0, 17.0], истина [7.0, 9.0]",
        "Вещество S: предсказано [2.0, 3.0], истина [2.0, None]",
        "Вещество Cl: предсказано отсутствует, истина 1.0",
        "Вещество K2O: предсказано отсутствует, истина 50.0",
        "Вещество SO4: предсказано отсутствует, истина 52.5",
        "Вещество N: предсказано [20.0, None], истина 20.0"
      ]
    },
    "прочее": {
      "средняя_точность": 0.09883966244725739,
      "precision": 0.3116883116883117,
      "recall": 0.11822660098522167,
      "f1": 0.17142857142857143,
      "tp": 24,
      "fp": 53,
      "fn": 179,
      "количество_сравнений": 79,
      "ошибки": [
        "Параметр стандарт: предсказано отсутствует, истина ту 20.15.71-142-05015182-2017",
        "Параметр марка: предсказано отсутствует, истина npks-8 (npk 8:20:30)",
        "Параметр масса брутто: предсказано отсутствует, истина 1050.0",
        "Параметр количество вагонов: предсказано отсутствует, истина 15.0",
        "Параметр стандарт: предсказано отсутствует, истина ту 2181-073-05761695-2016",
        "Параметр масса нетто: предсказано отсутствует, истина 1035000.0",
        "Параметр масса брутто: предсказано 1050.0, истина отсутствует",
        "Параметр марка: предсказано отсутствует, истина npk 16-16-16",
        "Параметр вес реквизита крепления: предсказано отсутствует, истина 1584.0",
        "Параметр масса стрейч-пленки: предсказано отсутствует, истина 540.0"
      ]
    }
  },
  "hyperparameters": {
    "max_new_tokens": 512,
    "model_name": "gemma-3-4b-it",
    "api_model": true,
    "multi_agent_mode": "simple_4agents"
  },
  "prompt_template": "build_prompt3",
  "prompt_full_text": "МУЛЬТИАГЕНТНЫЙ РЕЖИМ: simple_4agents\n\n================================================================================\nПРОМПТ 1: ИЗВЛЕЧЕНИЕ ЧИСЛОВЫХ ФРАГМЕНТОВ\n================================================================================\n\nТы — эксперт по поиску числовых фрагментов в текстах о химических веществах и удобрениях.\n\nТвоя задача: найти и извлечь все фрагменты текста, которые содержат числовые значения или количественные характеристики.\n\nИщи:\n- Числа с единицами измерения (%, кг, т, шт, п/э меш, вагон, л и др.)\n- Диапазоны чисел (например, \"8-10\", \"от 6 до 12\", \"+/-0.5\")\n- Числа с операторами сравнения (\"не менее\", \"не более\", \"более\", \"менее\")\n- Марки удобрений (например, \"N7-P20-K30-S3\")\n- Стандарты (ГОСТ, ТУ и др.)\n- Любые другие числовые упоминания\n\nВАЖНО:\n- Выведи ТОЛЬКО список найденных числовых фрагментов, каждый на отдельной строке\n- НЕ выводи инструкции, объяснения или просьбы выполнить задание\n- НЕ выводи текст \"пожалуйста выполните задание\" или подобные фразы\n- Если числовых фрагментов нет, выведи ТОЛЬКО: \"Числовых фрагментов не найдено\"\n- Выведи результат сразу, без дополнительных комментариев\n\nПример текста, из которого можно извлечь числовые фрагменты:\nНИТРОАММОФОСКА(АЗОФОCКА),УДОБРЕНИЕ МИНЕРАЛЬНОЕ,СОДЕРЖАЩЕЕ ТРИ ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА - АЗОТ-16% +-1%, ФОСФОР-16%,КАЛИЙ-16%,НАСЫПЬЮ. ПОСТАВЛЯЕТСЯ В МЕШКАХ ПО 50 КГ.:\n\nПример извлечения числовых фрагментов из этого текста:\nАЗОТ-16% +-1%\nФОСФОР-16%\nКАЛИЙ-16%\nВ МЕШКАХ ПО 50 КГ.\n\nТекст для извлечения числовых фрагментов:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\n\n================================================================================\nПРОМПТ 2: ИЗВЛЕЧЕНИЕ МАССОВЫХ ДОЛЕЙ\n================================================================================\n\nТы — эксперт по извлечению массовых долей элементов из текстов об удобрениях.\n\nТвоя задача: из найденных числовых фрагментов извлечь только информацию о массовых долях химических элементов.\n\nМассовая доля может быть указана:\n- Прямо: \"массовая доля N 26%\", \"азот 16%\", \"N 26-28%\"\n- В марке: \"N7-P20-K30-S3\" означает N=7%, P2O5=20%, K2O=30%, S=3%\n- С операторами: \"не менее 10%\", \"не более 20%\"\n\nПравила:\n- Если указано \"МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О\" - это \"массовая доля K2O\"\n- Если в марке указана доля - используй её, если нет прямого указания\n- Диапазоны указывай как [min, max]\n- Операторы: «не менее» - [min, null], «не более» - [null, max]\n- Названия элементов заменяй на химические обозначения (Кальций -> Ca)\n- Названия признаков пиши с маленькой буквы\n\nВыведи список найденных массовых долей в формате:\nвещество: значение (или [min, max] для диапазона)\nНапример:\nN: [16, 18]\n\nЕсли массовых долей нет, выведи \"Массовых долей не найдено\".\n\nЧисловые фрагменты для анализа:\n[Пример числовых фрагментов из предыдущего шага]\n\n\n================================================================================\nПРОМПТ 3: ИЗВЛЕЧЕНИЕ ПРОЧИХ ПАРАМЕТРОВ\n================================================================================\n\nТы — эксперт по извлечению прочих количественных параметров из текстов об удобрениях.\n\nТвоя задача: из найденных числовых фрагментов извлечь все параметры, КРОМЕ массовых долей элементов.\n\nИщи:\n- Массу нетто единицы (например, \"мешки по 50 кг\" -> масса нетто: 50 кг)\n- Массу брутто (масса с упаковкой)\n- Количество (мешков, поддонов, вагонов и др.)\n- Объем нетто единицы\n- Стандарты (ГОСТ, ТУ и др.)\n- Марки (если не использованы для массовых долей)\n\nПравила:\n- \"МЕШКИ ПО 50 КГ\" -> масса нетто: 50 кг\n- \"ПО 1000 КГ+5%\" -> масса брутто: 1050 кг\n- Для массы с упаковкой всегда \"масса брутто\"\n- Указывай единицы измерения (кроме \"марка\" и \"стандарт\")\n- Если параметра нет - не выводи его\n\nВыведи список найденных параметров в формате:\nпараметр: значение единица\n\nЕсли прочих параметров нет, выведи \"Прочих параметров не найдено\".\n\nЧисловые фрагменты для анализа:\n[Пример числовых фрагментов из предыдущего шага]\n\n\n================================================================================\nПРОМПТ 4: ФОРМИРОВАНИЕ JSON\n================================================================================\n\nТы агент, который формирует структурированный ответ в формате JSON.\n\n1. Объедини все массовые доли и прочие параметры в один JSON, строго по показанному образцу ниже.\n2. Если каких-то данных нет — выведи пустой список [] для этого поля.\n3. Все числа дай через точку, если есть десятичные.\n4. Для диапазона используй [min, max], [min, null] или [null, max].\n5. Для \"стандарт\" и \"марка\" используй поле \"значение\".\n6. Строго следуй названию каждого поля как в примере! Не добавляй ничего лишнего.\n\nПример ответа:\nОТВЕТ:\n```json\n{\n  \"массовая доля\": [\n    {\"вещество\": \"N\", \"массовая доля\": [26, 28]},\n    {\"вещество\": \"P2O5\", \"массовая доля\": [20, null]},\n    {\"вещество\": \"K2O\", \"массовая доля\": 20},\n    {\"вещество\": \"S\", \"массовая доля\": 3}\n  ],\n  \"прочее\": [\n    {\"параметр\": \"масса нетто единицы\", \"масса\": 50, \"единица\": \"кг\"},\n    {\"параметр\": \"масса брутто\", \"масса\": 1020, \"единица\": \"кг\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"ТУ 2184-037-32496445-02\"},\n    {\"параметр\": \"марка\", \"значение\": \"N7-P20-K30-S3\"}\n  ]\n}\n\nВ начале обязательно выведи: ОТВЕТ:\n\nВозьми данные для заполнения json отсюда:\n\nМассовые доли:\n[Пример массовых долей из предыдущего шага]\n\nПрочие параметры:\n[Пример прочих параметров из предыдущего шага]\n\n",
  "prompt_info": {
    "mode": "simple_4agents",
    "prompts_used": [
      "NUMERIC_FRAGMENTS_EXTRACTION_PROMPT",
      "MASS_FRACTION_EXTRACTION_PROMPT",
      "OTHER_PARAMETERS_EXTRACTION_PROMPT",
      "JSON_FORMATION_PROMPT"
    ],
    "example_numeric_fragments_prompt": "\nТы — эксперт по поиску числовых фрагментов в текстах о химических веществах и удобрениях.\n\nТвоя задача: найти и извлечь все фрагменты текста, которые содержат числовые значения или количественные характеристики.\n\nИщи:\n- Числа с единицами измерения (%, кг, т, шт, п/э меш, вагон, л и др.)\n- Диапазоны чисел (например, \"8-10\", \"от 6 до 12\", \"+/-0.5\")\n- Числа с операторами сравнения (\"не менее\", \"не более\", \"более\", \"менее\")\n- Марки удобрений (например, \"N7-P20-K30-S3\")\n- Стандарты (ГОСТ, ТУ и др.)\n- Любые другие числовые упоминания\n\nВАЖНО:\n- Выведи ТОЛЬКО список найденных числовых фрагментов, каждый на отдельной строке\n- НЕ выводи инструкции, объяснения или просьбы выполнить задание\n- НЕ выводи текст \"пожалуйста выполните задание\" или подобные фразы\n- Если числовых фрагментов нет, выведи ТОЛЬКО: \"Числовых фрагментов не найдено\"\n- Выведи результат сразу, без дополнительных комментариев\n\nПример текста, из которого можно извлечь числовые фрагменты:\nНИТРОАММОФОСКА(АЗОФОCКА),УДОБРЕНИЕ МИНЕРАЛЬНОЕ,СОДЕРЖАЩЕЕ ТРИ ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА - АЗОТ-16% +-1%, ФОСФОР-16%,КАЛИЙ-16%,НАСЫПЬЮ. ПОСТАВЛЯЕТСЯ В МЕШКАХ ПО 50 КГ.:\n\nПример извлечения числовых фрагментов из этого текста:\nАЗОТ-16% +-1%\nФОСФОР-16%\nКАЛИЙ-16%\nВ МЕШКАХ ПО 50 КГ.\n\nТекст для извлечения числовых фрагментов:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n",
    "example_mass_fractions_prompt": "\nТы — эксперт по извлечению массовых долей элементов из текстов об удобрениях.\n\nТвоя задача: из найденных числовых фрагментов извлечь только информацию о массовых долях химических элементов.\n\nМассовая доля может быть указана:\n- Прямо: \"массовая доля N 26%\", \"азот 16%\", \"N 26-28%\"\n- В марке: \"N7-P20-K30-S3\" означает N=7%, P2O5=20%, K2O=30%, S=3%\n- С операторами: \"не менее 10%\", \"не более 20%\"\n\nПравила:\n- Если указано \"МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О\" - это \"массовая доля K2O\"\n- Если в марке указана доля - используй её, если нет прямого указания\n- Диапазоны указывай как [min, max]\n- Операторы: «не менее» - [min, null], «не более» - [null, max]\n- Названия элементов заменяй на химические обозначения (Кальций -> Ca)\n- Названия признаков пиши с маленькой буквы\n\nВыведи список найденных массовых долей в формате:\nвещество: значение (или [min, max] для диапазона)\nНапример:\nN: [16, 18]\n\nЕсли массовых долей нет, выведи \"Массовых долей не найдено\".\n\nЧисловые фрагменты для анализа:\n[Пример числовых фрагментов]\n",
    "example_other_parameters_prompt": "\nТы — эксперт по извлечению прочих количественных параметров из текстов об удобрениях.\n\nТвоя задача: из найденных числовых фрагментов извлечь все параметры, КРОМЕ массовых долей элементов.\n\nИщи:\n- Массу нетто единицы (например, \"мешки по 50 кг\" -> масса нетто: 50 кг)\n- Массу брутто (масса с упаковкой)\n- Количество (мешков, поддонов, вагонов и др.)\n- Объем нетто единицы\n- Стандарты (ГОСТ, ТУ и др.)\n- Марки (если не использованы для массовых долей)\n\nПравила:\n- \"МЕШКИ ПО 50 КГ\" -> масса нетто: 50 кг\n- \"ПО 1000 КГ+5%\" -> масса брутто: 1050 кг\n- Для массы с упаковкой всегда \"масса брутто\"\n- Указывай единицы измерения (кроме \"марка\" и \"стандарт\")\n- Если параметра нет - не выводи его\n\nВыведи список найденных параметров в формате:\nпараметр: значение единица\n\nЕсли прочих параметров нет, выведи \"Прочих параметров не найдено\".\n\nЧисловые фрагменты для анализа:\n[Пример числовых фрагментов]\n",
    "example_json_formation_prompt": "\nТы агент, который формирует структурированный ответ в формате JSON.\n\n1. Объедини все массовые доли и прочие параметры в один JSON, строго по показанному образцу ниже.\n2. Если каких-то данных нет — выведи пустой список [] для этого поля.\n3. Все числа дай через точку, если есть десятичные.\n4. Для диапазона используй [min, max], [min, null] или [null, max].\n5. Для \"стандарт\" и \"марка\" используй поле \"значение\".\n6. Строго следуй названию каждого поля как в примере! Не добавляй ничего лишнего.\n\nПример ответа:\nОТВЕТ:\n```json\n{\n  \"массовая доля\": [\n    {\"вещество\": \"N\", \"массовая доля\": [26, 28]},\n    {\"вещество\": \"P2O5\", \"массовая доля\": [20, null]},\n    {\"вещество\": \"K2O\", \"массовая доля\": 20},\n    {\"вещество\": \"S\", \"массовая доля\": 3}\n  ],\n  \"прочее\": [\n    {\"параметр\": \"масса нетто единицы\", \"масса\": 50, \"единица\": \"кг\"},\n    {\"параметр\": \"масса брутто\", \"масса\": 1020, \"единица\": \"кг\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"ТУ 2184-037-32496445-02\"},\n    {\"параметр\": \"марка\", \"значение\": \"N7-P20-K30-S3\"}\n  ]\n}\n\nВ начале обязательно выведи: ОТВЕТ:\n\nВозьми данные для заполнения json отсюда:\n\nМассовые доли:\n[Пример массовых долей]\n\nПрочие параметры:\n[Пример прочих параметров]\n"
  },
  "parsing_errors": [
    "Текст #2: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #4: невалидный JSON. Ответ: {\n  \"массовая доля\": [],\n  \"прочее\": [\n    {\"параметр\": \"масса брутто\", \"масса\": 1035000.00, \"единица\": \"кг\"},\n    {\"параметр\": \"количество\", \"масса\": 15, \"единица\": \"Ж/Д ВАГОНОВ\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"\"},\n    {\"параметр\": \"марка\", \"значение\": \"\"}\n  ]\n}",
    "Текст #6: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #8: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #9: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #10: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #11: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #14: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #15: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #18: невалидный JSON. Ответ: {\n  \"массовая доля\": [],\n  \"прочее\": [\n    {\"параметр\": \"масса брутто\", \"масса\": 20980, \"единица\": \"кг\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"\"},\n    {\"параметр\": \"марка\", \"значение\": \"\"}\n  ]\n}",
    "Текст #21: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #22: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #23: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #27: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #29: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #30: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #36: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #37: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #38: невалидный JSON. Ответ: {\n  \"массовая доля\": [],\n  \"прочее\": [\n    {\"параметр\": \"количество мешков\", \"масса\": 40, \"единица\": \"шт\"},\n    {\"параметр\": \"количество мешков\", \"масса\": 632, \"единица\": \"шт\"},\n    {\"параметр\": \"количество поддонов\", \"масса\": 16, \"единица\": \"шт\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"\"},\n    {\"параметр\": \"марка\", \"значение\": \"\"}\n  ]\n}",
    "Текст #39: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #44: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #46: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #48: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #49: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #52: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #58: невалидный JSON. Ответ: {\n  \"массовая доля\": [],\n  \"прочее\": [\n    {\"параметр\": \"масса нетто единицы\", \"масса\": 470, \"единица\": \"кг\"},\n    {\"параметр\": \"масса нетто\", \"масса\": 9.4, \"единица\": \"кг\"},\n    {\"параметр\": \"количество\", \"масса\": 50, \"единица\": \"шт\"},\n    {\"параметр\": \"количество\", \"масса\": 1, \"единица\": \"ПАЛЛЕТЕ\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"\"},\n    {\"параметр\": \"марка\", \"значение\": \"\"}\n  ]\n}",
    "Текст #61: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #62: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #63: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #64: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #65: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #69: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #70: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #73: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #74: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #76: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #77: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #78: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #80: невалидный JSON. Ответ: {\n  \"массовая доля\": [\n    {\"вещество\": \"N\", \"массовая доля\": [15.5, null]},\n    {\"вещество\": \"Ca\", \"массовая доля\": [26.6, null]}\n  ],\n  \"прочее\": [\n    {\"параметр\": \"масса нетто единицы\", \"масса\": 25, \"единица\": \"кг\"},\n    {\"параметр\": \"масса брутто\", \"масса\": 376, \"единица\": \"кг\"},\n    {\"параметр\": \"масса брутто\", \"масса\": 131384.000, \"единица\": \"кг\"},\n    {\"параметр\": \"объем\", \"масса\": 2, \"единица\": \"мм\"},\n    {\"параметр\": \"объем\", \"масса\": 4, \"единица\": \"мм\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"\"},\n    {\"параметр\": \"марка\", \"значение\": \"\"}\n  ]\n}",
    "Текст #82: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #84: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #86: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #91: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #92: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses",
    "Текст #93: невалидный JSON. Ответ: {\n  \"массовая доля\": [],\n  \"прочее\": [\n    {\"параметр\": \"масса брутто\", \"масса\": 1050, \"единица\": \"кг\"},\n    {\"параметр\": \"стандарт\", \"значение\": \"\"},\n    {\"параметр\": \"марка\", \"значение\": \"\"}\n  ]\n}",
    "Текст #97: ошибка в мультиагентном подходе. Ошибка: Agents 2 and 3 returned empty responses"
  ],
  "total_samples": 100,
  "valid_json_count": 54,
  "invalid_json_count": 46,
  "gemini_analysis": {
    "status": "success",
    "analysis": "## Анализ результатов тестирования модели gemma-3-4b-it\n\n**Общий вывод:** Производительность модели на текущем этапе крайне низкая, о чем свидетельствуют очень низкие метрики Precision, Recall и F1 для обеих категорий. Основной проблемой является фундаментальная ошибка в мультиагентном подходе и, вероятно, некорректное предоставление промптов модели, в частности, усеченный промпт для второй задачи. Модель не справляется с поставленными задачами извлечения информации.\n\n### 1. Характерные ошибки модели\n\n1.  **Полный провал мультиагентного режима:** Наиболее критичная ошибка – 46 случаев (из неопределенного общего количества, но это значительная доля) с ошибкой \"Agents 2 and 3 returned empty responses\". Это указывает на то, что мультиагентная архитектура либо некорректно реализована для данной модели, либо модель gemma-3-4b-it не способна адекватно обрабатывать такие сложные инструкции.\n2.  **Низкое качество извлечения данных:**\n    *   **Массовая доля:** Крайне низкие метрики (F1: 3.24%) показывают, что модель практически не справляется с задачей. Примеры ошибок демонстрируют как **ложные срабатывания (False Positives)**, где модель предсказывает значения, когда их нет (например, \"Вещество N: предсказано 5.0, истина отсутствует\"), так и **неправильные значения** при наличии истины (\"Вещество N: предсказано [15.0, 17.0], истина [7.0, 9.0]\"). Это указывает на проблемы с пониманием контекста и точностью извлечения.\n    *   **Прочее (числовые фрагменты):** Несмотря на чуть лучшие, но все еще очень плохие метрики (F1: 17.14%), здесь преобладают **ложные отрицания (False Negatives)**. Модель полностью игнорирует или не извлекает важные числовые фрагменты, такие как стандарты (ТУ, ГОСТ), марки удобрений, массы и количества. Это говорит о недостаточном Recall.\n3.  **Непоследовательное следование инструкциям:** Несмотря на явные негативные ограничения в промпте 1 (\"НЕ выводи инструкции...\"), сама природа ошибки (мультиагентный режим) указывает на нарушение высокоуровневых инструкций. Если модель пытается работать в режиме, который не поддерживается или некорректно настроен, это будет проявляться в ошибках.\n\n### 2. Причины ошибок парсинга JSON\n\nОсновная причина ошибок парсинга JSON напрямую связана с сообщением \"Agents 2 and 3 returned empty responses\".\n\n1.  **Несовместимость или некорректная реализация мультиагентного режима:** Gemma-3-4b-it – относительно небольшая модель. Она может не быть достаточно сложной или не обладать достаточной инструкционной настройкой для работы в полноценном \"мультиагентном\" режиме, где ожидается, что она будет генерировать структурированные ответы от нескольких \"агентов\" в рамках одного промпта/ответа. Скорее всего, это проблема либо в самой модели, либо в способе, которым `simple_4agents` оркестрирует взаимодействие с ней.\n2.  **Отсутствие или усечение промптов для агентов 2 и 3:** Исходя из представленных данных, **промпт для задачи 2 (\"ИЗВЛЕЧЕНИЕ МАССОВЫХ ДОЛЕЙ\") обрезан** (\"Ты — эксперт по изв\"). Если `simple_4agents` предполагает, что каждый агент получает свой полный промпт, то отсутствие полного промпта для агентов 2 и 3 (или других агентов, если их больше) логично приведет к пустым ответам. Это критическая ошибка в подготовке входных данных для тестирования.\n3.  **Неструктурированный или неявный вывод для мультиагентного режима:** Если мультиагентный режим требует структурированного вывода (например, JSON с отдельными полями для каждого агента), а модель генерирует обычный текст или вообще ничего, то парсер не сможет обработать ответ. \"Empty responses\" прямо указывают на отсутствие вообще какого-либо ответа от этих \"агентов\".\n\n### 3. Причины ошибок в извлечении данных\n\n1.  **Обрезанный промпт для \"Массовой доли\":** Это самая очевидная и фатальная причина провала в этой категории. Модель не получила полные инструкции для выполнения задачи, что делает невозможным ее корректное выполнение.\n2.  **Влияние неработающего мультиагентного режима:** Если модель получает запутанные или неполные инструкции из-за сбоев в мультиагентной оркестровке, ее способность выполнять даже те задачи, для которых промпт был относительно полным (как для \"Прочее\"), будет сильно снижена. Модель может быть дезориентирована, пытаться угадать, что от нее требуется, или просто генерировать пустые ответы.\n3.  **Ограничения модели gemma-3-4b-it:**\n    *   **Размер модели:** Для такой специализированной и точной задачи, как извлечение числовых данных, включая диапазоны, стандарты и марки, gemma-3-4b-it может быть недостаточно мощной без дополнительной доработки (fine-tuning) на целевом домене.\n    *   **Отсутствие доменной специфики:** Хотя промпты пытаются задать роль \"эксперта\", модель без предварительного обучения на большом объеме текстов о химических веществах и удобрениях может испытывать трудности с пониманием нюансов и специфических паттернов извлечения.\n    *   **Склонность к галлюцинациям (False Positives):** Для \"Массовой доли\" модель часто предсказывает значения, когда их нет. Это может быть связано с низкой уверенностью и попыткой \"угадать\" ответ.\n    *   **Низкий Recall (False Negatives):** Для \"Прочее\" модель пропускает много истинных значений. Это может быть связано с тем, что она слишком консервативна или не распознает все шаблоны, указанные в промпте (например, различные форматы стандартов или марок).\n\n### 4. Рекомендации по улучшению промпта\n\n1.  **Устранить упоминание мультиагентного режима из промпта:** `\"МУЛЬТИАГЕНТНЫЙ РЕЖИМ: simple_4agents\"` — это инструкция для системы-оркестратора, а не для самой модели внутри промпта. Она вводит модель в заблуждение, заставляя ее думать, что она должна как-то реагировать на это.\n2.  **Обеспечить полноту всех промптов:** **Немедленно исправить усеченный промпт для \"Извлечения массовых долей\"**. Каждая задача должна быть полностью и четко описана.\n3.  **Разделение задач:** На данном этапе, учитывая провал мультиагентного режима, рекомендуется:\n    *   **Полностью отказаться от мультиагентного подхода** на уровне промпта для gemma-3-4b-it.\n    *   **Запускать каждую задачу отдельно** с собственным, полностью независимым промптом. Это позволит изолировать проблемы и понять, справляется ли модель с каждой конкретной задачей в идеальных условиях.\n    *   Если необходимо объединить задачи, рассмотрите **последовательный chain-of-thought подход** или **специализированную оркестровку на уровне кода**, а не попытку заставить LLM имитировать нескольких агентов в одном ответе.\n4.  **Уточнить форматы вывода:** Для каждого промпта точно указать ожидаемый формат вывода (например, \"Список элементов, каждый на новой строке\" или \"JSON-объект с ключами 'числовые_фрагменты' и 'массовые_доли'\").\n5.  **Примеры:** Убедиться, что примеры точно отражают все типы сущностей, которые необходимо извлечь, и формат вывода.\n\n### 5. Рекомендации по настройке гиперпараметров\n\n1.  **Отключить `multi_agent_mode: \"simple_4agents\"`:** Это критически важный первый шаг. Данный режим явно не работает или некорректно реализован. Установите его в `none` или `false`.\n2.  **Температура (temperature) и Top-P (top_p):** Если модель продолжает \"галлюцинировать\" (как в случаях с массовой долей), следует понизить `temperature` (например, до 0.1-0.3) и `top_p` (например, до 0.5-0.7). Это сделает ответы более детерминированными и менее склонными к придумыванию информации. Если же проблема в низком Recall, можно попробовать слегка увеличить `temperature` (до 0.5-0.7), но только после отключения мультиагентного режима и полного промпта.\n3.  **`max_new_tokens`:** 512 токенов в целом достаточно для задач извлечения. Если после исправления других проблем будут наблюдаться обрывы ответов, можно увеличить до 1024, но это маловероятная причина текущих проблем.\n\n### 6. Общие рекомендации по улучшению качества\n\n1.  **Приоритет: Исправить архитектуру тестирования:** Прежде чем оценивать модель, необходимо убедиться, что она получает полные и корректные входные данные, и что система оркестровки (если она есть) работает правильно. Текущее тестирование не позволяет объективно оценить способности модели из-за фундаментальных проблем с промптингом и мультиагентным режимом.\n2.  **Повторное тестирование с изолированными задачами:**\n    *   Раздельное тестирование каждого промпта как отдельной задачи для модели (без `multi_agent_mode`).\n    *   Убедиться, что каждый промпт полностью передан.\n    *   Это позволит увидеть базовую производительность модели gemma-3-4b-it на каждой конкретной задаче.\n3.  **Fine-tuning (дообучение) модели:** Для специализированных задач извлечения данных в конкретном домене (химические вещества, удобрения) fine-tuning gemma-3-4b-it на размеченном датасете аналогичных текстов значительно улучшит качество по сравнению с использованием модели \"из коробки\" (zero-shot/few-shot).\n4.  **Рассмотреть более мощные модели:** Если после всех исправлений и потенциального fine-tuning gemma-3-4b-it все еще не достигает целевых метрик, возможно, потребуется использовать более крупную и мощную модель (например, более крупные версии Gemma, Llama 3, Mixtral) с более развитыми способностями к пониманию инструкций и рассуждению.\n5.  **Итеративный анализ ошибок:** Продолжать анализировать конкретные ошибки (ложные срабатывания, пропуски) и настраивать промпты или данные для fine-tuning, чтобы устранить их.\n6.  **Усиление инструкций по отсутствию данных:** В промптах явно указывать, что делать, если информация не найдена (например, \"Если числовых фрагментов нет, выведи ТОЛЬКО: 'Числовых фрагментов не найдено'\" – это хорошая инструкция, убедиться, что модель ее следует).",
    "model_used": "gemini-2.5-flash"
  }
}