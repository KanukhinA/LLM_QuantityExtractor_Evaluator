{
  "timestamp": "20260120_230545",
  "model_name": "google/gemma-2-2b-it",
  "interrupted": false,
  "processed_count": 100,
  "total_count": 100,
  "multi_agent_mode": "qa_workflow",
  "gpu_info": {
    "cuda_available": true,
    "cuda_version": "12.1",
    "gpu_name": "NVIDIA GeForce RTX 4060 Laptop GPU",
    "gpu_memory_total_gb": 8.0,
    "gpu_memory_allocated_gb": 0.0,
    "gpu_memory_reserved_gb": 0.0,
    "gpu_name_detailed": "NVIDIA GeForce RTX 4060 Laptop GPU",
    "driver_version": "591.74"
  },
  "gpu_memory_after_load_gb": 4.87,
  "gpu_memory_during_inference_gb": 4.88,
  "gpu_memory_during_inference_max_gb": 4.88,
  "gpu_memory_during_inference_min_gb": 4.88,
  "api_model": false,
  "average_response_time_seconds": 39.626745631694796,
  "parsing_error_rate": 0.0,
  "parsing_errors_count": 0,
  "quality_metrics": {
    "массовая доля": {
      "средняя_точность": 0.045787545787545784,
      "precision": 0.08547008547008547,
      "recall": 0.04807692307692308,
      "f1": 0.061538461538461535,
      "tp": 10,
      "fp": 107,
      "fn": 198,
      "количество_сравнений": 91,
      "ошибки": [
        "Вещество P2O5: предсказано [None, 20.0], истина отсутствует",
        "Вещество S: предсказано отсутствует, истина [2.0, None]",
        "Вещество K2O: предсказано отсутствует, истина [29.0, 31.0]",
        "Вещество P2O5: предсказано отсутствует, истина [19.0, 21.0]",
        "Вещество N: предсказано [8.0, 10.0], истина [7.0, 9.0]",
        "Вещество SO4: предсказано отсутствует, истина 52.5",
        "Вещество K2O: предсказано [50.0, None], истина 50.0",
        "Вещество Cl: предсказано отсутствует, истина 1.0",
        "Вещество K2O: предсказано [None, 10.0], истина 10.0",
        "Вещество P2O5: предсказано [10.0, 10.0], истина 10.0"
      ]
    },
    "прочее": {
      "средняя_точность": 0.0024096385542168677,
      "precision": 0.058823529411764705,
      "recall": 0.004672897196261682,
      "f1": 0.008658008658008656,
      "tp": 1,
      "fp": 16,
      "fn": 213,
      "количество_сравнений": 83,
      "ошибки": [
        "Параметр стандарт: предсказано отсутствует, истина ту 20.15.52-089-05785164-2022",
        "Параметр стандарт: предсказано отсутствует, истина ту 20.15.71-142-05015182-2017",
        "Параметр марка: предсказано отсутствует, истина npks-8 (npk 8:20:30)",
        "Параметр масса брутто: предсказано отсутствует, истина 1050.0",
        "Параметр масса: предсказано 1000.0, истина отсутствует",
        "Параметр стандарт: предсказано отсутствует, истина ту 2181-073-05761695-2016",
        "Параметр количество вагонов: предсказано отсутствует, истина 15.0",
        "Параметр масса нетто: предсказано отсутствует, истина 1035000.0",
        "Параметр стандарт: предсказано отсутствует, истина ту 20.15.71-031-00206486-2023",
        "Параметр марка: предсказано отсутствует, истина npk 16-16-16"
      ]
    }
  },
  "hyperparameters": {
    "max_new_tokens": 512,
    "do_sample": false,
    "torch_dtype": "bfloat16",
    "multi_agent_mode": "qa_workflow"
  },
  "prompt_template": "build_prompt3",
  "prompt_full_text": "МУЛЬТИАГЕНТНЫЙ РЕЖИМ: qa_workflow\n\n================================================================================\nПРОМПТ 1: ИЗВЛЕЧЕНИЕ ПИТАТЕЛЬНЫХ ВЕЩЕСТВ\n================================================================================\n\nТекст: КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос: Какие действующие вещества (питательные элементы или их соединения) указаны в этом удобрении? Извлекай только те, что относятся к агрохимическому составу:  \n— Азот как N,  \n— Фосфор как P2O5,  \n— Калий как K2O,  \n— Сера как S,  \n— Кальций как Ca,  \n— Магний как Mg,  \n— Цинк как Zn,  \n— и другие макро-/микроэлементы в стандартной форме.  \n\nЕсли в марке указано, например, \"N7-P20-K30\", извлекай: N, P2O5, K2O.  \nЕсли сказано \"K в пересчёте на K2O\" — указывай K2O.  \nНе включай упаковку, стандарты, массу, объём.\n\nОтвет должен быть строго списком строк в формате JSON. Примеры:\n\nПример текста: Удобрение NPK 16-20-20 содержит азот, фосфор (в виде P2O5) и калий (в виде K2O).\nПример ответа: \n```json\n[\"N\", \"P2O5\", \"K2O\"]\n```\n\nПример текста: Марка N7-P20-K30-S3\nПример ответа: \n```json\n[\"N\", \"P2O5\", \"K2O\", \"S\"]\n```\n\nПример текста: Гранулированное удобрение в мешках по 50 кг. Соответствует ТУ 12345.\nПример ответа: \n```json\n[]\n```\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n\n\n================================================================================\nПРОМПТ 2: ИЗВЛЕЧЕНИЕ МАССОВЫХ ДОЛЕЙ (для каждого вещества)\n================================================================================\n\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакова массовая доля N в удобрении? Учти, что:\n- Если указано \"K в пересчёте на K2O\" — это означает массовую долю K2O.\n- Если значение дано как диапазон (например, \"8–10\" или \"от 6 до 12\"), верни [min, max].\n- Если указано \"не менее X\" — верни [X, null].\n- Если указано \"не более X\" — верни [null, X].\n- Если значение одно — верни число (например, 20).\n- Используй точку как десятичный разделитель.\n- Если информации нет — верни null.\n\nОтвет должен быть только в формате JSON, соответствующим структуре элемента массива \"массовая доля\":\n\nПримеры ответов:\n{\"вещество\": \"N\", \"массовая доля\": [26, 28]}\n{\"вещество\": \"P2O5\", \"массовая доля\": [20, null]}\n{\"вещество\": \"S\", \"массовая доля\": 3}\n{\"вещество\": \"NH4+\", \"массовая доля\": [null, 2]}\n{\"вещество\": \"N\", \"массовая доля\": null}\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n\n\n================================================================================\nПРОМПТ 3: ИЗВЛЕЧЕНИЕ СТАНДАРТА\n================================================================================\n\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакой стандарт (ГОСТ, ТУ, СТО или другой нормативный документ) указан для этого удобрения?  \nЕсли стандарт не указан — верни null.\n\nОтвет должен быть только в формате JSON, соответствующим структуре элемента массива \"прочее\":\n\nПримеры ответов:\n{\"параметр\": \"стандарт\", \"значение\": \"ТУ 2184-037-32496445-02\"}\n{\"параметр\": \"стандарт\", \"значение\": null}\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n\n\n================================================================================\nПРОМПТ 4: ИЗВЛЕЧЕНИЕ МАРКИ\n================================================================================\n\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакая марка удобрения указана (например, N7-P20-K30-S3)?  \nЕсли марка не указана — верни null.\n\nОтвет должен быть только в формате JSON, соответствующим структуре элемента массива \"прочее\":\n\nПримеры ответов:\n{\"параметр\": \"марка\", \"значение\": \"N7-P20-K30-S3\"}\n{\"параметр\": \"марка\", \"значение\": null}\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n\n\n================================================================================\nПРОМПТ 5: ИЗВЛЕЧЕНИЕ КОЛИЧЕСТВ\n================================================================================\n\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакое количество товара указано в тексте? Это может быть:\n- масса (в кг, т и др.),\n- объём (в л, м³ и др.),\n- число упаковок (мешков, канистр, вагонов, поддонов, паллет и т.д.),\n- любая другая числовая характеристика количества.\n\nИзвлеки:\n1. **Числовое значение** (если указано \"1000 мешков\" → 1000; \"5 т\" → 5; \"мешки по 50 кг\" → 50).\n2. **Единицу измерения** (например: \"кг\", \"т\", \"шт\", \"меш\", \"вагон\", \"л\", \"паллета\" и т.д. — как в тексте, но в нижнем регистре и без сокращений типа \"п/э\").\n3. Если указан допуск (например, \"+5%\"), учти его: \"1000 кг+5%\" → 1050.\n\nПравила:\n- Извлекай **только то, что явно указано**.\n- Не суммируй, не интерполируй, не вычисляй общее количество, если оно не дано напрямую.\n- Если количество не указано — верни null.\n\nОтвет должен быть строго в формате JSON, соответствующим структуре элемента массива \"прочее\":\n\nПримеры ответов:\n{\"параметр\": \"масса нетто единицы\", \"масса\": 50, \"единица\": \"кг\"}\n{\"параметр\": \"масса брутто\", \"масса\": 1020, \"единица\": \"кг\"}\n{\"параметр\": \"количество поддонов\", \"количество\": 20, \"единица\": \"шт\"}\n{\"параметр\": \"количество мешков\", \"количество\": 1000, \"единица\": \"шт\"}\n{\"параметр\": \"объем нетто единицы\", \"объем\": 10, \"единица\": \"л\"}\n\nДля масс используй поле \"масса\", для количеств - \"количество\", для объемов - \"объем\". Определяй тип параметра по единице измерения и контексту.\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n\n\n================================================================================\nПРОМПТ 6: СБОРКА ФИНАЛЬНОГО JSON\n================================================================================\n(Автоматическая сборка из всех извлеченных данных)\n",
  "prompt_info": {
    "mode": "qa_workflow",
    "prompts_used": [
      "QA_NUTRIENTS_PROMPT",
      "QA_NUTRIENT_PROMPT",
      "QA_STANDARD_PROMPT",
      "QA_GRADE_PROMPT",
      "QA_QUANTITY_PROMPT"
    ],
    "example_nutrients_prompt": "\nТекст: КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос: Какие действующие вещества (питательные элементы или их соединения) указаны в этом удобрении? Извлекай только те, что относятся к агрохимическому составу:  \n— Азот как N,  \n— Фосфор как P2O5,  \n— Калий как K2O,  \n— Сера как S,  \n— Кальций как Ca,  \n— Магний как Mg,  \n— Цинк как Zn,  \n— и другие макро-/микроэлементы в стандартной форме.  \n\nЕсли в марке указано, например, \"N7-P20-K30\", извлекай: N, P2O5, K2O.  \nЕсли сказано \"K в пересчёте на K2O\" — указывай K2O.  \nНе включай упаковку, стандарты, массу, объём.\n\nОтвет должен быть строго списком строк в формате JSON. Примеры:\n\nПример текста: Удобрение NPK 16-20-20 содержит азот, фосфор (в виде P2O5) и калий (в виде K2O).\nПример ответа: \n```json\n[\"N\", \"P2O5\", \"K2O\"]\n```\n\nПример текста: Марка N7-P20-K30-S3\nПример ответа: \n```json\n[\"N\", \"P2O5\", \"K2O\", \"S\"]\n```\n\nПример текста: Гранулированное удобрение в мешках по 50 кг. Соответствует ТУ 12345.\nПример ответа: \n```json\n[]\n```\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n",
    "example_nutrient_prompt": "\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакова массовая доля N в удобрении? Учти, что:\n- Если указано \"K в пересчёте на K2O\" — это означает массовую долю K2O.\n- Если значение дано как диапазон (например, \"8–10\" или \"от 6 до 12\"), верни [min, max].\n- Если указано \"не менее X\" — верни [X, null].\n- Если указано \"не более X\" — верни [null, X].\n- Если значение одно — верни число (например, 20).\n- Используй точку как десятичный разделитель.\n- Если информации нет — верни null.\n\nОтвет должен быть только в формате JSON, соответствующим структуре элемента массива \"массовая доля\":\n\nПримеры ответов:\n{\"вещество\": \"N\", \"массовая доля\": [26, 28]}\n{\"вещество\": \"P2O5\", \"массовая доля\": [20, null]}\n{\"вещество\": \"S\", \"массовая доля\": 3}\n{\"вещество\": \"NH4+\", \"массовая доля\": [null, 2]}\n{\"вещество\": \"N\", \"массовая доля\": null}\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n",
    "example_standard_prompt": "\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакой стандарт (ГОСТ, ТУ, СТО или другой нормативный документ) указан для этого удобрения?  \nЕсли стандарт не указан — верни null.\n\nОтвет должен быть только в формате JSON, соответствующим структуре элемента массива \"прочее\":\n\nПримеры ответов:\n{\"параметр\": \"стандарт\", \"значение\": \"ТУ 2184-037-32496445-02\"}\n{\"параметр\": \"стандарт\", \"значение\": null}\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n",
    "example_grade_prompt": "\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакая марка удобрения указана (например, N7-P20-K30-S3)?  \nЕсли марка не указана — верни null.\n\nОтвет должен быть только в формате JSON, соответствующим структуре элемента массива \"прочее\":\n\nПримеры ответов:\n{\"параметр\": \"марка\", \"значение\": \"N7-P20-K30-S3\"}\n{\"параметр\": \"марка\", \"значение\": null}\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n",
    "example_quantity_prompt": "\nКонтекст:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n\nВопрос:\nКакое количество товара указано в тексте? Это может быть:\n- масса (в кг, т и др.),\n- объём (в л, м³ и др.),\n- число упаковок (мешков, канистр, вагонов, поддонов, паллет и т.д.),\n- любая другая числовая характеристика количества.\n\nИзвлеки:\n1. **Числовое значение** (если указано \"1000 мешков\" → 1000; \"5 т\" → 5; \"мешки по 50 кг\" → 50).\n2. **Единицу измерения** (например: \"кг\", \"т\", \"шт\", \"меш\", \"вагон\", \"л\", \"паллета\" и т.д. — как в тексте, но в нижнем регистре и без сокращений типа \"п/э\").\n3. Если указан допуск (например, \"+5%\"), учти его: \"1000 кг+5%\" → 1050.\n\nПравила:\n- Извлекай **только то, что явно указано**.\n- Не суммируй, не интерполируй, не вычисляй общее количество, если оно не дано напрямую.\n- Если количество не указано — верни null.\n\nОтвет должен быть строго в формате JSON, соответствующим структуре элемента массива \"прочее\":\n\nПримеры ответов:\n{\"параметр\": \"масса нетто единицы\", \"масса\": 50, \"единица\": \"кг\"}\n{\"параметр\": \"масса брутто\", \"масса\": 1020, \"единица\": \"кг\"}\n{\"параметр\": \"количество поддонов\", \"количество\": 20, \"единица\": \"шт\"}\n{\"параметр\": \"количество мешков\", \"количество\": 1000, \"единица\": \"шт\"}\n{\"параметр\": \"объем нетто единицы\", \"объем\": 10, \"единица\": \"л\"}\n\nДля масс используй поле \"масса\", для количеств - \"количество\", для объемов - \"объем\". Определяй тип параметра по единице измерения и контексту.\n\nОтвечай только текстом в формате JSON после слова ОТВЕТ:\n"
  },
  "parsing_errors": [],
  "total_samples": 100,
  "valid_json_count": 100,
  "invalid_json_count": 0,
  "gemini_analysis": {
    "status": "success",
    "analysis": "Как эксперт по оценке качества работы языковых моделей, я проанализировал представленные результаты тестирования `google/gemma-2-2b-it` и готов предоставить детальный анализ и рекомендации.\n\n---\n\n### Анализ результатов тестирования `google/gemma-2-2b-it`\n\n**Модель:** `google/gemma-2-2b-it` (относительно небольшая итеративная модель)\n**Гиперпараметры:** `do_sample: false` (детерминированный вывод), `max_new_tokens: 512` (достаточный для извлечения), `torch_dtype: bfloat16` (стандарт), `multi_agent_mode: qa_workflow` (указывает на структуру выполнения задач).\n\n**1. Характерные ошибки модели:**\n\n*   **Низкое качество извлечения числовых данных (\"Массовая доля\"):** Модель демонстрирует крайне низкие метрики (точность 4.58%, F1: 6.15%). Это проявляется в:\n    *   **Галлюцинациях (Precision issues):** Предсказывает значения (например, `P2O5: [None, 20.0]`, `N: [8.0, 10.0]`) там, где истинных данных нет или они не соответствуют (например, `N: истина [7.0, 9.0]`). В одном случае даже предсказала `1000.0` для \"масса\" при отсутствии истинного значения.\n    *   **Плохой полноте (Recall issues):** Часто не извлекает существующие значения (например, `S: истина [2.0, None]`, `K2O: истина [29.0, 31.0]`, `P2O5: истина [19.0, 21.0]`).\n    *   **Низкой точности значений:** Даже когда извлекает, предсказанный диапазон может не совпадать с истинным (например, `N: предсказано [8.0, 10.0], истина [7.0, 9.0]`).\n\n*   **Конфликт инструкций / Недопонимание контекста (\"Прочее\"):** Метрики для \"Прочее\" ещё ниже (точность 0.24%, F1: 0.87%). Наиболее частая ошибка – это пропуск данных:\n    *   Модель постоянно не извлекает \"стандарт\" (`ту 20.15.52...`, `ту 20.15.71...`), \"марку\" (`npks-8`), \"массу брутто\" (`1050.0`).\n    *   *Критично:* Промпт 1 **явно указывает** \"Не включай упаковку, стандарты, массу, объём.\" Если эти параметры включены в группу \"Прочее\" для оценки, то существует прямое противоречие между инструкцией и оценкой. Модель, вероятно, следует инструкциям Промпта 1 и игнорирует эти сущности.\n\n*   **Ограниченное понимание предметной области:** Для \"КАЛИЙ СЕРНОКИСЛЫЙ\" в Промпте 1, модель должна была бы вывести `K2O` и `S`. Результатов для Промпта 1 напрямую не предоставлено, но учитывая ошибки в \"массовых долях\" (где K2O и S были пропущены), можно предположить, что модель может испытывать трудности с выводом элементов из описательных химических названий, даже при наличии явных правил (Калий как K2O, Сера как S).\n\n**2. Причины ошибок парсинга JSON:**\n\n*   **Ошибок парсинга не обнаружено.** Это отличный результат! Модель строго следует формату JSON, указанному в промпте. Это говорит о том, что инструкции по форматированию вывода поняты и выполняются корректно.\n\n**3. Причины ошибок в извлечении данных:**\n\n*   **Недостаточная детализация и противоречия в промптах:**\n    *   **Для \"Прочее\":** Как указано выше, инструкция в Промпте 1 явно исключает \"стандарты, массу\". Если эти данные ожидаются к извлечению в рамках \"qa_workflow\" или отдельного Промпта 2, модель должна быть об этом проинформирована. Отсутствие явного запроса на извлечение \"прочего\" в Промпте 2 привело к его пропуску.\n    *   **Для \"Массовой доли\":** Промпт 2 не содержит примеров извлечения массовых долей или четких инструкций по обработке диапазонов и отсутствующих значений. Это может приводить к галлюцинациям или пропускам.\n    *   **Отсутствие данных в предоставленном тексте:** Контекст \"КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ...\" не содержит никаких числовых массовых долей. Если модель оценивалась именно на этом тексте для Промпта 2, то любые предсказанные значения (кроме \"отсутствует\") будут галлюцинациями, а \"истина\" в примерах ошибок указывает на то, что модель была протестирована на других текстах, где эти данные *были* (что не отражено в промпте). Это может указывать на несоответствие между тестовыми данными и представленным промптом.\n\n*   **Ограничения модели `gemma-2-2b-it`:** Будучи небольшой моделью (2B), Gemma может испытывать трудности с:\n    *   **Точным извлечением чисел и диапазонов:** Это частая проблема для LLM, особенно маленьких.\n    *   **Сложным логическим выводом и семантическим пониманием:** Для преобразования \"КАЛИЙ СЕРНОКИСЛЫЙ\" в `K2O` и `S` требуется определённый уровень понимания химии или очень хорошо подобранные примеры.\n    *   **Устойчивостью к \"отсутствующим\" данным:** Малые модели более склонны \"выдумывать\" ответ, если явной информации нет, вместо того чтобы сообщать об отсутствии данных.\n\n**4. Рекомендации по улучшению промпта:**\n\n*   **Устранить противоречия в инструкциях:**\n    *   Если \"стандарты\", \"масса\", \"марка\" должны быть извлечены, **удалите их из списка исключений Промпта 1** и **добавьте явный запрос на их извлечение в Промпт 2** или в отдельный промпт в рамках `qa_workflow`.\n    *   Четко определите, какие поля должны быть извлечены в каждом шаге `qa_workflow`.\n\n*   **Дополнить Промпт 2 (ИЗВЛЕЧЕНИЕ МАССОВЫХ ДОЛЕЙ):**\n    *   **Добавить примеры:** Включите разнообразные примеры с массовыми долями, включая диапазоны (например, \"N 7-9%\", \"K2O от 29 до 31%\") и случаи, когда значения отсутствуют (например, \"Удобрение без азота\" -> N: `null`).\n    *   **Четкие инструкции для отсутствующих данных:** Явно укажите, как модель должна реагировать, если массовая доля вещества не найдена (например, `null`, пустая строка, или не включать в вывод).\n    *   **Определить формат вывода для диапазонов:** Например, `{\"N\": [7.0, 9.0]}` или `{\"N\": \"7-9%\"}`.\n\n*   **Улучшить Промпт 1 (ИЗВЛЕЧЕНИЕ ПИТАТЕЛЬНЫХ ВЕЩЕСТВ) для химических названий:**\n    *   Добавьте примеры, показывающие вывод из описательных названий:\n        *   Пример текста: \"Сульфат калия\"\n        *   Пример ответа: `[\"K2O\", \"S\"]`\n        *   Пример текста: \"Аммиачная селитра\"\n        *   Пример ответа: `[\"N\"]`\n\n*   **Структурировать \"qa_workflow\" более явно:** Если это многоступенчатый процесс, убедитесь, что каждый шаг имеет свои четкие инструкции и примеры, а также понимание того, как он связан с предыдущими/последующими шагами. Модель должна \"знать\", что исключила в Промпте 1, чтобы не извлекать, если это не затребовано повторно.\n\n**5. Рекомендации по настройке гиперпараметров:**\n\n*   **`do_sample: false`:** Оставить без изменений. Это обеспечивает детерминированный вывод, что важно для оценки точности извлечения данных.\n*   **`max_new_tokens: 512`:** Вероятно, достаточно. Только если наблюдается обрезание вывода, стоит увеличить.\n*   **Температура (если бы `do_sample` было `true`):** Если бы использовалось сэмплирование, рекомендовалось бы использовать низкую температуру (0.1-0.3) для более точных и менее креативных ответов. Но с `do_sample: false`, это неактуально.\n\n**6. Общие рекомендации по улучшению качества:**\n\n*   **Использовать более мощную модель:** `gemma-2-2b-it` — это небольшая модель. Более крупные модели (например, Gemma 7B, Mixtral, Llama 3 8B-Instruct) обычно демонстрируют значительно лучшие способности к извлечению, меньше галлюцинируют и лучше справляются с числовыми данными и сложными инструкциями.\n*   **Обучение на конкретных примерах (Few-Shot Learning):** Даже с лучшей моделью, предоставление 5-10 качественных, разнообразных примеров в промпте, которые охватывают все возможные сценарии (наличие/отсутствие данных, разные форматы чисел, диапазоны, химические названия), значительно улучшит результаты.\n*   **Дообучение (Fine-tuning):** Для высокоточной и специфической задачи извлечения данных из большого объема однотипных текстов, дообучение модели на специально подготовленном наборе данных может дать наилучшие результаты.\n*   **Пост-обработка:** Внедрите слой пост-обработки для валидации извлеченных данных. Это может включать:\n    *   Проверку на числовые диапазоны.\n    *   Нормализацию названий веществ.\n    *   Фильтрацию галлюцинаций, если значения выходят за разумные пределы.\n*   **Итеративный подход к промптингу:** Регулярно тестируйте и улучшайте промпты, основываясь на анализе ошибок. Добавляйте примеры для тех типов ошибок, которые модель делает чаще всего.\n\n---\n\n**Вывод:**\n\nМодель хорошо справляется с соблюдением JSON формата, но имеет серьёзные проблемы с точностью и полнотой извлечения числовых данных и игнорирует \"прочие\" параметры из-за явных инструкций исключения в промпте (или их отсутствия в запросе). Основные улучшения должны быть сосредоточены на **уточнении и обогащении промптов**, особенно для числового извлечения и устранения любых противоречий в инструкциях, а также, по возможности, **использовании более мощной языковой модели**.",
    "model_used": "gemini-2.5-flash"
  }
}