{
  "model_name": "gemma-3-27b-it",
  "timestamp": "20260125_181125",
  "analysis": "Как эксперт по оценке качества работы языковых моделей, я провел анализ предоставленных результатов тестирования модели `gemma-3-27b-it` по задаче извлечения численных и количественных характеристик из текстов о химических веществах.\n\n### Общая оценка\n\nМодель успешно освоила задачу генерации JSON-структуры, о чем свидетельствует отсутствие ошибок парсинга. Это является сильным показателем понимания формата вывода. Однако качество извлечения данных значительно различается по категориям:\n*   **\"Массовая доля\"**: Результаты удовлетворительные (F1 75%), но есть существенный потенциал для улучшения.\n*   **\"Прочее\"**: Результаты низкие (F1 51.91%), что указывает на серьезные проблемы с извлечением данных в этой категории.\n\nПерейдем к более детальному анализу.\n\n---\n\n### 1. Характерные ошибки модели (на основе метрик)\n\nПоскольку прямого вывода модели для анализируемого текста не предоставлено, а даны агрегированные метрики, характерные ошибки можно предположить на основе этих метрик и сложности задачи:\n\n*   **Категория \"Массовая доля\" (F1: 75.00%)**:\n    *   **False Negatives (Пропуски)**: Учитывая Recall 76.12%, модель пропускает около четверти актуальных массовых долей. Это могут быть элементы, выраженные нестандартными формулировками, или элементы, находящиеся в менее очевидном контексте.\n    *   **False Positives (Лишние/Некорректные извлечения)**: Precision 73.91% указывает на то, что примерно четверть извлеченных сущностей в этой категории являются некорректными (либо не являются массовой долей, либо неверно определено `вещество`, либо неверно значение `массовая доля`). Например, модель может путать массовую долю с другими процентами (влажность, потери) или неправильно интерпретировать диапазоны (например, `не более 0.5%` вместо `[null, 0.5]`).\n    *   **Проблемы с распознаванием веществ**: Модель может неправильно сопоставлять синонимы или менее распространенные названия химических элементов/соединений с требуемым форматом (`N`, `P2O5`, `K2O` и т.д.).\n\n*   **Категория \"Прочее\" (F1: 51.91%)**:\n    *   **Высокий уровень False Negatives и False Positives**: Метрики Precision (52.31%) и Recall (51.52%) очень низкие и близки друг к другу, что означает, что модель как пропускает очень много актуальных \"прочих\" характеристик, так и извлекает много некорректных.\n    *   **Сложность распознавания разнородных сущностей**: Категория \"прочее\" включает в себя очень разные типы данных: стандарты (ТУ, ГОСТ), марки, идентификаторы, количество товара с единицами измерения, а также сложные расчеты (например, `1000 кг+5%`). Для каждого подтипа требуется свой шаблон распознавания. Модель, вероятно, испытывает трудности с обобщением правил для такого разнообразия.\n    *   **Проблемы с расчетами**: Примеры 2 и 5 требуют выполнения математических операций (`+5%`). Низкий F1 в этой категории может указывать на то, что модель часто либо пропускает такие сущности, либо извлекает их неправильно, либо не выполняет расчеты.\n    *   **Идентификация типа \"масса\"**: Модель может путать `масса нетто единицы`, `масса брутто единицы` и `масса брутто`, или вовсе не распознавать их.\n\n---\n\n### 2. Причины ошибок парсинга JSON\n\nКак указано, **ошибок парсинга JSON не обнаружено**. Это отличный результат. Модель хорошо справилась с задачей следования формату вывода, что часто является сложной задачей для LLM. Это говорит о том, что инструкции по форматированию JSON (включая примеры) были достаточно ясными и модель их хорошо усвоила.\n\n---\n\n### 3. Причины ошибок в извлечении данных\n\n*   **Недостаток контекста/специфики**: Хотя модель обладает общими знаниями, она может не иметь достаточно глубоких предметных знаний о химических веществах и удобрениях, их маркировках, стандартах, типовых фразах для указания массовых долей или количества.\n*   **Разнообразие формулировок**: Люди описывают химические продукты очень разнообразно. Даже незначительные изменения в формулировках могут сбить модель.\n*   **Сложность правил для \"Прочее\"**:\n    *   **\"Стандарты\"**: Требуют распознавания специфических буквенно-числовых паттернов (например, `ТУ X-Y-Z-Год`, `ГОСТ АААА-ГГ`).\n    *   **\"Количество товара\"**: Часто сопровождается предлогами, сокращениями единиц измерения, диапазонами или дополнительными условиями (например, `в мешках по 50 кг`, `20 тонн`, `биг-беги по 1000 кг+5%`).\n    *   **Вычислительная логика**: Необходимость выполнять арифметические операции (например, `+5%` или рассчитать общий вес исходя из количества единиц и веса единицы) является сложной задачей для моделей, не предназначенных специально для расчетов.\n*   **Имплицитные знания**: Некоторые сущности могут быть указаны неявно или требовать вывода. Например, `K2O` может быть упомянут как \"калий в пересчете на оксид калия\", что модель должна интерпретировать как `K2O`.\n*   **Ограниченность примеров в промпте**: Хотя примеры хорошие, их может быть недостаточно для покрытия всего спектра вариаций, особенно для сложной категории \"Прочее\".\n\n---\n\n### 4. Рекомендации по улучшению промпта\n\nПромпт достаточно подробный, но его можно улучшить для повышения качества извлечения, особенно в категории \"Прочее\".\n\n1.  **Расширить количество и разнообразие примеров:**\n    *   **Для \"Прочее\"**: Добавить значительно больше примеров, охватывающих различные типы стандартов, единиц измерения, форматов упаковки и ситуаций с расчетами:\n        *   Примеры с разными ГОСТами и ТУ.\n        *   Примеры с массой в тоннах, штуках, паллетах.\n        *   Примеры, где \"масса нетто единицы\" и \"масса брутто единицы\" четче различаются или присутствуют одновременно.\n        *   Примеры с более сложными расчетами или несколькими числовыми показателями в одном предложении (например, \"20 мешков по 50 кг, общим весом 1000 кг\").\n        *   Примеры с `марками` или `идентификаторами`, если они ожидаются.\n    *   **Для \"Массовая доля\"**: Добавить примеры с менее очевидными формулировками, синонимами для веществ, а также отрицательные примеры (т.е., числа, которые НЕ являются массовой долей, если такие ошибки наблюдались).\n\n2.  **Явно прописать правила для сложных случаев и расчетов:**\n    *   **Расчеты**: Четко указать, что при наличии процентов (`+-5%`) или других указаний на изменение веса, модель должна производить расчеты и выводить *конечную* массу.\n    *   **Диапазоны**: Подчеркнуть, как именно должны быть представлены диапазоны (`[32, null]`, `[null, 0.5]`).\n    *   **Приоритет/Конфликты**: Если в тексте есть несколько масс (нетто/брутто, единица/общая), указать, какие из них приоритетны или как их все выводить.\n\n3.  **Добавить больше \"негативных\" примеров (имплицитно):**\n    *   Если есть числа, которые модель *не должна* извлекать (например, год производства, номер партии, не связанные с весом проценты), можно добавить примеры, где такие числа присутствуют, но не включены в JSON.\n\n4.  **Уточнить \"вещество\"**: Возможно, добавить список или примеры всех ожидаемых обозначений веществ (`N`, `P2O5`, `K2O`, `SO4`, `Cl`, `Ca`, `NH4+`, etc.).\n\n---\n\n### 5. Рекомендации по настройке гиперпараметров\n\nПредоставлены базовые гиперпараметры. Для задач извлечения информации критически важны параметры, контролирующие \"креативность\" модели:\n\n*   **`temperature`**: **Установить низкое значение (например, 0.1 - 0.3)**. Высокая температура (по умолчанию часто 1.0) делает ответы более разнообразными и творческими, что абсолютно неприемлемо для точного извлечения данных. Нам нужна максимально детерминированная и точная генерация.\n*   **`top_p` и `top_k`**: **Установить относительно низкие/умеренные значения (например, `top_p` около 0.8-0.9, `top_k` около 20-50)**. Это ограничивает выбор токенов на каждом шаге генерации наиболее вероятными, снижая риск галлюцинаций или отклонений от формата.\n*   **`max_new_tokens`**: 512 токенов, вероятно, достаточно для большинства JSON-ответов в этой задаче. Если в текстах для анализа будут попадаться гораздо более объемные данные для извлечения, возможно, потребуется увеличение этого значения. Сейчас это не выглядит как критический фактор.\n*   **`repetition_penalty`**: Можно попробовать установить небольшое значение (например, 1.1-1.2), чтобы предотвратить возможное повторение элементов в JSON, хотя в данном случае с валидным JSON это менее вероятно.\n\n---\n\n### 6. Общие рекомендации по улучшению качества\n\n1.  **Fine-tuning (Дообучение модели)**: Это наиболее эффективный способ значительного улучшения качества для таких специализированных задач.\n    *   Соберите более крупный и разнообразный датасет из текстов о химических веществах/удобрениях с размеченными в требуемом JSON-формате данными.\n    *   Дообучение модели на этом датасете позволит ей гораздо лучше усвоить специфику домена, научиться распознавать тонкости формулировок и сложные правила извлечения, особенно для категории \"Прочее\", где текущая производительность очень низкая.\n\n2.  **Использование RAG (Retrieval-Augmented Generation)**:\n    *   Если существуют справочники стандартов (ТУ/ГОСТ), списки химических веществ или правила преобразования/расчета, RAG-подход может помочь модели \"вспоминать\" эти правила и данные.\n    *   Например, перед генерацией ответа, можно искать в базе данных соответствие найденных фрагментов текста известным стандартам или химическим формулам, и подавать эту информацию модели в качестве дополнительного контекста.\n\n3.  **Пост-обработка результатов модели**:\n    *   Даже при улучшенной модели, всегда полезно иметь слой пост-обработки для валидации извлеченных данных.\n    *   **Валидация форматов**: Проверка, соответствует ли извлеченный стандарт (`ТУ`, `ГОСТ`) известным регулярным выражениям.\n    *   **Проверка значений**: Убедиться, что массовая доля не превышает 100%, что веса имеют смысл и т.д.\n    *   **Консистентность данных**: Проверять, если в тексте несколько связанных числовых данных, что они согласуются.\n\n4.  **Итеративное тестирование и анализ ошибок**:\n    *   Постоянно собирать новые примеры, на которых модель ошибается.\n    *   Анализировать эти ошибки и использовать их для дальнейшего улучшения промпта или для создания новых обучающих данных для файн-тюнинга.\n    *   Особое внимание уделить кейсам, где модель не производит нужные расчеты или путает категории.\n\n---\n\nПодводя итог, модель `gemma-3-27b-it` демонстрирует отличную способность следовать формату вывода (JSON), но нуждается в значительном улучшении логики извлечения данных, особенно для разнородной категории \"Прочее\". Комбинация улучшения промпта, правильной настройки гиперпараметров и, что наиболее важно, файн-тюнинга на специализированном датасете, будет ключом к достижению высокого качества в этой задаче.",
  "model_used": "gemini-2.5-flash",
  "parsing_errors_count": 0,
  "hyperparameters": {
    "max_new_tokens": 512,
    "model_name": "gemma-3-27b-it",
    "api_model": true
  },
  "prompts": {
    "prompt_template": "build_prompt3",
    "prompt_full_text": "\nТы — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  \nТвоя задача:  \n\n1. Найти все численные признаки в тексте, например:  \n   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  \n   - Количество товара (кг, т, п/э мешки, вагон и др.).  \n   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  \n\n2. Выведи json по аналогии с этими примерами:\nТекст примера 1: СЛОЖНОЕ АЗОТНО-ФОСФОРНО-КАЛИЙНОЕ МИНЕРАЛЬНОЕ УДОБРЕНИЕ АЗОФОСКА (НИТРОАММОФОСКА), ГРАНУЛИРОВАННОЕ, С СОДЕРЖАНИЕМ МАССОВОЙ ДОЛИ АЗОТА 16 МАС.%, ФОСФОРА 16 МАС.%, КАЛИЯ 16 МАС.% В ПЕРЕСЧЕТЕ НА СУXОЙ БЕЗВОДНЫЙ ПРОДУКТ, СООТВЕТСТВУЕТ ТУ 2186-039-00203789 -2003, ОБЕСПЕЧИВАЕТ СБАЛАНСИРОВАННОЕ ПИТАНИЕ РАСТЕНИЙ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, В ПОЛИПРОПИЛЕНОВЫХ МЕШКАХ ПО 50 КГ СЛОЖНОЕ АЗОТНО-ФОСФОРНО-КАЛИЙНОЕ МИНЕРАЛЬНОЕ УДОБРЕНИЕ АЗОФОСКА\nОтвет примера 1: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"N\",\n      \"массовая доля\": 16\n    },\n    {\n      \"вещество\": \"P2O5\",\n      \"массовая доля\": 16\n    },\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 16\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"стандарт\",\n      \"значение\": \"ТУ 2186-039-00203789-2003\"\n    },\n    {\n      \"параметр\": \"масса нетто единицы\",\n      \"масса\": 50,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\nТекст примера 2: СУЛЬФАТ КАЛИЯ, ДЛЯ ТЕХНИЧЕСКОГО ИСПОЛЬЗОВАНИЯ. КРИСТАЛЛИЧЕСКИЙ РАССЫПЧАТЫЙ ПОРОШОК БЕЛОГО ЦВЕТА С ЖЕЛТОВАТЫМ ОТТЕНКОМ, НЕ СОДЕРЖАЩИЙ МЕХАНИЧЕСКИХ ПРИМЕСЕЙ,УПАКОВАННЫЙ В БИГ-БЕГИ ПО 1000 КГ+5%. СОСТАВ: МАССОВАЯ ДОЛЯ КАЛИЯ (К2О)-50.0%,SO4 - 52,5% ХЛОР( CI)-1.0% ГИГРОСКОПИЧЕН. :\nОтвет примера 2: {\n  \"массовая доля\": [\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 50.0\n    },\n    {\n      \"вещество\": \"SO4\",\n      \"массовая доля\": 52.5\n    },\n    {\n      \"вещество\": \"Cl\",\n      \"массовая доля\": 1.0\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"масса брутто единицы\",\n      \"масса\": 1050,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\nТекст примера 3: НИТРАТ КАЛЬЦИЯ КОНЦЕНТРИРОВАННЫЙ.ГРАНУЛИРОВАННЫЙ ПРОДУКТ С СОДЕРЖ.МАС.ДОЛИ ОБЩЕГО АЗОТА 17%, АММОНИЙНОГО АЗОТА НЕ БОЛЕЕ 0,5%,КАЛЬЦИЯ НЕ МЕНЕЕ 32%.ПРИМ-СЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ,РОЗНИЧНОЙ ПРОДАЖЕ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ. :\nОтвет примера 3: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"N\",\n      \"массовая доля\": 17\n    },\n    {\n      \"вещество\": \"NH4+\",\n      \"массовая доля\": [null, 0.5]\n    },\n    {\n      \"вещество\": \"Ca\",\n      \"массовая доля\": [32, null]\n    }\n  ],\n  \"прочее\": []\n}\n\nТекст примера 4: КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\nОтвет примера 4: \n{\n  \"массовая доля\": [],\n  \"прочее\": [\n    {\n      \"параметр\": \"стандарт\",\n      \"значение\": \"ТУ 20.15.52-089-05785164-2022\"\n    }\n  ]\n}\n\nТекст примера 5: СУЛЬФАТ КАЛИЯ (СОРТ ЭКСТРА), ДЛЯ ТЕХНИЧЕСКOГО ИСПОЛЬЗОВАНИЯ. КРИСТАЛЛИЧЕСКИЙ РАССЫПЧАТЫЙ ПОРОШОК БЕЛОГО ЦВЕТА С ЖЕЛТОВАТЫМ ОТТЕНКОМ, НЕ СОДЕРЖАЩИЙ МЕХАНИЧЕСКИХ ПРИМЕСЕЙ,УПАКОВАННЫЙ В МЕШКИ ПО 25КГ+-5%, ОБЩИЙ ВЕС БРУТТО С ПАЛЛЕТАМИ 21640 КГ. СОСТАВ:МА МАССОВАЯ ДОЛЯ КАЛИЯ (К2О)-51.0%,SO4 - 51,0% ХЛОР(CI)-1.0%, ГИГРОСКОПИЧЕН. :\nОтвет примера 5: \n{\n  \"массовая доля\": [\n    {\n      \"вещество\": \"K2O\",\n      \"массовая доля\": 51.0\n    },\n    {\n      \"вещество\": \"SO4\",\n      \"массовая доля\": 51.0\n    },\n    {\n      \"вещество\": \"Cl\",\n      \"массовая доля\": 1.0\n    }\n  ],\n  \"прочее\": [\n    {\n      \"параметр\": \"масса брутто единицы\",\n      \"масса\": 26.25,\n      \"единица\": \"кг\"\n    },\n    {\n      \"параметр\": \"масса брутто\",\n      \"масса\": 21640,\n      \"единица\": \"кг\"\n    }\n  ]\n}\n\n3. Выводи json результат **только после слова ОТВЕТ:**.\n\nТекст для анализа:\nКАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА\n",
    "prompt_info": null
  },
  "system_info": {
    "api_model": true,
    "multi_agent_mode": null,
    "gpu_info": {
      "api": true
    },
    "gpu_memory_during_inference_gb": 0.0,
    "average_response_time_seconds": 10.721234204769134
  },
  "quality_metrics_summary": {
    "массовая доля": {
      "accuracy": 0.7606992544492545,
      "precision": 0.7391304347826086,
      "recall": 0.7611940298507462,
      "f1": 0.75
    },
    "прочее": {
      "accuracy": 0.5196325042478889,
      "precision": 0.5230769230769231,
      "recall": 0.5151515151515151,
      "f1": 0.5190839694656489
    }
  }
}