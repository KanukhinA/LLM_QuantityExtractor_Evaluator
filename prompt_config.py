"""
Конфигурация промптов для обработки текстов
"""

# Базовый промпт для извлечения численных характеристик из текстов об удобрениях
DETAILED_INSTR_ZEROSHOT_BASELINE = """
Ты — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  
Твоя задача:  

1. Найти все численные признаки в тексте, например:  
   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  
   - Количество товара (кг, т, п/э мешки, вагон и др.).  
   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  

2. Для каждого численного признака определить:  
   - Название признака (например, "массовая доля N", "массовая доля P2O5", "массовая доля К2О", "массовая доля S", "масса нетто единицы", "масса нетто", "масса K2O", "масса брутто", "количество вагонов", "стандарт" и т.д.)  
   - Значение (число, если есть диапазон — брать оба значения; для стандарта указываешь полный номер стандарта со словами ГОСТ/ТУ или др.)  
   - Единицу измерения (%, кг, т, шт, п/э меш, вагон, или пусто для стандарта)  

3. Особые указания:
   - Извлекай на русском
   - Если признак указан как диапазон из нескольких чисел (например "8-10", или "от 6 до 12") или с погрешностью (+/-), укажи оба числа в формате [min, max]. 
   - Извлекай логические/сравнительные операторы, если они присутствуют в тексте: «не менее» - [min, null] «не более» - [null, max]
   - Используй точку в качестве разделителя десятичных чисел.
   - Название вещества и его массовая доля могут встречаться в марке (например, "N7-P20-K30-S3"),  используй данные из марки, если нет иных данных по массовой доле вещества.
   - Если в названии признака есть название химического элемента (например Кальций) - замени его на обозначение химического элемента - Ca.
   - Названия признаков пиши с маленькой буквы. Например "массовая доля Zn".
   - Если указано например "МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О" - то правильным извлекаемым признаком будет "массовая доля K2O".
   - Если один и тот же параметр встречается дважды — сначала как общее условие (например, «с содержанием азота более 10%»), а затем как конкретное значение (например, «азот 16%»), указывай только конкретное значение.
   - Для массы с упаковкой - называй признак "масса брутто" вне зависимости от наименования упаковки. Если указывается просто масса в формате "МЕШКИ ПО 50 КГ" - это признак "масса нетто".
   - Если дается масса в виде "ПО 1000 КГ+5%" - указывай в признаке "масса брутто" одно значение - 1050.
   - Для прочих признаков (всех признаков, помимо "массовой доли") указывай единицы измерения (за исключением признаков "марка" и "стандарт")
   - Если признака в тексте нет - не извлекай его и не выводи его в json.

4 . Выводи строго JSON следующего вида (пример):

```json
{{
  "массовая доля": [
    {{"вещество": "N", "массовая доля": [26, 28]}},
    {{"вещество": "P2O5", "массовая доля": [20, null]}},
    {{"вещество": "K2O", "массовая доля": 20}},
    {{"вещество": "S", "массовая доля": 3}},
    {{"вещество": "NH4+", "массовая доля": [null, 2]}}
  ],
  "прочее": [
    {{"параметр": "масса нетто единицы", "масса": 50, "единица": "кг"}},
    {{"параметр": "масса брутто", "масса": 1020, "единица": "кг"}},
    {{"параметр": "количество поддонов", "количество": 20, "единица": "шт"}},
    {{"параметр": "количество мешков", "количество": 1000, "единица": "шт"}},
    {{"параметр": "объем нетто единицы", "объем": 10, "единица": "л"}},
    {{"параметр": "стандарт", "значение": "ТУ 2184-037-32496445-02"}},
    {{"параметр": "марка", "значение": "N7-P20-K30-S3"}}
  ]
}}
```

5. Выводи json результат **только после слова ОТВЕТ:**.

Текст для извлечения данных:
{text}
"""


# Базовый промпт с примером текста и ответа
DETAILED_INSTR_ONESHOT = """
Ты — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  
Твоя задача:  

1. Найти все численные признаки в тексте, например:  
   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  
   - Количество товара (кг, т, п/э мешки, вагон и др.).  
   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  

2. Для каждого численного признака определить:  
   - Название признака (например, "массовая доля N", "массовая доля P2O5", "массовая доля К2О", "массовая доля S", "масса нетто единицы", "масса нетто", "масса K2O", "масса брутто", "количество вагонов", "стандарт" и т.д.)  
   - Значение (число, если есть диапазон — брать оба значения; для стандарта указываешь полный номер стандарта со словами ГОСТ/ТУ или др.)  
   - Единицу измерения (%, кг, т, шт, п/э меш, вагон, или пусто для стандарта)  

3. Особые указания:
   - Извлекай на русском
   - Если признак указан как диапазон из нескольких чисел (например "8-10", или "от 6 до 12") или с погрешностью (+/-), укажи оба числа в формате [min, max]. 
   - Извлекай логические/сравнительные операторы, если они присутствуют в тексте: «не менее» - [min, null] «не более» - [null, max]
   - Используй точку в качестве разделителя десятичных чисел.
   - Название вещества и его массовая доля могут встречаться в марке (например, "N7-P20-K30-S3"),  используй данные из марки, если нет иных данных по массовой доле вещества.
   - Если в названии признака есть название химического элемента (например Кальций) - замени его на обозначение химического элемента - Ca.
   - Названия признаков пиши с маленькой буквы. Например "массовая доля Zn".
   - Если указано например "МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О" - то правильным извлекаемым признаком будет "массовая доля K2O".
   - Если один и тот же параметр встречается дважды — сначала как общее условие (например, «с содержанием азота более 10%»), а затем как конкретное значение (например, «азот 16%»), указывай только конкретное значение.
   - Для массы с упаковкой - называй признак "масса брутто" вне зависимости от наименования упаковки. Если указывается просто масса в формате "МЕШКИ ПО 50 КГ" - это признак "масса нетто".
   - Если дается масса в виде "ПО 1000 КГ+5%" - указывай в признаке "масса брутто" одно значение - 1050.
   - Для прочих признаков (всех признаков, помимо "массовой доли") указывай единицы измерения (за исключением признаков "марка" и "стандарт")
   - Если признака в тексте нет - не извлекай его и не выводи его в json.

4. Выводи строго JSON следующего вида (пример):

Пример текста:
НИТРОАММОФОСКА, УДОБРЕНИЕ МИНЕРАЛЬНОЕ, СОДЕРЖАЩЕЕ ТРИ ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА - АЗОТ-27 +-1%, ФОСФОР-20% (В ПЕРЕСЧЕТЕ НА P2O5), КАЛИЙ-20% (В ПЕРЕСЧЕТЕ НА K2O), СЕРА-3%. ПОСТАВЛЯЕТСЯ В МЕШКАХ ПО 50 КГ. МАССА БРУТТО С УПАКОВКОЙ: 1020 КГ. КОЛИЧЕСТВО ПОДДОНОВ: 20 ШТ. КОЛИЧЕСТВО МЕШКОВ: 1000 ШТ. ОБЪЕМ НЕТТО ЕДИНИЦЫ: 10 Л. СООТВЕТСТВУЕТ ТУ 2184-037-32496445-02. МАРКА: N26-P20-K20-S3.

Пример ответа:
```json
{{
  "массовая доля": [
    {{"вещество": "N", "массовая доля": [26, 28]}},
    {{"вещество": "P2O5", "массовая доля": 20}},
    {{"вещество": "K2O", "массовая доля": 20}},
    {{"вещество": "S", "массовая доля": 3}}
  ],
  "прочее": [
    {{"параметр": "масса нетто единицы", "масса": 50, "единица": "кг"}},
    {{"параметр": "масса брутто", "масса": 1020, "единица": "кг"}},
    {{"параметр": "количество поддонов", "количество": 20, "единица": "шт"}},
    {{"параметр": "количество мешков", "количество": 1000, "единица": "шт"}},
    {{"параметр": "объем нетто единицы", "объем": 10, "единица": "л"}},
    {{"параметр": "стандарт", "значение": "ТУ 2184-037-32496445-02"}},
    {{"параметр": "марка", "значение": "N26-P20-K20-S3"}}
  ]
}}
```

5. Выводи json результат **только после слова ОТВЕТ:**.

Текст для анализа:
{text}
"""

# Версии для режима outlines: пример JSON с латинскими ключами (mass_fractions, other_params и т.д.)
DETAILED_INSTR_ZEROSHOT_BASELINE_OUTLINES = """
Ты — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  
Твоя задача:  

1. Найти все численные признаки в тексте, например:  
   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  
   - Количество товара (кг, т, п/э мешки, вагон и др.).  
   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  

2. Для каждого численного признака определить:  
   - Название признака (например, "массовая доля N", "массовая доля P2O5", "массовая доля К2О", "массовая доля S", "масса нетто единицы", "масса нетто", "масса K2O", "масса брутто", "количество вагонов", "стандарт" и т.д.)  
   - Значение (число, если есть диапазон — брать оба значения; для стандарта указываешь полный номер стандарта со словами ГОСТ/ТУ или др.)  
   - Единицу измерения (%, кг, т, шт, п/э меш, вагон, или пусто для стандарта)  

3. Особые указания:
   - Извлекай на русском
   - Если признак указан как диапазон из нескольких чисел (например "8-10", или "от 6 до 12") или с погрешностью (+/-), укажи оба числа в формате [min, max]. 
   - Извлекай логические/сравнительные операторы, если они присутствуют в тексте: «не менее» - [min, null] «не более» - [null, max]
   - Используй точку в качестве разделителя десятичных чисел.
   - Название вещества и его массовая доля могут встречаться в марке (например, "N7-P20-K30-S3"),  используй данные из марки, если нет иных данных по массовой доле вещества.
   - Если в названии признака есть название химического элемента (например Кальций) - замени его на обозначение химического элемента - Ca.
   - Названия признаков пиши с маленькой буквы. Например "массовая доля Zn".
   - Если указано например "МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О" - то правильным извлекаемым признаком будет "массовая доля K2O".
   - Если один и тот же параметр встречается дважды — сначала как общее условие (например, «с содержанием азота более 10%»), а затем как конкретное значение (например, «азот 16%»), указывай только конкретное значение.
   - Для массы с упаковкой - называй признак "масса брутто" вне зависимости от наименования упаковки. Если указывается просто масса в формате "МЕШКИ ПО 50 КГ" - это признак "масса нетто".
   - Если дается масса в виде "ПО 1000 КГ+5%" - указывай в признаке "масса брутто" одно значение - 1050.
   - Для прочих признаков (всех признаков, помимо "массовой доли") указывай единицы измерения (за исключением признаков "марка" и "стандарт")
   - Если признака в тексте нет - не извлекай его и не выводи его в json.

4 . Выводи строго JSON следующего вида (пример с латинскими ключами):

```json
{{
  "mass_fractions": [
    {{"substance_name": "N", "mass_fraction": [26, 28]}},
    {{"substance_name": "P2O5", "mass_fraction": [20, null]}},
    {{"substance_name": "K2O", "mass_fraction": 20}},
    {{"substance_name": "S", "mass_fraction": 3}},
    {{"substance_name": "NH4+", "mass_fraction": [null, 2]}}
  ],
  "other_params": [
    {{"parameter_name": "масса нетто единицы", "mass": 50, "unit": "кг"}},
    {{"parameter_name": "масса брутто", "mass": 1020, "unit": "кг"}},
    {{"parameter_name": "количество поддонов", "quantity": 20, "unit": "шт"}},
    {{"parameter_name": "количество мешков", "quantity": 1000, "unit": "шт"}},
    {{"parameter_name": "объем нетто единицы", "volume": 10, "unit": "л"}},
    {{"parameter_name": "стандарт", "value": "ТУ 2184-037-32496445-02"}},
    {{"parameter_name": "марка", "value": "N7-P20-K30-S3"}}
  ]
}}
```

5. Выводи json результат **только после слова ОТВЕТ:**.

Текст для извлечения данных:
{text}
"""

DETAILED_INSTR_ONESHOT_OUTLINES = """
Ты — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  
Твоя задача:  

1. Найти все численные признаки в тексте, например:  
   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  
   - Количество товара (кг, т, п/э мешки, вагон и др.).  
   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  

2. Для каждого численного признака определить:  
   - Название признака (например, "массовая доля N", "массовая доля P2O5", "массовая доля К2О", "массовая доля S", "масса нетто единицы", "масса нетто", "масса K2O", "масса брутто", "количество вагонов", "стандарт" и т.д.)  
   - Значение (число, если есть диапазон — брать оба значения; для стандарта указываешь полный номер стандарта со словами ГОСТ/ТУ или др.)  
   - Единицу измерения (%, кг, т, шт, п/э меш, вагон, или пусто для стандарта)  

3. Особые указания:
   - Извлекай на русском
   - Если признак указан как диапазон из нескольких чисел (например "8-10", или "от 6 до 12") или с погрешностью (+/-), укажи оба числа в формате [min, max]. 
   - Извлекай логические/сравнительные операторы, если они присутствуют в тексте: «не менее» - [min, null] «не более» - [null, max]
   - Используй точку в качестве разделителя десятичных чисел.
   - Название вещества и его массовая доля могут встречаться в марке (например, "N7-P20-K30-S3"),  используй данные из марки, если нет иных данных по массовой доле вещества.
   - Если в названии признака есть название химического элемента (например Кальций) - замени его на обозначение химического элемента - Ca.
   - Названия признаков пиши с маленькой буквы. Например "массовая доля Zn".
   - Если указано например "МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О" - то правильным извлекаемым признаком будет "массовая доля K2O".
   - Если один и тот же параметр встречается дважды — сначала как общее условие (например, «с содержанием азота более 10%»), а затем как конкретное значение (например, «азот 16%»), указывай только конкретное значение.
   - Для массы с упаковкой - называй признак "масса брутто" вне зависимости от наименования упаковки. Если указывается просто масса в формате "МЕШКИ ПО 50 КГ" - это признак "масса нетто".
   - Если дается масса в виде "ПО 1000 КГ+5%" - указывай в признаке "масса брутто" одно значение - 1050.
   - Для прочих признаков (всех признаков, помимо "массовой доли") указывай единицы измерения (за исключением признаков "марка" и "стандарт")
   - Если признака в тексте нет - не извлекай его и не выводи его в json.

4. Выводи строго JSON следующего вида (пример с латинскими ключами):

Пример текста:
НИТРОАММОФОСКА, УДОБРЕНИЕ МИНЕРАЛЬНОЕ, СОДЕРЖАЩЕЕ ТРИ ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА - АЗОТ-27 +-1%, ФОСФОР-20% (В ПЕРЕСЧЕТЕ НА P2O5), КАЛИЙ-20% (В ПЕРЕСЧЕТЕ НА K2O), СЕРА-3%. ПОСТАВЛЯЕТСЯ В МЕШКАХ ПО 50 КГ. МАССА БРУТТО С УПАКОВКОЙ: 1020 КГ. КОЛИЧЕСТВО ПОДДОНОВ: 20 ШТ. КОЛИЧЕСТВО МЕШКОВ: 1000 ШТ. ОБЪЕМ НЕТТО ЕДИНИЦЫ: 10 Л. СООТВЕТСТВУЕТ ТУ 2184-037-32496445-02. МАРКА: N26-P20-K20-S3.

Пример ответа:
```json
{{
  "mass_fractions": [
    {{"substance_name": "N", "mass_fraction": [26, 28]}},
    {{"substance_name": "P2O5", "mass_fraction": 20}},
    {{"substance_name": "K2O", "mass_fraction": 20}},
    {{"substance_name": "S", "mass_fraction": 3}}
  ],
  "other_params": [
    {{"parameter_name": "масса нетто единицы", "mass": 50, "unit": "кг"}},
    {{"parameter_name": "масса брутто", "mass": 1020, "unit": "кг"}},
    {{"parameter_name": "количество поддонов", "quantity": 20, "unit": "шт"}},
    {{"parameter_name": "количество мешков", "quantity": 1000, "unit": "шт"}},
    {{"parameter_name": "объем нетто единицы", "volume": 10, "unit": "л"}},
    {{"parameter_name": "стандарт", "value": "ТУ 2184-037-32496445-02"}},
    {{"parameter_name": "марка", "value": "N26-P20-K20-S3"}}
  ]
}}
```

5. Выводи json результат **только после слова ОТВЕТ:**.

Текст для анализа:
{text}
"""

MINIMAL_INSTR_FIVESHOT = """
Ты — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  
Твоя задача:  

1. Найти все численные признаки в тексте, например:  
   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  
   - Количество товара (кг, т, п/э мешки, вагон и др.).  
   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  

2. Выведи json по аналогии с этими примерами:
Текст примера 1: СЛОЖНОЕ АЗОТНО-ФОСФОРНО-КАЛИЙНОЕ МИНЕРАЛЬНОЕ УДОБРЕНИЕ АЗОФОСКА (НИТРОАММОФОСКА), ГРАНУЛИРОВАННОЕ, С СОДЕРЖАНИЕМ МАССОВОЙ ДОЛИ АЗОТА 16 МАС.%, ФОСФОРА 16 МАС.%, КАЛИЯ 16 МАС.% В ПЕРЕСЧЕТЕ НА СУXОЙ БЕЗВОДНЫЙ ПРОДУКТ, СООТВЕТСТВУЕТ ТУ 2186-039-00203789 -2003, ОБЕСПЕЧИВАЕТ СБАЛАНСИРОВАННОЕ ПИТАНИЕ РАСТЕНИЙ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, В ПОЛИПРОПИЛЕНОВЫХ МЕШКАХ ПО 50 КГ СЛОЖНОЕ АЗОТНО-ФОСФОРНО-КАЛИЙНОЕ МИНЕРАЛЬНОЕ УДОБРЕНИЕ АЗОФОСКА
Ответ примера 1: 
{{
  "массовая доля": [
    {{
      "вещество": "N",
      "массовая доля": 16
    }},
    {{
      "вещество": "P2O5",
      "массовая доля": 16
    }},
    {{
      "вещество": "K2O",
      "массовая доля": 16
    }}
  ],
  "прочее": [
    {{
      "параметр": "стандарт",
      "значение": "ТУ 2186-039-00203789-2003"
    }},
    {{
      "параметр": "масса нетто единицы",
      "масса": 50,
      "единица": "кг"
    }}
  ]
}}

Текст примера 2: СУЛЬФАТ КАЛИЯ, ДЛЯ ТЕХНИЧЕСКОГО ИСПОЛЬЗОВАНИЯ. КРИСТАЛЛИЧЕСКИЙ РАССЫПЧАТЫЙ ПОРОШОК БЕЛОГО ЦВЕТА С ЖЕЛТОВАТЫМ ОТТЕНКОМ, НЕ СОДЕРЖАЩИЙ МЕХАНИЧЕСКИХ ПРИМЕСЕЙ,УПАКОВАННЫЙ В БИГ-БЕГИ ПО 1000 КГ+5%. СОСТАВ: МАССОВАЯ ДОЛЯ КАЛИЯ (К2О)-50.0%,SO4 - 52,5% ХЛОР( CI)-1.0% ГИГРОСКОПИЧЕН. :
Ответ примера 2: {{
  "массовая доля": [
    {{
      "вещество": "K2O",
      "массовая доля": 50.0
    }},
    {{
      "вещество": "SO4",
      "массовая доля": 52.5
    }},
    {{
      "вещество": "Cl",
      "массовая доля": 1.0
    }}
  ],
  "прочее": [
    {{
      "параметр": "масса брутто единицы",
      "масса": 1050,
      "единица": "кг"
    }}
  ]
}}

Текст примера 3: НИТРАТ КАЛЬЦИЯ КОНЦЕНТРИРОВАННЫЙ.ГРАНУЛИРОВАННЫЙ ПРОДУКТ С СОДЕРЖ.МАС.ДОЛИ ОБЩЕГО АЗОТА 17%, АММОНИЙНОГО АЗОТА НЕ БОЛЕЕ 0,5%,КАЛЬЦИЯ НЕ МЕНЕЕ 32%.ПРИМ-СЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ,РОЗНИЧНОЙ ПРОДАЖЕ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ. :
Ответ примера 3: 
{{
  "массовая доля": [
    {{
      "вещество": "N",
      "массовая доля": 17
    }},
    {{
      "вещество": "NH4+",
      "массовая доля": [null, 0.5]
    }},
    {{
      "вещество": "Ca",
      "массовая доля": [32, null]
    }}
  ],
  "прочее": []
}}

Текст примера 4: КАЛИЙ СЕРНОКИСЛЫЙ ИЗ НЕФЕЛИНОВОГО СЫPЬЯ ТУ 20.15.52-089-05785164-2022, ПРЕДНАЗНАЧЕН ДЛЯ ПРИМЕНЕНИЯ В КАЧЕСТВЕ МИНЕРАЛЬНОГО УДОБРЕНИЯ В СЕЛЬСКОМ ХОЗЯЙСТВЕ, ПОЛУЧАЮТ ИЗ ВЕТВИ ТЕХНОЛОГИЧЕСКОГО ПРОЦЕССА ПРОИЗВОДСТВА СОДОПРОДУКТОВ ИЗ РАСТВОРОВ ГЛИНОЗЕМНОГО ПРОИЗВОДСТВА
Ответ примера 4: 
{{
  "массовая доля": [],
  "прочее": [
    {{
      "параметр": "стандарт",
      "значение": "ТУ 20.15.52-089-05785164-2022"
    }}
  ]
}}

Текст примера 5: СУЛЬФАТ КАЛИЯ (СОРТ ЭКСТРА), ДЛЯ ТЕХНИЧЕСКOГО ИСПОЛЬЗОВАНИЯ. КРИСТАЛЛИЧЕСКИЙ РАССЫПЧАТЫЙ ПОРОШОК БЕЛОГО ЦВЕТА С ЖЕЛТОВАТЫМ ОТТЕНКОМ, НЕ СОДЕРЖАЩИЙ МЕХАНИЧЕСКИХ ПРИМЕСЕЙ,УПАКОВАННЫЙ В МЕШКИ ПО 25КГ+-5%, ОБЩИЙ ВЕС БРУТТО С ПАЛЛЕТАМИ 21640 КГ. СОСТАВ:МА МАССОВАЯ ДОЛЯ КАЛИЯ (К2О)-51.0%,SO4 - 51,0% ХЛОР(CI)-1.0%, ГИГРОСКОПИЧЕН. :
Ответ примера 5: 
{{
  "массовая доля": [
    {{
      "вещество": "K2O",
      "массовая доля": 51.0
    }},
    {{
      "вещество": "SO4",
      "массовая доля": 51.0
    }},
    {{
      "вещество": "Cl",
      "массовая доля": 1.0
    }}
  ],
  "прочее": [
    {{
      "параметр": "масса брутто единицы",
      "масса": 26.25,
      "единица": "кг"
    }},
    {{
      "параметр": "масса брутто",
      "масса": 21640,
      "единица": "кг"
    }}
  ]
}}

3. Выводи json результат **только после слова ОТВЕТ:**.

Текст для анализа:
{text}
"""

MINIMAL_INSTR_FIVESHOT_APIE = """
Ты — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  
Твоя задача:  

1. Найти все численные признаки в тексте, например:  
   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  
   - Количество товара (кг, т, п/э мешки, вагон и др.).  
   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  

2. Выведи json по аналогии с этими примерами:
Текст примера 1: УДОБРЕНИЯ МИНЕРАЛЬНЫЕ ИЛИ ХИМИЧЕСКИЕ, СОДЕРЖАЩИЕ TРИ ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА: АЗОТ, ФОСФОР И КАЛИЙ. УДОБРЕНИЕ БОНА ФОРТЕ ЗДОРОВЬЕ 10МЛ УНИВЕРСАЛЬНОЕ 25ШТ/75ШТ. СОСТАВ: ТРИ ОСНОВНЫХ МАКРОЭЛЕМЕНТА (NPK): АЗОТ (N) - 6 %, ФОСФОР (P2O5) - 3 %, КАЛИЙ (K2O) - 7 %, ГУМИНОВЫЕ КИСЛОТЫ: ГУМАТ - 0,5 %. МИКРОЭЛЕМЕНТЫ: БОР, ЖЕЛЕЗО, МАРГАНЕЦ, ЦИНК, МЕДЬ, МОЛИБДЕН , КОБАЛЬТ, А ТАКЖЕ КАЛЬЦИЙ И МАГНИЙ. ИЗ НИХ ШЕСТЬ МИКРОЭЛЕМЕНТОВ В ХЕЛАТНОЙ ФОРМЕ: (ЖЕЛЕЗО, МАРГАНЕЦ, ЦИНК, МЕДЬ, МОЛИБДЕН, КОБАЛЬТ) УДОБРЕНИЕ БОНА ФОРТЕ КРАСОТА 10МЛ ДЛЯ ДЕКОРАТИВНО-ЛИСТВЕННЫХ РАСТЕНИЙ 25ШТ/75ШТ. СПЕЦИАЛИЗИРОВАННОЕ КОМПЛЕКСНОЕ ЖИДКОЕ УДОБРЕНИЕ С МИКРОЭЛЕМЕНТАМИ. СОСТАВ: АЗОТ (N) - 5 %, ФОСФОР (P2O5) - 3 %, КАЛИЙ (K2O) - 4 %. ОСНОВНОЙ МЕЗОЭЛЕМЕНТ: МАГНИЙ (MGO) - 1 %. СЕМЬ МИКРОЭЛЕМЕНТОВ В ХЕЛАТНОЙ ФОРМЕ: БОР, ЖЕЛЕЗО, МАРГАНЕЦ, ЦИНК, МЕДЬ, МОЛИБДЕН И КОБАЛЬТ. КОМПЛЕКС ВИТАМИНОВ: B1, PP, С. СТИМУЛЯТОР РОСТА: ЯНТАРНАЯ КИСЛОТА. УДОБРЕНИЕ БОНА ФОРТЕ КРАСОТА 10МЛ ДЛЯ КОМНАТНЫХ РАСТЕНИЙ 25ШТ/75ШТ. "СОСТАВ: АЗОТ (N) - 6 %, ФОСФОР (P2O5) - 3 %, КАЛИЙ (K2O) - 7 %. ОСНОВНОЙ МЕЗОЭЛЕМЕНТ: МАГНИЙ (MGO) - 1,5 % СЕМЬ МИКРОЭЛЕМЕНТОВ В ХЕЛАТНОЙ ФОРМЕ: БОР, ЖЕЛЕЗО, МАРГАНЕЦ, ЦИНК, МЕДЬ, МОЛИБДЕН И КОБАЛЬТ. КОМПЛЕКС ВИТАМИНОВ: B1, PP, С СТИМУЛЯТОР РОСТА: ЯНТАРНАЯ КИСЛОТА." УДОБРЕНИЕ БУЙСКОЕ ЖКУ 0,2Л ЦВЕТОЧНЫЙ РАЙ КАКТУСЫ/СУККУЛЕНТЫ (12). СОСТАВ: АЗОТ (N) ОБЩИЙ - 9,12 %, В Т.Ч. N-NO3 - 6,24%, N-NH4 - 2,88%. ДОП.ИНФОРМАЦИЯ: N (Г/Л): 9.12, P2O5 (Г/Л): 12.96, K2O (Г/Л): 45.6, MGO (Г/Л): 4.8 МИКРОЭЛЕМЕНТЫ: МГ/Л, FE (ДТПА) - 77.76; MN (ЭДТА) - 60.48; ZN (ЭДТА) - 20.16; CU (ЭДТА) - 14.4; MO - 5.76; B - 28.8 УДОБРЕНИЕ БУЙСКОЕ ЖКУ 0,2Л ЦВЕТОЧНЫЙ РАЙ ХВОЙНЫЕ РАСТЕНИЯ (12). "АЗОТ (N) ОБЩИЙ - 8,64 %, В Т.Ч. N-NO3 - 7,68%, N-NH4 - 0,96%. СОСТАВ:N (Г/Л): 8.64, P2O5 (Г/Л): 16.32, K2O (Г/Л): 50.4, MGO (Г/Л): 4.32 МИКРОЭЛЕМЕНТЫ: МГ/Л, FE (ДТПА) - 77.76; MN (ЭДТА) - 60.48; ZN (ЭДТА) - 20.16; CU (ЭДТА) - 14.4; MO - 5.76; B - 28.8 ВНЕШНИЙ ВИД: ЖИДКОСТЬ ЗЕЛЕНОГО ЦВЕТА" УДОБРЕНИЕ БУЙСКОЕ ЖКУ 0,5Л ЧУДО-СПРЕЙ УНИВЕРСАЛЬНЫЙ (12). "СОСТАВ: N (Г/Л): 0.23, P2O5 (Г/Л): 0.23, K2O (Г/Л): 0.34, MGO (Г/Л): 0.024 МИКРОЭЛЕМЕНТЫ: МГ/Л, FE (ДТПА) - 0.78; MN (ЭДТА) - 0.6; ZN (ЭДТА) - 0.2; CU (ЭДТА) - 0.14; MO - 0.06; B - 0.28 ВНЕШНИЙ ВИД: ЖИДКОСТЬ ЗЕЛЕНОВАТОГО ЦВЕТА" УДОБРЕНИЕ СЖ КОУ 0,3Л ДЛЯ ХВОЙНЫХ/СИЛА ЖИЗНИ (8). СОСТАВ: ОРГАНИЧЕСКИЕ ВЕЩЕСТВА *: 35 %, АЗОТ (N): 2 %, ФОСФОР (P2O5): 3 %, КАЛИЙ (K2O): 7 %, МАГНИЙ (MGO): 2 %, БОР (B): 0,2 %, МЕДЬ (CU): 0,5 %, КОБАЛЬТ (CO): 0,02 %, ЖЕЛЕЗО (FE): 0,8 %, МАРГАНЕЦ (MN ): 0,6 %, МОЛИБДЕН (MO): 0,02 %, ЦИНК (ZN): 1 % УДОБРЕНИЕ СЖ КОУ 0,3Л ДЛЯ ЦВЕТОВ И ДЕКОРАТ-ЦВЕТУЩИХ/СИЛА ЖИЗНИ (8). "СОСТАВ, %: МАКРО-МИКРОЭЛЕМЕНТЫ В КОМПЛЕКСНОМ СОЕДИНЕНИИ С АМИНОКИСЛОТАМИ (АМИНОХЕЛАТЫ), ГЛЮКОНОВОЙ КИСЛОТОЙ (ГЛЮКОНАТЫ). АЗОТ (N) 10 %, ФОСФОР (P2O5) 5 %, КАЛИЙ ( K2O ) 7 %, КАЛЬЦИЙ (CAO) 2 %, МАГНИЙ (MGO) 1 %, БОР (B) 0,02 %, МЕДЬ (CU) 0,5 %, КОБАЛЬТ (CO) 0,02 %, ЖЕЛЕЗО (FE) 0,8 %, МАРГАНЕЦ (MN) 0,6 %, МОЛИБДЕН (MO) 0,02 %, ЦИНК (ZN) 1%, ОРГАНИЧЕСКИЕ ВЕЩЕСТВА - 35 %. В ТОМ ЧИСЛЕ АМИНОКИСЛОТЫ, ВИТАМИНЫ: C, В1, В3, В12, ПОЛИСАХАРИДЫ, ГИДРОКСИКАРБОНОВЫЕ, ГУМИНОВЫЕ И ФУЛЬВОКИСЛОТЫ." УДОБРЕНИЕ СЖ КОУ 0,3Л ДЛЯ ЦИТРУСОВЫХ/СИЛА ЖИЗНИ (8). "СОСТАВ, %: МАКРО-МИКРОЭЛЕМЕНТЫ В КОМПЛЕКСНОМ СОЕДИНЕНИИ С АМИНОКИСЛОТАМИ (АМИНОХЕЛАТЫ), ГЛЮКОНОВОЙ КИСЛОТОЙ (ГЛЮКОНАТЫ). АЗОТ (N) 10 %, ФОСФОР (P2O5) 5 %, КАЛИЙ ( K2O ) 7 %, КАЛЬЦИЙ (CAO) 2 %, МАГНИЙ (MGO) 1 %, БОР (B) 0,02 %, МЕДЬ (CU) 0,5 %, КОБАЛЬТ (CO) 0,02 %, ЖЕЛЕЗО (FE) 0,8 %, МАРГАНЕЦ (MN) 0,6 %, МОЛИБДЕН (MO) 0,02 %, ЦИНК (ZN) 1%, ОРГАНИЧЕСКИЕ ВЕЩЕСТВА - 35 %. В ТОМ ЧИСЛЕ АМИНОКИСЛОТЫ, ВИТАМИНЫ: C, В1, В3, В12, ПОЛИСАХАРИДЫ, ГИДРОКСИКАРБОНОВЫЕ, ГУМИНОВЫЕ И ФУЛЬВОКИСЛОТЫ."
Ответ примера 1: 
{{
  "массовая доля": [
    {{"вещество": "N", "массовая доля": 6}},
    {{"вещество": "P2O5", "массовая доля": 3}},
    {{"вещество": "K2O", "массовая доля": 7}},
    {{"вещество": "гумат", "массовая доля": 0.5}},

    {{"вещество": "N", "массовая доля": 5}},
    {{"вещество": "P2O5", "массовая доля": 3}},
    {{"вещество": "K2O", "массовая доля": 4}},
    {{"вещество": "MgO", "массовая доля": 1}},

    {{"вещество": "N", "массовая доля": 6}},
    {{"вещество": "P2O5", "массовая доля": 3}},
    {{"вещество": "K2O", "массовая доля": 7}},
    {{"вещество": "MgO", "массовая доля": 1.5}},

    {{"вещество": "N", "массовая доля": 9.12}},
    {{"вещество": "NO3-", "массовая доля": 6.24}},
    {{"вещество": "NH4+", "массовая доля": 2.88}},

    {{"вещество": "N", "массовая доля": 8.64}},
    {{"вещество": "NO3-", "массовая доля": 7.68}},
    {{"вещество": "NH4+", "массовая доля": 0.96}},

    {{"вещество": "органические вещества", "массовая доля": 35}},
    {{"вещество": "N", "массовая доля": 2}},
    {{"вещество": "P2O5", "массовая доля": 3}},
    {{"вещество": "K2O", "массовая доля": 7}},
    {{"вещество": "MgO", "массовая доля": 2}},
    {{"вещество": "B", "массовая доля": 0.2}},
    {{"вещество": "Cu", "массовая доля": 0.5}},
    {{"вещество": "Co", "массовая доля": 0.02}},
    {{"вещество": "Fe", "массовая доля": 0.8}},
    {{"вещество": "Mn", "массовая доля": 0.6}},
    {{"вещество": "Mo", "массовая доля": 0.02}},
    {{"вещество": "Zn", "массовая доля": 1}},

    {{"вещество": "N", "массовая доля": 10}},
    {{"вещество": "P2O5", "массовая доля": 5}},
    {{"вещество": "K2O", "массовая доля": 7}},
    {{"вещество": "CaO", "массовая доля": 2}},
    {{"вещество": "MgO", "массовая доля": 1}},
    {{"вещество": "B", "массовая доля": 0.02}},
    {{"вещество": "Cu", "массовая доля": 0.5}},
    {{"вещество": "Co", "массовая доля": 0.02}},
    {{"вещество": "Fe", "массовая доля": 0.8}},
    {{"вещество": "Mn", "массовая доля": 0.6}},
    {{"вещество": "Mo", "массовая доля": 0.02}},
    {{"вещество": "Zn", "массовая доля": 1}},
    {{"вещество": "органические вещества", "массовая доля": 35}}
  ],
  "прочее": [
    {{"параметр": "объем нетто единицы", "объем": 10, "единица": "мл"}},
    {{"параметр": "количество единиц", "количество": 25, "единица": "шт"}},
    {{"параметр": "количество единиц", "количество": 75, "единица": "шт"}},

    {{"параметр": "объем нетто единицы", "объем": 0.2, "единица": "л"}},
    {{"параметр": "количество единиц", "количество": 12, "единица": "шт"}},
    {{"параметр": "концентрация N", "значение": 9.12, "единица": "г/л"}},
    {{"параметр": "концентрация P2O5", "значение": 12.96, "единица": "г/л"}},
    {{"параметр": "концентрация K2O", "значение": 45.6, "единица": "г/л"}},
    {{"параметр": "концентрация MgO", "значение": 4.8, "единица": "г/л"}},
    {{"параметр": "концентрация Fe", "значение": 77.76, "единица": "мг/л"}},
    {{"параметр": "концентрация Mn", "значение": 60.48, "единица": "мг/л"}},
    {{"параметр": "концентрация Zn", "значение": 20.16, "единица": "мг/л"}},
    {{"параметр": "концентрация Cu", "значение": 14.4, "единица": "мг/л"}},
    {{"параметр": "концентрация Mo", "значение": 5.76, "единица": "мг/л"}},
    {{"параметр": "концентрация B", "значение": 28.8, "единица": "мг/л"}},

    {{"параметр": "объем нетто единицы", "объем": 0.5, "единица": "л"}},
    {{"параметр": "количество единиц", "количество": 12, "единица": "шт"}},
    {{"параметр": "концентрация N", "значение": 0.23, "единица": "г/л"}},
    {{"параметр": "концентрация P2O5", "значение": 0.23, "единица": "г/л"}},
    {{"параметр": "концентрация K2O", "значение": 0.34, "единица": "г/л"}},
    {{"параметр": "концентрация MgO", "значение": 0.024, "единица": "г/л"}},

    {{"параметр": "объем нетто единицы", "объем": 0.3, "единица": "л"}},
    {{"параметр": "количество единиц", "количество": 8, "единица": "шт"}}
  ]
}}


Текст примера 2: АГРОХИМИКАT ЯРА ЛИВА МАРКИ:КАЛЬЦИНИТ (КАЛЬЦИЕВАЯ СЕЛИТРА) НИТРАБОР. ВЫВОЗИТСЯ ДЛЯ УДОБРЕНИЯ ДЕРЕВЬЕВ В ЯБЛОНЕВОМ САДУ. НЕ КУЛЬТУРНАЯ ЦЕННОСТЬ. НЕ ВОЕННОГО НАЗНАЧЕНИЯ. ДЛЯ ОБЩЕГРАЖДАНСКИХ ЦЕЛЕЙ.. АГРОХИМИКАТ НИТРАБОР (КАЛЬЦИЕВАЯ СЕЛИТРА). СОСТАВ: АЗОТ ОБЩИЙ (N) 15.5% ((АЗОТ НИТРАТНЫЙ (N)14.4%,АЗОТ АММОНИЙНЫЙ (N) 1.1%)), КАЛЬЦИЙ ВОДОРАСТВОРИМЫЙ В ВИДЕ СА 18.6%, В ВИДЕ САО 26.6%,ВОДОРАСТВОРИМЫЙ БОР (В) 0.3%.
Ответ примера 2: {{
  "массовая доля": [
    {{
      "вещество": "N",
      "массовая доля": 15.5
    }},
    {{
      "вещество": "NO3-",
      "массовая доля": 14.4
    }},
    {{
      "вещество": "NH4+",
      "массовая доля": 1.1
    }},
    {{
      "вещество": "Ca",
      "массовая доля": 18.6
    }},
    {{
      "вещество": "CaO",
      "массовая доля": 26.6
    }},
    {{
      "вещество": "B",
      "массовая доля": 0.3
    }}
  ]
}}

Текст примера 3: НИТРАТ КАЛЬЦИЯ ГPАНУЛИРОВАННЫЙ 2-ВОДНЫЙ МАРКА А, 5CA(NO3)2XNH4NO3X10H2O,ТОВАРНЫЙ ЗНАК "БУЙСКИЕ УДОБРЕНИЯ", ТУ 2181-073-32496445-2013, СМ.ДОПОЛНЕНИЕ. НАИМЕНОВАНИЕ ПОКАЗАТЕЛЕЙ:МАС.ДОЛЯ КАЛЬЦИЯ,CA,%,НЕ МЕНЕЕ- 19.7; НИТРАТ.,N,%,НЕ МЕНЕЕ- 15.1; МАС.ДОЛЯ НЕРАСТВ. В ВОДЕ ОСТАТКА,%, НЕ БОЛЕЕ- 0.03 - 20000 КГ (1000 П/Э МЕШ. ПО 20 КГ, ВЕС П/Э МЕШ.- 100 КГ), УЛОЖЕННЫЕ НА 20 ПОДДОНОВ, ЗАТЯНУТЫЕ СТРЕЙЧ- ПЛЁНКОЙ, ВЕСОМ 520 КГ, ГРАНУЛЫ ПОЛУСФЕРИЧЕСКОЙ ФОРМЫ БЕЛОГО ЦВЕТА, ПРИМЕНЯЕТСЯ КАК АЗОТНОКАЛЬЦИЕВОЕ УДОБРЕНИЕ.
Ответ примера 3: 
{{
  "массовая доля": [
    {{
      "вещество": "Ca",
      "массовая доля": [19.7, null]
    }},
    {{
      "вещество": "N",
      "массовая доля": [15.1, null]
    }},
    {{
      "вещество": "нерастворимый в воде остаток",
      "массовая доля": [null, 0.03]
    }}
  ],
  "прочее": [
    {{
      "параметр": "масса нетто",
      "масса": 20000,
      "единица": "кг"
    }},
    {{
      "параметр": "количество мешков",
      "количество": 1000,
      "единица": "шт"
    }},
    {{
      "параметр": "масса нетто единицы",
      "масса": 20,
      "единица": "кг"
    }},
    {{
      "параметр": "масса п/э мешков",
      "масса": 100,
      "единица": "кг"
    }},
    {{
      "параметр": "количество поддонов",
      "количество": 20,
      "единица": "шт"
    }},
    {{
      "параметр": "масса стрейч плёнки",
      "масса": 520,
      "единица": "кг"
    }},
    {{
      "параметр": "стандарт",
      "значение": "ТУ 2181-073-32496445-2013"
    }}
  ]
}}

Текст примера 4: МИНЕРАЛЬНОЕ УДОБРЕНИЕ ТУКОСМЕСЬ "FOSAMOFERT" СОДЕРЖАЩИЕ ДВА ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА ФОСФОР И АЗОТ, ГРАНУЛИРОВАННОЕ,В 18 БИГ-БЭГАХ, МИНЕРАЛЬНОЕ УДОБРЕНИЕ ТУКОСМЕСЬ "FOSAMOFERT" СОДЕРЖАЩИЕ ДВА ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА ФОСФОР И АЗОТ, ГРАНУЛИРОВАННОЕ,В 18 БИГ-БЭГАХ
Ответ примера 4: 
{{
  "прочее": [
    {{
      "параметр": "количество биг-бэгов",
      "количество": 18,
      "единица": "шт"
    }}
  ]
}}

Текст примера 5: СУЛЬФАТ АММОНИЯ МАРКИ: ГРАНУЛИРОВАННЫЙ / MАССОВАЯ ДОЛЯ АЗОТА -20,5 +/- 0,5% ТУ-2181-694-00209438-2015, НИТРАТЫ ОТСУТСТВУЮТ.. :
Ответ примера 5: 
{{
  "массовая доля": [
    {{
      "вещество": "N",
      "массовая доля": [20.0, 21.0]
    }}
  ],
  "прочее": [
    {{
      "параметр": "стандарт",
      "значение": "ТУ-2181-694-00209438-2015"
    }}
  ]
}}

3. Выводи json результат **только после слова ОТВЕТ:**.

Текст для анализа:
{text}
"""

# Промпт для агента извлечения числовых фрагментов
NUMERIC_FRAGMENTS_EXTRACTION_PROMPT = """
Ты — агент извлечения количественных атрибутов продукта из технического текста.

Твоя задача — найти и извлечь все фрагменты текста, которые выражают
измеримые, нормируемые или спецификационные свойства продукта.

Извлекаемый фрагмент должен представлять собой:
> «Сущность продукта + числовое значение + (при необходимости) единицы / допуск / стандарт»

То есть это должен быть осмысленный количественный атрибут, который может быть
нормализован, сопоставлен и сравним в последующих шагах обработки.

### ЧТО СЧИТАЕТСЯ АТРИБУТОМ

Извлекай фрагменты, описывающие:

#### 1. Состав и концентрации
- Массовые, молярные и процентные доли
  (Азот 16%, P2O5 20%, содержание влаги не более 1.5%)
- Формулы и марки удобрений
  (N7-P20-K30-S3, 10-26-26)

#### 2. Физические и логистические характеристики
- Масса, объём, фасовка, упаковка
  (мешки по 50 кг, биг-бэг 1000 кг, 25 л)
- Плотность, насыпная масса, влажность и т.п.

#### 3. Диапазоны, допуски, ограничения
- ±, от…до…, не более, не менее, в пределах
  (16% ±1%, от 6 до 12 г/л, не более 5%)

#### 4. Нормативные числовые идентификаторы
- ГОСТ, ТУ, ISO, EN и аналогичные стандарты с номерами

### ЧТО НЕ ИЗВЛЕКАТЬ

Не извлекай:
- Даты, годы, номера партий
- Телефоны, адреса, ИНН, артикулы
- Позиционные номера, номера строк, страниц
- Любые числа, не описывающие свойство продукта

### ПРАВИЛА ИЗВЛЕЧЕНИЯ ФРАГМЕНТОВ

1. Ты извлекаешь подстроки исходного текста, без перефразирования.
2. Фрагмент должен быть минимальным, но семантически полным:
   он должен включать:
   - что измеряется
   - и сколько
3. Если рядом есть допуск или диапазон — включай его в тот же фрагмент:
   правильно: «Азот 16% ±1%»  
   неправильно: «Азот 16%» и «±1%» отдельно
4. Если рядом несколько разных атрибутов — каждый извлекай отдельно.
5. Если число относится к слову, оно должно быть извлечено вместе с этим словом:
   правильно: «мешках по 50 кг»  
   неправильно: «50 кг»

### ПРИМЕР

Текст:
НИТРОАММОФОСКА, содержащая азот 16% ±1%, фосфор 16%, калий 16%, поставляется в мешках по 50 кг.

Правильные фрагменты:
Азот 16% ±1%
Фосфор 16%
Калий 16%
В мешках по 50 кг

### ТЕКСТ ДЛЯ АНАЛИЗА:
{text}
"""

# Промпт для агента извлечения массовых долей
MASS_FRACTION_EXTRACTION_PROMPT = """
Ты — эксперт по извлечению массовых долей элементов из текстов об удобрениях.

Твоя задача: из найденных числовых фрагментов извлечь только информацию о массовых долях химических элементов.

Массовая доля может быть указана:
- Прямо: "массовая доля N 26%", "азот 16%", "N 26-28%"
- В марке: "N7-P20-K30-S3" означает N=7%, P2O5=20%, K2O=30%, S=3%
- С операторами: "не менее 10%", "не более 20%"

Правила:
- Если указано "МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О" - это "массовая доля K2O"
- Если в марке указана доля - используй её, если нет прямого указания
- Диапазоны указывай как [min, max]
- Операторы: «не менее» - [min, null], «не более» - [null, max]
- Названия элементов заменяй на химические обозначения (Кальций -> Ca)
- Названия признаков пиши с маленькой буквы

Выведи список найденных массовых долей в формате:
вещество: значение (или [min, max] для диапазона)
Например:
N: [16, 18]

Если массовых долей нет, выведи "Массовых долей не найдено".

Числовые фрагменты для анализа:
{numeric_fragments}
"""

# Промпт для агента извлечения прочих параметров
OTHER_PARAMETERS_EXTRACTION_PROMPT = """
Ты — эксперт по извлечению прочих количественных параметров из текстов об удобрениях.

Твоя задача: из найденных числовых фрагментов извлечь все параметры, КРОМЕ массовых долей элементов.

Ищи:
- Массу нетто единицы (например, "мешки по 50 кг" -> масса нетто: 50 кг)
- Массу брутто (масса с упаковкой)
- Количество (мешков, поддонов, вагонов и др.)
- Объем нетто единицы
- Стандарты (ГОСТ, ТУ и др.)
- Марки (если не использованы для массовых долей)

Правила:
- "МЕШКИ ПО 50 КГ" -> масса нетто: 50 кг
- "ПО 1000 КГ+5%" -> масса брутто: 1050 кг
- Для массы с упаковкой всегда "масса брутто"
- Указывай единицы измерения (кроме "марка" и "стандарт")
- Если параметра нет - не выводи его

Выведи список найденных параметров в формате:
параметр: значение единица

Если прочих параметров нет, выведи "Прочих параметров не найдено".

Числовые фрагменты для анализа:
{numeric_fragments}
"""

# Упрощенный и пояснительный промпт для маленьких моделей (например, gemma-2b)
JSON_FORMATION_PROMPT = """
Ты агент, который формирует структурированный ответ в формате JSON.

1. Объедини все массовые доли и прочие параметры в один JSON, строго по показанному образцу ниже.
2. Если каких-то данных нет — выведи пустой список [] для этого поля.
3. Все числа дай через точку, если есть десятичные.
4. Для диапазона используй [min, max], [min, null] или [null, max].
5. Для "стандарт" и "марка" используй поле "значение".
6. Строго следуй названию каждого поля как в примере! Не добавляй ничего лишнего.

Пример ответа:
ОТВЕТ:
```json
{{
  "массовая доля": [
    {{"вещество": "N", "массовая доля": [26, 28]}},
    {{"вещество": "P2O5", "массовая доля": [20, null]}},
    {{"вещество": "K2O", "массовая доля": 20}},
    {{"вещество": "S", "массовая доля": 3}}
  ],
  "прочее": [
    {{"параметр": "масса нетто единицы", "масса": 50, "единица": "кг"}},
    {{"параметр": "масса брутто", "масса": 1020, "единица": "кг"}},
    {{"параметр": "стандарт", "значение": "ТУ 2184-037-32496445-02"}},
    {{"параметр": "марка", "значение": "N7-P20-K30-S3"}}
  ]
}}

В начале обязательно выведи: ОТВЕТ:

Возьми данные для заполнения json отсюда:

Массовые доли:
{mass_fractions}

Прочие параметры:
{other_parameters}
"""

# Промпт для агента-критика (поиск несоответствий)
# CRITIC_PROMPT = """
# Ты — эксперт-критик, который анализирует ответы моделей на предмет соответствия исходному промпту.

# Твоя задача:
# 1. Проанализировать исходный промпт и ответ модели
# 2. Найти все несоответствия между промптом и ответом:
#    - Пропущенные данные, которые должны были быть извлечены
#    - Неправильно извлеченные данные
#    - Нарушения формата вывода (например, не JSON, неправильная структура JSON)
#    - Логические ошибки в данных
#    - Несоответствия требованиям промпта

# 3. Вывести список найденных проблем в формате JSON:

# ```json
# {{
#   "найдены_ошибки": true/false,
#   "ошибки": [
#     {{
#       "тип": "пропущенные_данные" | "неправильные_данные" | "формат" | "логика" | "требования",
#       "описание": "детальное описание проблемы",
#       "критичность": "критичная" | "средняя" | "низкая"
#     }}
#   ]
# }}
# ```

# Если ошибок не найдено, выведи:
# ```json
# {{
#   "найдены_ошибки": false,
#   "ошибки": []
# }}
# ```

# Исходный промпт:
# {prompt}

# Ответ модели:
# {response}

# Выведи анализ в формате JSON после слова ОТВЕТ:.
# """

CRITIC_PROMPT = """
Ты — строгий и объективный эксперт-критик. Твоя задача — **только проверять соответствие ответа модели исходному промпту**, учитывая контекст тематики исходного промпта и ответа модели.  
**Не добавляй требований, которых нет в исходном промпте.**
### Правила анализа:
1. Сравни **только то, что явно указано в исходном промпте**.
2. Ошибки считаются **только если нарушено конкретное требование** из исходного промпта.
3. **Не считай ошибкой отсутствие единиц измерения, пояснений, форматирования или данных, если они не были прямо запрошены**.
4. **Не выдумывай ошибки** ради заполнения списка. Если всё соответствует — ошибок нет.
### Типы возможных ошибок:
- `"пропущенные_данные"` — если промпт требовал извлечь/указать конкретное значение, а его нет в ответе.
- `"неправильные_данные"` — если значение в ответе противоречит информации из контекста или промпта.
- `"формат"` — если промпт явно указал формат (например: "выведи JSON", "используй список"), а ответ ему не соответствует.
- `"логика"` — только если промпт содержал логическое условие или вычисление, и оно выполнено неверно.
- `"иные требования"` — если нарушено любое другое явное требование из промпта

После анализа выведи блок JSON в следующем формате, после слова `ОТВЕТ:`:

```json
{{
  "найдены_ошибки": false,
  "ошибки": []
}}
или если есть ошибки
{{
  "найдены_ошибки": true,
  "ошибки": [
    {{
      "тип": "...",
      "описание": "Кратко и точно: что именно нарушено в сравнении с промптом?",
      "критичность": "критичная" | "средняя" | "низкая"
    }}
  ]
}}

Исходный промпт:
{prompt}

Ответ модели для оценки:
{response}

"""

# Промпт для агента-исправителя (устранение ошибок)
CORRECTOR_PROMPT = """
Ты — эксперт-исправитель, который устраняет ошибки в ответах моделей на основе критики.

Твоя задача:
1. Получить исходный промпт, исходный ответ модели и список найденных ошибок
2. Исправить все найденные ошибки в ответе модели
3. Вывести исправленный ответ в том же формате, что и исходный ответ

Важно:
- Сохраняй структуру исходного ответа
- Исправляй только найденные ошибки, не меняй корректные части
Выведи результат в формате JSON после слова ОТВЕТ:

Исходный промпт:
{prompt}

Исходный ответ модели:
{original_response}

Найденные ошибки:
{critic_analysis}

Выведи исправленный ответ после слова ОТВЕТ:.
"""

QA_NUTRIENTS_PROMPT = """
Текст: {text}

Вопрос: Какие действующие вещества (питательные элементы или их соединения) указаны в этом удобрении? Извлекай только те, что относятся к агрохимическому составу:  
— Азот как N,  
— Фосфор как P2O5,  
— Калий как K2O,  
— Сера как S,  
— Кальций как Ca,  
— Магний как Mg,  
— Цинк как Zn,  
— и другие макро-/микроэлементы в стандартной форме.  

Если в марке указано, например, "N7-P20-K30", извлекай: N, P2O5, K2O.  
Если сказано "K в пересчёте на K2O" — указывай K2O.  
Не включай упаковку, стандарты, массу, объём.

Ответ должен быть строго списком строк в формате JSON. Примеры:

Пример текста: Удобрение NPK 16-20-20 содержит азот, фосфор (в виде P2O5) и калий (в виде K2O).
Пример ответа: 
```json
["N", "P2O5", "K2O"]
```

Пример текста: Марка N7-P20-K30-S3
Пример ответа: 
```json
["N", "P2O5", "K2O", "S"]
```

Пример текста: Гранулированное удобрение в мешках по 50 кг. Соответствует ТУ 12345.
Пример ответа: 
```json
[]
```

Отвечай только текстом в формате JSON после слова ОТВЕТ:
"""

QA_NUTRIENT_PROMPT = """
Контекст:
{text}

Вопрос:
Какова массовая доля {substance} в удобрении? Учти, что:
- Если указано "K в пересчёте на K2O" — это означает массовую долю K2O.
- Если значение дано как диапазон (например, "8–10" или "от 6 до 12"), верни [min, max].
- Если указано "не менее X" — верни [X, null].
- Если указано "не более X" — верни [null, X].
- Если значение одно — верни число (например, 20).
- Используй точку как десятичный разделитель.
- Если информации нет — верни null.

Ответ должен быть только в формате JSON, соответствующим структуре элемента массива "массовая доля":

Примеры ответов:
{{"вещество": "N", "массовая доля": [26, 28]}}
{{"вещество": "P2O5", "массовая доля": [20, null]}}
{{"вещество": "S", "массовая доля": 3}}
{{"вещество": "NH4+", "массовая доля": [null, 2]}}
{{"вещество": "N", "массовая доля": null}}

Отвечай только текстом в формате JSON после слова ОТВЕТ:
"""

QA_STANDARD_PROMPT = """
Контекст:
{text}

Вопрос:
Какой стандарт (ГОСТ, ТУ, СТО или другой нормативный документ) указан для этого удобрения?  
Если стандарт не указан — верни null.

Ответ должен быть только в формате JSON, соответствующим структуре элемента массива "прочее":

Примеры ответов:
{{"параметр": "стандарт", "значение": "ТУ 2184-037-32496445-02"}}
{{"параметр": "стандарт", "значение": null}}

Отвечай только текстом в формате JSON после слова ОТВЕТ:
"""

QA_GRADE_PROMPT = """
Контекст:
{text}

Вопрос:
Какая марка удобрения указана (например, N7-P20-K30-S3)?  
Если марка не указана — верни null.

Ответ должен быть только в формате JSON, соответствующим структуре элемента массива "прочее":

Примеры ответов:
{{"параметр": "марка", "значение": "N7-P20-K30-S3"}}
{{"параметр": "марка", "значение": null}}

Отвечай только текстом в формате JSON после слова ОТВЕТ:
"""

QA_QUANTITY_PROMPT = """
Контекст:
{text}

Вопрос:
Какое количество товара указано в тексте? Это может быть:
- масса (в кг, т и др.),
- объём (в л, м³ и др.),
- число упаковок (мешков, канистр, вагонов, поддонов, паллет и т.д.),
- любая другая числовая характеристика количества.

Извлеки:
1. **Числовое значение** (если указано "1000 мешков" → 1000; "5 т" → 5; "мешки по 50 кг" → 50).
2. **Единицу измерения** (например: "кг", "т", "шт", "меш", "вагон", "л", "паллета" и т.д. — как в тексте, но в нижнем регистре и без сокращений типа "п/э").
3. Если указан допуск (например, "+5%"), учти его: "1000 кг+5%" → 1050.

Правила:
- Извлекай **только то, что явно указано**.
- Не суммируй, не интерполируй, не вычисляй общее количество, если оно не дано напрямую.
- Если количество не указано — верни null.

Ответ должен быть строго в формате JSON, соответствующим структуре элемента массива "прочее":

Примеры ответов:
{{"параметр": "масса нетто единицы", "масса": 50, "единица": "кг"}}
{{"параметр": "масса брутто", "масса": 1020, "единица": "кг"}}
{{"параметр": "количество поддонов", "количество": 20, "единица": "шт"}}
{{"параметр": "количество мешков", "количество": 1000, "единица": "шт"}}
{{"параметр": "объем нетто единицы", "объем": 10, "единица": "л"}}

Для масс используй поле "масса", для количеств - "количество", для объемов - "объем". Определяй тип параметра по единице измерения и контексту.

Отвечай только текстом в формате JSON после слова ОТВЕТ:
"""
