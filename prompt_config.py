"""
Конфигурация промптов для обработки текстов
"""

# Базовый промпт для извлечения численных характеристик из текстов об удобрениях
FERTILIZER_EXTRACTION_PROMPT_TEMPLATE = """
Ты — эксперт по извлечению численных и количественных характеристик из текстов о химических веществах и удобрениях.  
Твоя задача:  

1. Найти все численные признаки в тексте, например:  
   - Массовую долю элементов (массовая доля N, массовая доля P2O5 и др.) в процентах.  
   - Количество товара (кг, т, п/э мешки, вагон и др.).  
   - Прочие численные показатели, указанные в тексте (марки, стандарты (ТУ, ГОСТ и др.), идентификаторы).  

2. Для каждого численного признака определить:  
   - Название признака (например, "массовая доля N", "массовая доля P2O5", "массовая доля К2О", "массовая доля S", "масса нетто единицы", "масса нетто", "масса K2O", "масса брутто", "количество вагонов", "стандарт" и т.д.)  
   - Значение (число, если есть диапазон — брать оба значения; для стандарта указываешь полный номер стандарта со словами ГОСТ/ТУ или др.)  
   - Единицу измерения (%, кг, т, шт, п/э меш, вагон, или пусто для стандарта)  

3. Особые указания:
   - Извлекай на русском
   - Если признак указан как диапазон из нескольких чисел (например "8-10", или "от 6 до 12") или с погрешностью (+/-), укажи оба числа в формате [min, max]. 
   - Извлекай логические/сравнительные операторы, если они присутствуют в тексте: «не менее» - [min, null] «не более» - [null, max]
   - Используй точку в качестве разделителя десятичных чисел.
   - Название вещества и его массовая доля могут встречаться в марке (например, "N7-P20-K30-S3"),  используй данные из марки, если нет иных данных по массовой доле вещества.
   - Если в названии признака есть название химического элемента (например Кальций) - замени его на обозначение химического элемента - Ca.
   - Названия признаков пиши с маленькой буквы. Например "массовая доля Zn".
   - Если указано например "МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О" - то правильным извлекаемым признаком будет "массовая доля K2O".
   - Если один и тот же параметр встречается дважды — сначала как общее условие (например, «с содержанием азота более 10%»), а затем как конкретное значение (например, «азот 16%»), указывай только конкретное значение.
   - Для массы с упаковкой - называй признак "масса брутто" вне зависимости от наименования упаковки. Если указывается просто масса в формате "МЕШКИ ПО 50 КГ" - это признак "масса нетто".
   - Если дается масса в виде "ПО 1000 КГ+5%" - указывай в признаке "масса брутто" одно значение - 1050.
   - Для прочих признаков (всех признаков, помимо "массовой доли") указывай единицы измерения (за исключением признаков "марка" и "стандарт")
   - Если признака в тексте нет - не извлекай его и не выводи его в json.

4 . Выводи строго JSON следующего вида (пример):

```json
{{
  "массовая доля": [
    {{"вещество": "N", "массовая доля": [26, 28]}},
    {{"вещество": "P2O5", "массовая доля": [20, null]}},
    {{"вещество": "K2O", "массовая доля": 20}},
    {{"вещество": "S", "массовая доля": 3}},
    {{"вещество": "NH4+", "массовая доля": [null, 2]}}
  ],
  "прочее": [
    {{"параметр": "масса нетто единицы", "масса": 50, "единица": "кг"}},
    {{"параметр": "масса брутто", "масса": 1020, "единица": "кг"}},
    {{"параметр": "количество поддонов", "количество": 20, "единица": "шт"}},
    {{"параметр": "количество мешков", "количество": 1000, "единица": "шт"}},
    {{"параметр": "объем нетто единицы", "объем": 10, "единица": "л"}},
    {{"параметр": "стандарт", "значение": "ТУ 2184-037-32496445-02"}},
    {{"параметр": "марка", "значение": "N7-P20-K30-S3"}}
  ]
}}
```

5. Выводи json результат **только после слова ОТВЕТ:**.

Текст для анализа:
{text}
"""

# Промпт для агента извлечения числовых фрагментов
NUMERIC_FRAGMENTS_EXTRACTION_PROMPT = """
Ты — эксперт по поиску числовых фрагментов в текстах о химических веществах и удобрениях.

Твоя задача: найти и извлечь все фрагменты текста, которые содержат числовые значения или количественные характеристики.

Ищи:
- Числа с единицами измерения (%, кг, т, шт, п/э меш, вагон, л и др.)
- Диапазоны чисел (например, "8-10", "от 6 до 12", "+/-0.5")
- Числа с операторами сравнения ("не менее", "не более", "более", "менее")
- Марки удобрений (например, "N7-P20-K30-S3")
- Стандарты (ГОСТ, ТУ и др.)
- Любые другие числовые упоминания

ВАЖНО:
- Выведи ТОЛЬКО список найденных числовых фрагментов, каждый на отдельной строке
- НЕ выводи инструкции, объяснения или просьбы выполнить задание
- НЕ выводи текст "пожалуйста выполните задание" или подобные фразы
- Если числовых фрагментов нет, выведи ТОЛЬКО: "Числовых фрагментов не найдено"
- Выведи результат сразу, без дополнительных комментариев

Пример текста, из которого можно извлечь числовые фрагменты:
НИТРОАММОФОСКА(АЗОФОCКА),УДОБРЕНИЕ МИНЕРАЛЬНОЕ,СОДЕРЖАЩЕЕ ТРИ ПИТАТЕЛЬНЫХ ЭЛЕМЕНТА - АЗОТ-16% +-1%, ФОСФОР-16%,КАЛИЙ-16%,НАСЫПЬЮ. ПОСТАВЛЯЕТСЯ В МЕШКАХ ПО 50 КГ.:

Пример извлечения числовых фрагментов из этого текста:
АЗОТ-16% +-1%
ФОСФОР-16%
КАЛИЙ-16%
В МЕШКАХ ПО 50 КГ.

Текст для извлечения числовых фрагментов:
{text}
"""

# Промпт для агента извлечения массовых долей
MASS_FRACTION_EXTRACTION_PROMPT = """
Ты — эксперт по извлечению массовых долей элементов из текстов об удобрениях.

Твоя задача: из найденных числовых фрагментов извлечь только информацию о массовых долях химических элементов.

Массовая доля может быть указана:
- Прямо: "массовая доля N 26%", "азот 16%", "N 26-28%"
- В марке: "N7-P20-K30-S3" означает N=7%, P2O5=20%, K2O=30%, S=3%
- С операторами: "не менее 10%", "не более 20%"

Правила:
- Если указано "МАССОВАЯ ДОЛЯ K В ПЕРЕСЧЕТЕ НА К2О" - это "массовая доля K2O"
- Если в марке указана доля - используй её, если нет прямого указания
- Диапазоны указывай как [min, max]
- Операторы: «не менее» - [min, null], «не более» - [null, max]
- Названия элементов заменяй на химические обозначения (Кальций -> Ca)
- Названия признаков пиши с маленькой буквы

Выведи список найденных массовых долей в формате:
вещество: значение (или [min, max] для диапазона)
Например:
N: [16, 18]

Если массовых долей нет, выведи "Массовых долей не найдено".

Числовые фрагменты для анализа:
{numeric_fragments}
"""

# Промпт для агента извлечения прочих параметров
OTHER_PARAMETERS_EXTRACTION_PROMPT = """
Ты — эксперт по извлечению прочих количественных параметров из текстов об удобрениях.

Твоя задача: из найденных числовых фрагментов извлечь все параметры, КРОМЕ массовых долей элементов.

Ищи:
- Массу нетто единицы (например, "мешки по 50 кг" -> масса нетто: 50 кг)
- Массу брутто (масса с упаковкой)
- Количество (мешков, поддонов, вагонов и др.)
- Объем нетто единицы
- Стандарты (ГОСТ, ТУ и др.)
- Марки (если не использованы для массовых долей)

Правила:
- "МЕШКИ ПО 50 КГ" -> масса нетто: 50 кг
- "ПО 1000 КГ+5%" -> масса брутто: 1050 кг
- Для массы с упаковкой всегда "масса брутто"
- Указывай единицы измерения (кроме "марка" и "стандарт")
- Если параметра нет - не выводи его

Выведи список найденных параметров в формате:
параметр: значение единица

Если прочих параметров нет, выведи "Прочих параметров не найдено".

Числовые фрагменты для анализа:
{numeric_fragments}
"""

# Упрощенный и пояснительный промпт для маленьких моделей (например, gemma-2b)
JSON_FORMATION_PROMPT = """
Ты агент, который формирует структурированный ответ в формате JSON.

1. Объедини все массовые доли и прочие параметры в один JSON, строго по показанному образцу ниже.
2. Если каких-то данных нет — выведи пустой список [] для этого поля.
3. Все числа дай через точку, если есть десятичные.
4. Для диапазона используй [min, max], [min, null] или [null, max].
5. Для "стандарт" и "марка" используй поле "значение".
6. Строго следуй названию каждого поля как в примере! Не добавляй ничего лишнего.

Пример ответа:
ОТВЕТ:
```json
{{
  "массовая доля": [
    {{"вещество": "N", "массовая доля": [26, 28]}},
    {{"вещество": "P2O5", "массовая доля": [20, null]}},
    {{"вещество": "K2O", "массовая доля": 20}},
    {{"вещество": "S", "массовая доля": 3}}
  ],
  "прочее": [
    {{"параметр": "масса нетто единицы", "масса": 50, "единица": "кг"}},
    {{"параметр": "масса брутто", "масса": 1020, "единица": "кг"}},
    {{"параметр": "стандарт", "значение": "ТУ 2184-037-32496445-02"}},
    {{"параметр": "марка", "значение": "N7-P20-K30-S3"}}
  ]
}}

В начале обязательно выведи: ОТВЕТ:

Возьми данные для заполнения json отсюда:

Массовые доли:
{{mass_fractions}}

Прочие параметры:
{{other_parameters}}
"""

